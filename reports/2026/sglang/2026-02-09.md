# æ¯æ—¥æ›´æ–°æŠ¥å‘Šï¼ˆ2026-02-09ï¼‰

## sgl-project/sglang

| æäº¤æ—¶é—´ | ä½œè€… | æäº¤ä¿¡æ¯ |
|----------|------|----------|
| 2026-02-09 23:40:40 | Xinyuan Tong | Fix MMLU benchmark to auto-download data and resolve path issue (#18486) |
| 2026-02-09 23:34:42 | Kurt Shuster | Pass `quantize_config` to `_initialize_model` (#18273) |
| 2026-02-09 23:17:45 | brimon | feature: support bidirectional attention for Gemma-3  (#10707) |
| 2026-02-09 22:32:08 | Mick | [diffusion] chore: fix unclean shutdown and resource leaks (#18477) |
| 2026-02-09 19:23:45 | yrk111222 | [diffusion] feat: add ModelScope support (#17924) |
| 2026-02-09 16:37:19 | Baizhou Zhang | Revert "optimize get_topk_ragged by fusing get k and k_scale triton kernel" (#18471) |
| 2026-02-09 16:10:39 | Liangsheng Yin | Tiny rename for spec related fileds. (#18468) |
| 2026-02-09 14:37:33 | LHXuuu | Make compressed-tensors MoEs support ignored layers (#17828) |
| 2026-02-09 14:20:45 | Junlin Zhou | [DLLM] Add JointThreshold algorithm for joint M2T and T2T decoding (#18171) |
| 2026-02-09 14:20:09 | YC Tseng | [AMD] CI - Fix AMD daily image release and install dependency (#18452) |
| 2026-02-09 14:08:24 | Bingxu Chen | [AMD] Update aiter to v0.1.10.post2 (#18423) |
| 2026-02-09 13:48:03 | Hudson Xing | fix: use --no-build-isolation for human-eval install (#18455) |
| 2026-02-09 12:51:35 | Yingchun Lai | fix: fix the wrong return value type of draft model runner (#18105) |
| 2026-02-09 11:34:29 | Zheng Wengang | [BugFix][PD]Fix metadata_buffer_index leak when aborted in PD (#17483) |
| 2026-02-09 10:53:11 | Shangming Cai | Refactoring Mooncake TE as a shared distributed component (#17810) |
| 2026-02-09 06:29:07 | Yi Zhong | [ModelOPT] Support Qwen 3 Next Coder NVFP4 (#18224) |
| 2026-02-09 04:22:55 | Lianmin Zheng | Update author information in pyproject.toml (#18453) |
| 2026-02-09 04:02:45 | Mohammad Miadh Angkad | [Kimi-K2.5] Fix missing `quant_config` in `KimiK25` (#18440) |
| 2026-02-09 00:52:47 | Piotr Mazurek | Add tensor parallelism support to LFM2 ShortConv layers (#17777) |
| 2026-02-09 00:14:06 | Mick | [diffusion] chore: revise process title (#18446) |

### ğŸ“Š ç»Ÿè®¡æ‘˜è¦
> æœ¬æ—¥å…± 20 ä¸ªæäº¤ | ğŸ”´é«˜ 1 | ğŸŸ¡ä¸­ 12 | ğŸŸ¢ä½ 7
## ğŸ“‹ ç›®å½•

- [sgl-project/sglang](#sgl-project-sglang)
  - [ğŸ“Š ç»Ÿè®¡æ‘˜è¦](#-ç»Ÿè®¡æ‘˜è¦)
  - [ğŸ”´ é«˜é‡è¦åº¦å˜æ›´ (1)](#-ğŸ”´-é«˜é‡è¦åº¦å˜æ›´-1)
    - [fix: fix the wrong return value type of draft model runne...](#a118906)
  - [ğŸŸ¡ ä¸­é‡è¦åº¦å˜æ›´ (12)](#-ğŸŸ¡-ä¸­é‡è¦åº¦å˜æ›´-12)
    - [Pass `quantize_config` to `_initialize_model` (#18273)](#006da22)
    - [feature: support bidirectional attention for Gemma-3  (#1...](#ddbcfba)
    - [[diffusion] chore: fix unclean shutdown and resource leak...](#4f7da5a)
    - [[diffusion] feat: add ModelScope support (#17924)](#76eb1c8)
    - [Revert "optimize get_topk_ragged by fusing get k and k_sc...](#615a02d)
    - [Tiny rename for spec related fileds. (#18468)](#875ad6c)
    - [Make compressed-tensors MoEs support ignored layers (#17828)](#107958a)
    - [[DLLM] Add JointThreshold algorithm for joint M2T and T2T...](#1465224)
    - [[AMD] Update aiter to v0.1.10.post2 (#18423)](#3f3c201)
    - [fix: use --no-build-isolation for human-eval install (#18...](#b564dce)
    - [Refactoring Mooncake TE as a shared distributed component...](#bffd765)
    - [Add tensor parallelism support to LFM2 ShortConv layers (...](#656a3d7)
  - [ğŸŸ¢ ä½é‡è¦åº¦å˜æ›´ (7)](#-ğŸŸ¢-ä½é‡è¦åº¦å˜æ›´-7)
    - [Fix MMLU benchmark to auto-download data and resolve path...](#0b4d4f2)
    - [[AMD] CI - Fix AMD daily image release and install depend...](#28717e3)
    - [[BugFix][PD]Fix metadata_buffer_index leak when aborted i...](#68e31a3)
    - [[ModelOPT] Support Qwen 3 Next Coder NVFP4 (#18224)](#bf89cc3)
    - [Update author information in pyproject.toml (#18453)](#75997eb)
    - [[Kimi-K2.5] Fix missing `quant_config` in `KimiK25` (#18440)](#071bf2c)
    - [[diffusion] chore: revise process title (#18446)](#6601bc2)
#### ğŸ”´ é«˜é‡è¦åº¦å˜æ›´ (1)

### fix: fix the wrong return value type of draft model runner (#18105)
**SHA**: `a118906` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/a1189068faa0a9f0db3ea851b1fe9713d2afeeca)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šBugä¿®å¤  

**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸ”´é«˜  

**ğŸ“‹ å˜æ›´æ‘˜è¦**ï¼š  
- ä¿®æ­£äº† Draft æ¨¡å‹ runner åœ¨ `forward` æ¥å£è¿”å›å€¼çš„ç±»å‹é”™è¯¯ï¼ŒåŸå…ˆé”™è¯¯åœ°è§£åŒ…ä¸º `(logits_output, _)`ï¼Œç°åœ¨ç»Ÿä¸€ä½¿ç”¨ `ModelRunnerOutput.logits_output`ã€‚  
- ä¸ºç›¸å…³æ–‡ä»¶è¡¥å……å’Œå®Œå–„äº† `typing` å¯¼å…¥åŠæ˜¾å¼çš„ç±»å‹æ³¨è§£ï¼ˆå¦‚ `List[ModelRunner]`ï¼‰ï¼Œæå‡ä»£ç å¯è¯»æ€§å’Œé™æ€æ£€æŸ¥å‡†ç¡®æ€§ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**ï¼š  
- `python/sglang/srt/managers/tp_worker.py`ï¼ˆæ¨¡å‹ runner åˆ—è¡¨çš„ç±»å‹æ³¨è§£ï¼‰  
- `python/sglang/srt/speculative/multi_layer_eagle_worker.py`ï¼ˆè¿”å›å€¼å¤„ç†ä¸ `mtp_model_runner` ç­¾åï¼‰  
- `python/sglang/srt/speculative/multi_layer_eagle_worker_v2.py`ï¼ˆ`draft_runner_list` ç±»å‹æ³¨è§£ï¼‰  

**ğŸ” æŠ€æœ¯æ´å¯Ÿ**ï¼š  
- **æ¶æ„å½±å“**ï¼šä»…æ¶‰åŠå†…éƒ¨ç±»å‹å£°æ˜å’Œè¿”å›å€¼è®¿é—®æ–¹å¼ï¼Œæœªæ”¹å˜æ¨¡å—é—´çš„è°ƒç”¨å…³ç³»æˆ–æ•°æ®æµï¼Œæ¶æ„å±‚é¢ä¿æŒä¸å˜ã€‚  
- **æ€§èƒ½å½±å“**ï¼šå»é™¤ä¸å¿…è¦çš„å…ƒç»„è§£åŒ…ï¼Œç›´æ¥è®¿é—®å±æ€§ï¼Œå¾®å°çš„ CPU/å†…å­˜å¼€é”€é™ä½ï¼Œæ•´ä½“æ€§èƒ½åŸºæœ¬æŒå¹³ã€‚  
- **å®‰å…¨è€ƒè™‘**ï¼šä¿®å¤äº†æ½œåœ¨çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆ`TypeError`ï¼‰ï¼Œæå‡äº†ç³»ç»Ÿçš„ç¨³å¥æ€§ï¼Œå¯¹å®‰å…¨æ²¡æœ‰ç›´æ¥å½±å“ã€‚  

**âš ï¸ æ½œåœ¨é£é™©**ï¼š  
1. è‹¥ä»æœ‰æ—§ä»£ç æˆ–ç¬¬ä¸‰æ–¹æ’ä»¶åŸºäºåŸå…ˆçš„ `(logits_output, _)` è§£åŒ…æ–¹å¼ï¼Œå‡çº§åä¼šè§¦å‘ `ValueError`/`TypeError`ã€‚  
2. æ–°å¢çš„ `TYPE_CHECKING` å¯¼å…¥è‹¥ä¸æ…åœ¨è¿è¡Œæ—¶è¢«æ‰§è¡Œï¼Œå¯èƒ½å¯¼è‡´å¾ªç¯å¯¼å…¥ï¼ˆè™½ç„¶ç›®å‰å·²åœ¨ `if TYPE_CHECKING` åŒ…è£¹ï¼‰ï¼Œéœ€ä¿æŒæ­¤å†™æ³•ã€‚  

**ğŸ’¡ å…³æ³¨å»ºè®®**ï¼š  
- **å›å½’æµ‹è¯•**ï¼šé‡ç‚¹è·‘é€šåŒ…å« Draft æ¨¡å‹ runner çš„æ¨ç†è·¯å¾„ï¼ˆ`forward_draft_extend`ã€`forward_draft_extend_after_decode`ï¼‰çš„å•å…ƒ/é›†æˆæµ‹è¯•ï¼Œç¡®è®¤ä¸å†å‡ºç°è§£åŒ…é”™è¯¯ã€‚  
- **æ–‡æ¡£æ›´æ–°**ï¼šåœ¨ `ModelRunner.forward` çš„æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜è¿”å› `ModelRunnerOutput`ï¼Œå¹¶ç¤ºä¾‹ `.logits_output` çš„ä½¿ç”¨æ–¹å¼ï¼Œé˜²æ­¢åç»­è¯¯ç”¨ã€‚  
- **å…¼å®¹æ€§æ£€æŸ¥**ï¼šæœç´¢é¡¹ç›®ä¸­æ‰€æœ‰ `forward(... )` çš„è°ƒç”¨ç‚¹ï¼Œç¡®ä¿æ²¡æœ‰æ®‹ä½™çš„ `_, _ = runner.forward(...)` è§£åŒ…å†™æ³•ã€‚å¦‚æœ‰ï¼Œç»Ÿä¸€æ”¹ä¸ºå±æ€§è®¿é—®ã€‚  
- **ç±»å‹æ£€æŸ¥**ï¼šåœ¨ CI ä¸­åŠ å…¥ `mypy --strict` æˆ–ç±»ä¼¼å·¥å…·ï¼Œç¡®ä¿æ–°å¢çš„ç±»å‹æ³¨è§£å¾—åˆ°éªŒè¯ï¼Œå‡å°‘æœªæ¥ç±»ä¼¼é—®é¢˜ã€‚  

---

#### ğŸŸ¡ ä¸­é‡è¦åº¦å˜æ›´ (12)

### Pass `quantize_config` to `_initialize_model` (#18273)
**SHA**: `006da22` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/006da2226864f64726cfe501fdde49c5a11e9c41)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼º  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  

**ğŸ“‹ å˜æ›´æ‘˜è¦**  
- å°†é‡åŒ–é…ç½®çš„è·å–æŠ½å–åˆ° `_get_quantization_config`ï¼Œå¹¶åœ¨æ‰€æœ‰æ¨¡å‹å®ä¾‹åŒ–å…¥å£ç»Ÿä¸€è°ƒç”¨ã€‚  
- ç°åœ¨ `_initialize_model` æ¥æ”¶ `quant_config` å‚æ•°ï¼Œå†…éƒ¨ä¸å†è‡ªè¡Œæ„é€  `packed_modules_mapping`ã€`remap_prefix`ï¼Œè€Œæ˜¯ç”± `_get_quantization_config` æå‰å‡†å¤‡ã€‚  
- ä¸º NPU åœºæ™¯è¡¥å……äº†ä¸“å±çš„ `packed_modules_mapping`ï¼Œå¹¶åœ¨è·å–é‡åŒ–é…ç½®åé€šè¿‡ `hf_to_sglang_mapper` å°†æƒé‡åæ˜ å°„æ³¨å…¥ `QuantizationConfig`ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**  
- `python/sglang/srt/model_loader/loader.py` ä¸­çš„æ¨¡å‹åŠ è½½é€»è¾‘ï¼ˆåŒ…æ‹¬æ™®é€šåŠ è½½ã€metaâ€‘deviceã€remoteâ€‘loaderã€CPUâ€‘quantã€torchaoâ€‘load ç­‰å…¨éƒ¨åˆ†æ”¯ï¼‰ã€‚  
- ä¾èµ– `_initialize_model` çš„å¤–éƒ¨è°ƒç”¨ç‚¹ç°åœ¨å¿…é¡»ä¼ å…¥ `quant_config`ï¼ˆå·²æœ‰é»˜è®¤ `None`ï¼‰ï¼Œä½†æ•´ä½“è¡Œä¸ºä¿æŒå‘åå…¼å®¹ã€‚  

**ğŸ’¡ å…³æ³¨å»ºè®®**  
1. **æµ‹è¯•è¦†ç›–**ï¼šæ–°å¢æˆ–æ‰©å±•å•å…ƒæµ‹è¯•ï¼ŒéªŒè¯åœ¨å¼€å¯/å…³é—­é‡åŒ–ã€åœ¨ NPU ä¸é NPU ç¯å¢ƒä¸‹ï¼Œ`quant_config` èƒ½æ­£ç¡®ä¼ é€’å¹¶ä½œç”¨äºæ¨¡å‹ã€‚  
2. **æ–‡æ¡£æ›´æ–°**ï¼šåœ¨æ¨¡å‹åŠ è½½è¯´æ˜ä¸­è¡¥å…… `quant_config` å‚æ•°çš„æ„ä¹‰ã€è·å–æ–¹å¼ä»¥åŠ NPU ç‰¹æœ‰çš„æ˜ å°„è§„åˆ™ã€‚  
3. **æ€§èƒ½æ£€æŸ¥**ï¼šç¡®è®¤åœ¨å¤§é‡æ¨¡å‹å¹¶å‘åŠ è½½æ—¶ï¼Œé¢å¤–çš„ `_get_quantization_config` è°ƒç”¨ä¸ä¼šå¼•å…¥æ˜¾è‘—å¼€é”€ï¼Œå°¤å…¶æ˜¯å¯¹ `packed_modules_mapping` çš„åŠ¨æ€ `update`ã€‚  
4. **å¼‚å¸¸å®¹é”™**ï¼šè‹¥æ¨¡å‹ç±»ç¼ºå°‘ `hf_to_sglang_mapper` æˆ– `packed_modules_mapping`ï¼Œå½“å‰å®ç°ä»å¯å·¥ä½œï¼Œä½†å»ºè®®åœ¨æ—¥å¿—ä¸­ç»™å‡ºæ˜ç¡®æç¤ºï¼Œé˜²æ­¢ç”¨æˆ·è¯¯ä»¥ä¸ºå·²å®Œæˆæ˜ å°„ã€‚  

æ€»ä½“è€Œè¨€ï¼Œæ­¤æ¬¡æ”¹åŠ¨ä½¿é‡åŒ–é…ç½®çš„ç”Ÿæˆä¸æ¨¡å‹å®ä¾‹åŒ–è§£è€¦ï¼Œä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œåç»­æ‰©å±•é‡åŒ–ç­–ç•¥æˆ–ç¡¬ä»¶é€‚é…æ—¶æ›´æ˜“ç»´æŠ¤ã€‚åªè¦è¡¥é½ç›¸åº”æµ‹è¯•ä¸æ–‡æ¡£ï¼Œå³å¯æ”¾å¿ƒåˆå¹¶ã€‚

---

### feature: support bidirectional attention for Gemma-3  (#10707)
**SHA**: `ddbcfba` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/ddbcfbaaabce5a014da22bb4ae7c320128dc10b9)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼º  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  
**ğŸ“‹ å˜æ›´æ‘˜è¦**ï¼šåœ¨ Triton Attention Backend ä¸­åŠ å…¥å¯¹ Gemmaâ€‘3 å¤šæ¨¡æ€æ¨¡å‹çš„**åŒå‘æ³¨æ„åŠ›**æ”¯æŒï¼Œæ–°å¢ `DECODER_BIDIRECTIONAL` æ³¨æ„åŠ›ç±»å‹å¹¶åœ¨æ¨¡å‹å±‚å’Œ mask ç”Ÿæˆé€»è¾‘ä¸­å®ç°å¯¹åº”è·¯å¾„ï¼›æ–‡æ¡£åŒæ­¥è¯´æ˜ä½¿ç”¨æ–¹å¼åŠå…¼å®¹æ€§é™åˆ¶ã€‚  
**ğŸ¯ å½±å“èŒƒå›´**ï¼š  
- `sglang/srt/layers/attention/triton_backend.py`ï¼ˆæ–°å¢ `allow_bidirectional_attention_in_extend` ä¸ç›¸å…³åˆ¤æ–­ï¼‰  
- `sglang/srt/layers/radix_attention.py`ï¼ˆæšä¸¾æ‰©å±•ï¼‰  
- `sglang/srt/models/gemma3_causal.py`ï¼ˆæ”¹ä¸º `DECODER_BIDIRECTIONAL`ï¼Œå»é™¤æ—§çš„æ‰‹å†™æ³¨æ„åŠ›å®ç°ï¼‰  
- `sglang/srt/models/gemma3_mm.py`ï¼ˆåœ¨ Extend æ¨¡å¼ä¸‹ä¸º Triton åç«¯ç”Ÿæˆè‡ªå®šä¹‰åŒå‘ maskï¼‰  
- æ–‡æ¡£ `multimodal_language_models.md`ï¼ˆä½¿ç”¨ç¤ºä¾‹ä¸æ³¨æ„äº‹é¡¹ï¼‰  

**ğŸ’¡ å…³æ³¨å»ºè®®**  
1. **å…¼å®¹æ€§**ï¼šåŒå‘æ³¨æ„åŠ›ä»…åœ¨ Triton åç«¯ã€ä¸” **å…³é—­ CUDA Graph ä¸ Chunked Prefill** æ—¶å¯ç”¨ï¼›å…¶ä»–åç«¯ä»å›é€€ä¸ºå› æœæ³¨æ„åŠ›ã€‚åŠ¡å¿…åœ¨å¯åŠ¨è„šæœ¬ä¸­åŠ å…¥ `--attention-backend triton --disable-cuda-graph --chunked-prefill-size -1`ã€‚  
2. **æ€§èƒ½/å‡†ç¡®åº¦**ï¼šå…³é—­ CUDA Graph/Chunked Prefill ä¼šé™ä½ååï¼Œè‹¥ä¸šåŠ¡å¯¹å»¶è¿Ÿæ•æ„Ÿå¯æ”¹ç”¨å…¶ä»–åç«¯ï¼Œä½†ä¼šç‰ºç‰² Gemmaâ€‘3 çš„å›¾åƒâ€‘å›¾åƒåŒå‘äº¤äº’æ•ˆæœã€‚  
3. **æµ‹è¯•**ï¼šå»ºè®®æ–°å¢å•å…ƒæµ‹è¯•éªŒè¯ `forward_extend` åœ¨ `layer.attn_type == DECODER_BIDIRECTIONAL` ä¸” `allow_bidirectional_attention_in_extend=True` æ—¶ç”Ÿæˆçš„ mask ä¸æœŸæœ›çš„åŒå‘ç»“æ„ä¸€è‡´ï¼›åŒæ—¶å¯¹é Triton åç«¯ä¿æŒå‘åå…¼å®¹ã€‚  
4. **ç›‘æ§**ï¼šä¸Šçº¿åç›‘æ§æ˜¾å­˜å ç”¨å’Œå»¶æ—¶ï¼ŒåŒå‘æ³¨æ„åŠ›åœ¨é¢„å¡«é˜¶æ®µä¼šæ˜¾è‘—å¢åŠ  KV é•¿åº¦ï¼Œå¯èƒ½å¯¼è‡´ OOMã€‚å¯é€šè¿‡è°ƒä½ `max_pixels` ç­‰ multimodal å‚æ•°ç¼“è§£ã€‚  
5. **æ–‡æ¡£**ï¼šæ–‡æ¡£å·²åŠ å…¥ç¤ºä¾‹ï¼Œå»ºè®®åœ¨ Release Notes ä¸­å¼ºè°ƒ â€œä»… Triton + ç¦ç”¨ CUDA Graph/Chunked Prefill æ”¯æŒ Gemmaâ€‘3 åŒå‘æ³¨æ„åŠ›â€ã€‚  

æ€»ä½“è€Œè¨€ï¼Œæ­¤æ¬¡æ”¹åŠ¨ä¸º Gemmaâ€‘3 å¤šæ¨¡æ€æœåŠ¡æä¾›äº†å…³é”®çš„æ³¨æ„åŠ›ç‰¹æ€§ï¼Œå½±å“èŒƒå›´é›†ä¸­åœ¨æ³¨æ„åŠ›åç«¯å’Œ Gemmaâ€‘3 ç›¸å…³æ¨¡å‹ï¼Œä½¿ç”¨å‰åŠ¡å¿…ç¡®è®¤å¯åŠ¨å‚æ•°ä¸ç¡¬ä»¶èµ„æºã€‚

---

### [diffusion] chore: fix unclean shutdown and resource leaks (#18477)
**SHA**: `4f7da5a` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/4f7da5ad0f5e8215973ca74d9d8b86e73f6d761f)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼º / Bug ä¿®å¤  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  

**ğŸ“‹ å˜æ›´æ‘˜è¦**  
1. æ–°å¢ `ShutdownReq` æ¶ˆæ¯ç±»å‹ï¼Œä»¥åœ¨æœ¬åœ°æ¨¡å¼ä¸‹ä¸»åŠ¨å‘ scheduler å‘é€å…³é—­æŒ‡ä»¤ï¼Œå®ç°â€œå¹²å‡€â€é€€å‡ºã€‚  
2. `DiffusionGenerator.shutdown` åœ¨æ‹¥æœ‰ scheduler å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹å‘é€ `ShutdownReq`ï¼Œå¹¶åœ¨ `launch_server` è¿”å›å­è¿›ç¨‹åˆ—è¡¨ä¾›å¤–éƒ¨ç»Ÿä¸€ç®¡ç†ã€‚  
3. Scheduler æ¥æ”¶åˆ° `ShutdownReq` ååœæ­¢å¾ªç¯ï¼›åœ¨ç»“æŸæ—¶æ”¹ç”¨ `context.destroy(linger=0)` é˜²æ­¢é˜»å¡ã€‚  
4. GPU worker é€€å‡ºæ—¶æ˜¾å¼é‡Šæ”¾ CUDAã€åˆ†å¸ƒå¼èµ„æºå¹¶å¼ºåˆ¶ GCï¼Œå‡å°‘æ®‹ç•™æ˜¾å­˜æ³„æ¼ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**  
- `python/sglang/multimodal_gen/runtime/entrypoints/diffusion_generator.py`  
- `python/sglang/multimodal_gen/runtime/entrypoints/openai/utils.py`ï¼ˆæ–°å¢ `ShutdownReq`ï¼‰  
- `python/sglang/multimodal_gen/runtime/launch_server.py`ï¼ˆè¿”å›è¿›ç¨‹åˆ—è¡¨ï¼‰  
- `python/sglang/multimodal_gen/runtime/managers/gpu_worker.py`ï¼ˆèµ„æºæ¸…ç†ï¼‰  
- `python/sglang/multimodal_gen/runtime/managers/scheduler.py`ï¼ˆæ–°å¢è¯·æ±‚å¤„ç†ã€ZMQ å…³é—­æ–¹å¼ï¼‰  

**ğŸ’¡ å…³æ³¨å»ºè®®**  

1. **`sync_scheduler_client` çš„å¯è§æ€§**  
   `DiffusionGenerator.shutdown` ä¸­ç›´æ¥ä½¿ç”¨ `sync_scheduler_client`ï¼Œä½†å…¶åœ¨è¯¥æ–‡ä»¶ä¸­æœªæ˜¾å¼å¯¼å…¥æˆ–å£°æ˜ã€‚å»ºè®®æ”¹ä¸º `self.sync_scheduler_client`ï¼ˆè‹¥å·²åœ¨ç±»ä¸­ä¿å­˜ï¼‰ï¼Œæˆ–åœ¨å‡½æ•°é¡¶éƒ¨ `from .openai.utils import sync_scheduler_client`ï¼Œé¿å… `NameError`ã€‚  

2. **å¼‚å¸¸å¤„ç†**  
   å‘é€ `ShutdownReq` æ—¶æ•è·äº†æ‰€æœ‰å¼‚å¸¸å¹¶åæ‰ï¼Œæ˜“æ©ç›–çœŸå®é”™è¯¯ã€‚å»ºè®®è‡³å°‘è®°å½•æ—¥å¿— `logger.debug("Shutdown request failed", exc_info=True)`ï¼Œä¾¿äºè°ƒè¯•ã€‚  

3. **è¿›ç¨‹è¿”å›å€¼çš„ä½¿ç”¨**  
   `launch_server` ç°åœ¨è¿”å› `processes`ï¼Œä½†è°ƒç”¨æ–¹éœ€ç›¸åº”ä¿®æ”¹ã€‚è‹¥å·²æœ‰è°ƒç”¨æ–¹ä»ä¿æŒæ—§ç­¾åï¼Œä¼šå¯¼è‡´ `NoneType` é”™è¯¯ã€‚è¯·åœ¨é¡¹ç›®æ–‡æ¡£æˆ–è°ƒç”¨æ–¹ä»£ç ä¸­åŒæ­¥æ›´æ–°ã€‚  

4. **ZMQ å…³é—­é¡ºåº**  
   Scheduler ç»“æŸå¾ªç¯åç›´æ¥ `context.destroy(linger=0)`ï¼Œè‹¥è¿˜æœ‰æœªå®Œæˆçš„ `socket.send` å¯èƒ½å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚å»ºè®®å…ˆç¡®ä¿ `receiver.close()`ã€`sender.close()`ï¼ˆå¦‚æœ‰ï¼‰å†é”€æ¯ä¸Šä¸‹æ–‡ï¼Œæˆ–åœ¨ `linger=0` å‰åŠ å…¥å¿…è¦çš„åŒæ­¥ç­‰å¾…ã€‚  

5. **GPU èµ„æºå›æ”¶çš„å®Œæ•´æ€§**  
   `gpu_worker` ä¸­çš„ `torch.cuda.empty_cache()` ä¸ `torch.distributed.destroy_process_group()` å·²åŠ å…¥ï¼Œä½†è‹¥ä½¿ç”¨ NCCLã€MPI ç­‰å…¶å®ƒåç«¯ï¼Œå¯èƒ½ä»æ®‹ç•™è¿›ç¨‹ã€‚å»ºè®®åœ¨ `finally` ä¸­åŠ å…¥ `torch.cuda.reset_peak_memory_stats()`ï¼ˆå¯é€‰ï¼‰å¹¶ç¡®è®¤æ‰€æœ‰å­è¿›ç¨‹å·² `join`ã€‚  

6. **å•å…ƒæµ‹è¯• / CI**  
   å¢åŠ  `ShutdownReq` é€»è¾‘åï¼Œå»ºè®®è¡¥å……/æ›´æ–°ä»¥ä¸‹æµ‹è¯•ï¼š  
   - æœ¬åœ°æ¨¡å¼ä¸‹è°ƒç”¨ `DiffusionGenerator.shutdown`ï¼Œç¡®è®¤ scheduler è¿›ç¨‹é€€å‡ºä¸” `process.is_alive() == False`ã€‚  
   - å¤šè¿›ç¨‹æƒ…å†µä¸‹ï¼Œç¡®ä¿ ZMQ sockets æ­£å¸¸å…³é—­ï¼Œä¸æŠ› `ZMQError`.  

7. **æ–‡æ¡£**  
   åœ¨ç”¨æˆ·æ‰‹å†Œæˆ– API æ–‡æ¡£ä¸­è¯´æ˜ `DiffusionGenerator.shutdown` ç°åœ¨ä¼šä¸»åŠ¨é€šçŸ¥è°ƒåº¦å™¨ï¼ŒåŠ `launch_server` è¿”å›å€¼çš„å«ä¹‰ï¼Œå¸®åŠ©ä½¿ç”¨è€…æ­£ç¡®ç®¡ç†è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸã€‚  

æ€»ä½“è€Œè¨€ï¼Œæ­¤æ¬¡æ”¹åŠ¨åœ¨èµ„æºå›æ”¶å’Œå®‰å…¨å…³é—­æ–¹é¢æä¾›äº†å®è´¨æ€§æ”¹è¿›ï¼Œä½†éœ€ç•™æ„ä¸Šè¿°ç»†èŠ‚ä»¥é˜²æ­¢è¿è¡Œæ—¶å¼‚å¸¸å’Œæ½œåœ¨çš„èµ„æºæ³„æ¼ã€‚

---

### [diffusion] feat: add ModelScope support (#17924)
**SHA**: `76eb1c8` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/76eb1c8406bc4a73cec05f516093ef80d8e56387)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼ºï¼ˆæ–°å¢ ModelScope ä¸‹è½½å…¼å®¹ï¼‰  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  

**ğŸ“‹ å˜æ›´æ‘˜è¦**  
- é€šè¿‡ `envs.SGLANG_USE_MODELSCOPE` å¼€å…³åœ¨ HuggingFace Hub ä¸ ModelScope ä¹‹é—´åˆ‡æ¢ä¸‹è½½å®ç°ã€‚  
- åœ¨ `cli/utils.py`ã€`webui/main.py`ã€`hf_diffusers_utils.py` ä¸­ç»Ÿä¸€å°è£… `hf_hub_download`ã€`snapshot_download`ï¼Œå¹¶åœ¨æ—¥å¿—ä¸­æ ‡è¯†æ¥æºã€‚  
- æ–°å¢å¯¹ ModelScope `HubApi` ä¸ `model_file_download` çš„è°ƒç”¨ï¼Œå…¼å®¹æ¨¡å‹ä¿¡æ¯è·å–å’Œæ–‡ä»¶ä¸‹è½½ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**  
- **æ¨¡å‹ä¸‹è½½/æ ¡éªŒ**ï¼š`sglang.multimodal_gen.runtime.utils.hf_diffusers_utils`ã€`sglang.cli.utils`ã€‚  
- **WebUI å¯åŠ¨**ï¼š`sglang.multimodal_gen.apps.webui.main`ï¼ˆæ¨¡å‹ä»»åŠ¡æ ‡ç­¾è·å–ï¼‰ã€‚  
- **ç¯å¢ƒé…ç½®**ï¼š`sglang.srt.environ.envs` æ–°å¢/ä½¿ç”¨ `SGLANG_USE_MODELSCOPE`ã€‚  

**ğŸ’¡ å…³æ³¨å»ºè®®**  
1. **é»˜è®¤å®‰å…¨**ï¼šç¡®ä¿ `SGLANG_USE_MODELSCOPE` é»˜è®¤ `False`ï¼Œé¿å…æ„å¤–åˆ‡æ¢å¯¼è‡´åŸæœ‰ CI å¤±æ•ˆã€‚  
2. **å¼‚å¸¸å¤„ç†**ï¼šModelScope ä¸‹è½½å¤±è´¥æ—¶åº”ä¿æŒä¸ HF ç›¸åŒçš„é”™è¯¯ä¿¡æ¯ç»“æ„ï¼Œé˜²æ­¢ä¸Šå±‚æ•è·ä¸åˆ°ã€‚  
3. **ä¾èµ–ç®¡ç†**ï¼šåœ¨ `requirements.txt` ä¸­æ˜ç¡® `modelscope` çš„ç‰ˆæœ¬èŒƒå›´ï¼Œå¹¶åœ¨ CI ä¸­åŠ å…¥å¯¹åº”çš„è£…è£…æ­¥éª¤ã€‚  
4. **æµ‹è¯•è¦†ç›–**ï¼šæ–°å¢å•å…ƒ/é›†æˆæµ‹è¯•ï¼Œåˆ†åˆ«èµ° HF ä¸ ModelScope ä¸¤æ¡è·¯å¾„ï¼ŒéªŒè¯ `model_index.json`ã€`config.json` ä¸å®Œæ•´æ¨¡å‹ç›®å½•çš„ä¸‹è½½å®Œæ•´æ€§ã€‚  
5. **æ–‡æ¡£æ›´æ–°**ï¼šåœ¨ README ä¸ API æ–‡æ¡£ä¸­è¯´æ˜ `SGLANG_USE_MODELSCOPE` çš„ä½¿ç”¨åœºæ™¯ã€ç¯å¢ƒå˜é‡è®¾ç½®æ–¹å¼åŠå¯èƒ½çš„é™åˆ¶ï¼ˆå¦‚æ¨¡å‹ä»»åŠ¡æ ‡ç­¾ä»…åœ¨ HF æœ‰æ—¶å¯ç”¨ï¼‰ã€‚  

æ•´ä½“æ¥çœ‹ï¼Œæ”¹åŠ¨é›†ä¸­åœ¨ä¸‹è½½å±‚é¢ï¼Œé€»è¾‘æ¸…æ™°ä½†éœ€åŠ å¼ºè·¨å¹³å°é”™è¯¯ç»Ÿä¸€å’Œ CI å…¼å®¹æ€§ï¼Œä»¥é˜²åœ¨æœªæ˜¾å¼å¼€å¯ ModelScope æ—¶å‡ºç°éšè”½å›å½’ã€‚

---

### Revert "optimize get_topk_ragged by fusing get k and k_scale triton kernel" (#18471)
**SHA**: `615a02d` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/615a02dcd45adf875de698d2ba66b1cbef161aa5)

**å˜æ›´æ¦‚è§ˆ**  
æœ¬æ¬¡æäº¤æ’¤é”€äº†ä¹‹å‰çš„ â€œåœ¨ Triton kernel ä¸­åŒæ—¶è·å– K ä¸ kâ€‘scale å¹¶æ”¯æŒ batchâ€‘levelâ€¯seq_lenâ€ çš„å®ç°ï¼Œå›é€€ä¸ºæ›´ç®€åŒ–çš„å•åºåˆ—ç‰ˆæœ¬ã€‚æ ¸å¿ƒæ”¹åŠ¨åŒ…æ‹¬ï¼š

1. **`index_buf_accessor.triton`**  
   - å‚æ•°ç”± `(seq_len_tensor, seq_len_sum, max_seq_len)` ç²¾ç®€ä¸º `seq_len`ï¼Œå»æ‰äº† batchâ€‘çº§åˆ«çš„é•¿åº¦ä¿¡æ¯ã€‚  
   - ç›´æ¥ä»¥ token æ€»æ•°ä¸º gridï¼Œåˆ é™¤äº†å¯¹ `seq_len_ptr`ã€`seq_len_num_pow`ã€`page_indice_batch_offset` çš„åŠ è½½ä¸è®¡ç®—ã€‚  

2. **`_get_k_and_s_triton` / kernel**  
   - åªä¿ç•™ `token_id = tl.program_id(0)`ï¼Œçœå»æ‰¹æ¬¡åç§»ã€åºåˆ—é•¿åº¦æ£€æŸ¥ç­‰åˆ†æ”¯ã€‚  
   - `k`ã€`s` çš„å†™å…¥ç›´æ¥æŒ‰ `token_id * dim` å­˜æ”¾ï¼Œå»æ‰äº†åŸæ¥çš„ `seq_len` æ©ç ã€‚  

3. **è°ƒç”¨ä¾§æ”¹åŠ¨**  
   - `NSATokenToKVPool.get_index_k_scale_buffer` å‚æ•°ä» `seq_len_tensor, seq_len_sum, max_seq_len` æ”¹ä¸ºå•ä¸€ `seq_len`ã€‚  
   - `NSAIndex._get_topk_ragged` é‡æ–°ç»„ç»‡å¾ªç¯ï¼šå¯¹æ¯ä¸ª batch å•ç‹¬è°ƒç”¨ `get_index_k_scale_buffer`ï¼Œéšå `cat` åˆå¹¶ç»“æœã€‚  
   - ç§»é™¤ `enable_dual_stream` å‚æ•°ä»¥åŠå¯¹ `forward_batch.seq_lens_cpu`â€¯ç­‰å­—æ®µçš„ä¾èµ–ã€‚  

4. **æµ‹è¯•æ›´æ–°**  
   - åˆ é™¤äº†åŸæ¥é’ˆå¯¹å¤š batch åœºæ™¯çš„å®Œæ•´åŸºå‡†æµ‹è¯•ï¼Œåªä¿ç•™é’ˆå¯¹å•åºåˆ—çš„æ­£ç¡®æ€§éªŒè¯ã€‚  

**å½±å“èŒƒå›´**  
- `sglang/srt/layers/attention/nsa/*`ï¼ˆç´¢å¼•è¯»å–ã€Topâ€‘k è®¡ç®—ï¼‰ã€‚  
- `sglang/srt/mem_cache/memory_pool.py`ï¼ˆå†…å­˜æ± å¯¹å¤– APIï¼‰ã€‚  
- ç›¸å…³å•å…ƒæµ‹è¯• `test_manual/.../test_index_buf_accessor.py`ã€‚  

**æ½œåœ¨é£é™© & å»ºè®®**  

| é£é™© | è¯´æ˜ | å»ºè®® |
|------|------|------|
| **åŠŸèƒ½å›é€€** | å¤±å»ä¸€æ¬¡æ€§è·å–å¤šä¸ª batch çš„èƒ½åŠ›ï¼Œå¯èƒ½å¯¼è‡´åŸå…ˆä¾èµ–è¯¥ç‰¹æ€§çš„ä»£ç åœ¨é«˜å¹¶å‘æ¨ç†åœºæ™¯ä¸‹å‡ºç°æ€§èƒ½å›é€€æˆ– OOMã€‚ | ä¿ç•™å…¼å®¹å±‚ï¼šå®ç°ä¸€ä¸ªåŒ…è£…å‡½æ•°åœ¨å†…éƒ¨ä»ç„¶ä»¥å¾ªç¯æ–¹å¼è°ƒç”¨å•åºåˆ— kernelï¼Œä»¥å…¼å®¹æ—§æ¥å£ã€‚ |
| **è¾¹ç•Œæ£€æŸ¥ç¼ºå¤±** | Triton kernel ç°åœ¨ä¸å†æ£€æŸ¥ `token_id >= seq_len`ï¼Œè‹¥è°ƒç”¨æ–¹ä¼ å…¥çš„ `seq_len` å¤§äºå®é™…é¡µé¢å¯ç”¨ token æ•°ï¼Œä¼šå‡ºç°éæ³•è¯»å–ã€‚ | åœ¨ Python è°ƒç”¨å‰åŠ å…¥æ˜¾å¼æ ¡éªŒ `seq_len <= page_indices.numel() * page_size`ã€‚ |
| **æ–‡æ¡£/æ¥å£ä¸ä¸€è‡´** | `get_index_k_scale_buffer` å‚æ•°ç­¾åæ”¹å˜ï¼Œæ—§ä»£ç ä»å¯èƒ½ä½¿ç”¨æ—§ç­¾åç¼–è¯‘é€šè¿‡ï¼ˆå›  *args*ï¼‰ï¼Œä½†è¿è¡Œæ—¶ä¼šæŠ¥é”™ã€‚ | æ›´æ–°æ‰€æœ‰è°ƒç”¨ç‚¹çš„ç±»å‹ç­¾åå¹¶åœ¨ `memory_pool.py` æ·»åŠ æ³¨é‡Šè¯´æ˜å·²åºŸå¼ƒçš„å‚æ•°ã€‚ |
| **æµ‹è¯•è¦†ç›–ä¸è¶³** | åªä¿ç•™äº†å•åºåˆ—çš„æ­£ç¡®æ€§æµ‹è¯•ï¼ŒæœªéªŒè¯åœ¨çœŸå®æ¨ç†æµæ°´çº¿ä¸­å¤š batch åœºæ™¯çš„è¡Œä¸ºã€‚ | æ–°å¢é›†æˆæµ‹è¯•ï¼Œæ¨¡æ‹Ÿ `forward_batch` ä¸­å¤šä¸ª batch çš„ Topâ€‘k è®¡ç®—ï¼Œç¡®ä¿ `cat` åˆå¹¶åçš„å¼ é‡å½¢çŠ¶ã€æ•°å€¼ä¸åŸå®ç°ä¸€è‡´ã€‚ |
| **æ€§èƒ½å›é€€** | å»æ‰äº†åŸæ¥çš„ `seq_len_num_pow` æ©ç ä¸æ‰¹æ¬¡åç§»è®¡ç®—ï¼Œè™½ç„¶ä»£ç æ›´ç®€æ´ï¼Œä½†åœ¨æ‰¹é‡è°ƒç”¨æ—¶ä¼šäº§ç”Ÿé¢å¤–çš„ Python å¾ªç¯å’Œå¤šæ¬¡ kernel å¯åŠ¨ï¼Œå¯èƒ½å¢åŠ å¼€é”€ã€‚ | åœ¨å…³é”®è·¯å¾„ä¸ŠåšåŸºå‡†å¯¹æ¯”ï¼Œè‹¥å›é€€æ˜æ˜¾ï¼Œåº”è€ƒè™‘åœ¨å†…éƒ¨å®ç°æ‰¹é‡ kernelï¼ˆæ¢å¤ `grid = (batch, max_seq_len)`ï¼‰ä½œä¸ºå¯é€‰åŠ é€Ÿè·¯å¾„ã€‚ |

**æ€»ç»“**  
æ­¤æ¬¡å›é€€ç®€åŒ–äº† Triton kernel ä¸è°ƒç”¨å±‚çš„æ¥å£ï¼Œé™ä½äº†å®ç°å¤æ‚åº¦ï¼Œä½†ä¹Ÿç‰ºç‰²äº†åŸæœ‰çš„ batchâ€‘level èåˆä¼˜åŒ–ã€‚ä¸ºé¿å…åŠŸèƒ½å›é€€å¯¼è‡´çš„æ€§èƒ½ä¸å¯é æ€§é—®é¢˜ï¼Œå»ºè®®åœ¨åº“å±‚æä¾›å‘åå…¼å®¹çš„æ‰¹å¤„ç†åŒ…è£…ï¼Œå¹¶åœ¨æ–‡æ¡£ä¸æµ‹è¯•ä¸­æ˜ç¡®è¯´æ˜æ–°æ—§æ¥å£çš„å·®å¼‚åŠä½¿ç”¨åœºæ™¯ã€‚è‹¥åç»­éœ€è¦æ¢å¤æ‰¹é‡åŠ é€Ÿï¼Œå¯åœ¨ä¿æŒå½“å‰å•åºåˆ—å®ç°çš„åŸºç¡€ä¸Šï¼Œé€æ­¥å¼•å…¥æ‰¹é‡è°ƒåº¦çš„å¯é€‰å®ç°ã€‚

---

### Tiny rename for spec related fileds. (#18468)
**SHA**: `875ad6c` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/875ad6cf3542c212a8a493e2f202820b9b7143d8)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šé‡æ„ï¼ˆå­—æ®µå‘½åå¾®è°ƒï¼‰  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  
**ğŸ“‹ å˜æ›´æ‘˜è¦**ï¼šå°†é¹°ï¼ˆEagleï¼‰æ¨ç†ç›¸å…³ç»“æ„ä½“ä¸­ `num_tokens_per_batch`ã€`num_tokens_for_logprob_per_batch` ç­‰å­—æ®µç»Ÿä¸€æ”¹åä¸º `num_tokens_per_req`ã€`num_tokens_for_logprob_per_req`ï¼Œå¹¶åœ¨å…¨éƒ¨è°ƒç”¨å¤„åŒæ­¥æ›¿æ¢ã€‚  
**ğŸ¯ å½±å“èŒƒå›´**ï¼š  
- `sglang/srt/speculative/*`ï¼ˆEagle è¾“å…¥/è¾“å‡ºæ¨¡å‹ï¼‰  
- `sglang/srt/model_executor/forward_batch_info.py`  
- `sglang/srt/layers/attention/flashattention_backend.py`  
- å¤šå±‚ Eagle worker ä¸ CUDAâ€‘graph runner ç­‰å®ç°  

**ğŸ’¡ å…³æ³¨å»ºè®®**ï¼š  
1. **å…¼å®¹æ€§æ£€æŸ¥**ï¼šç¡®ä¿æ¨¡å‹åºåˆ—åŒ–ã€æ—¥å¿—ã€é…ç½®æ–‡ä»¶ä»¥åŠå¤–éƒ¨è°ƒç”¨ä»èƒ½è¯»å–/å†™å…¥æ–°ç‰ˆå­—æ®µï¼›è‹¥ä»éœ€è¦æ”¯æŒæ—§å­—æ®µï¼Œè€ƒè™‘åœ¨ `__post_init__` ä¸­æ·»åŠ å…¼å®¹è½¬æ¢ã€‚  
2. **æµ‹è¯•è¦†ç›–**ï¼šå®Œæ•´è¿è¡Œå•å…ƒä¸é›†æˆæµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠ speculative æ¨ç†çš„è·¯å¾„ï¼ˆdraftã€extendã€verifyï¼‰ï¼Œé˜²æ­¢é—æ¼çš„å±æ€§å¼•ç”¨å¯¼è‡´è¿è¡Œæ—¶ `AttributeError`ã€‚  
3. **æ–‡æ¡£ä¸ç¤ºä¾‹æ›´æ–°**ï¼šæ‰€æœ‰ API æ–‡æ¡£ã€READMEã€è„šæœ¬ä¸­å‡ºç°çš„ `num_tokens_per_batch` å­—æ®µéœ€åŒæ­¥ä¿®æ”¹ä¸º `num_tokens_per_req`ã€‚  
4. **ä»£ç å®¡æŸ¥**ï¼šæ£€æŸ¥æ˜¯å¦æœ‰åŠ¨æ€å±æ€§è®¿é—®ï¼ˆ`getattr`ï¼‰ä½¿ç”¨äº†æ—§åç§°çš„ç¡¬ç¼–ç ï¼Œå·²åœ¨ `flashattention_backend.py` ä¸­ä¿®æ­£ã€‚  
5. **å›æ»šæ–¹æ¡ˆ**ï¼šè‹¥å‡ºç°æ„å¤–å…¼å®¹é—®é¢˜ï¼Œå¯é€šè¿‡åœ¨æ—§å­—æ®µä¸Šæ·»åŠ å±æ€§åˆ«åæˆ–åœ¨åŠ è½½æ—¶è‡ªåŠ¨æ˜ å°„å›æ–°åç§°ã€‚  

æ€»ä½“è€Œè¨€ï¼Œæ­¤æ¬¡æ”¹åŠ¨ä»…æ˜¯å‘½åå±‚é¢çš„æ¸…æ™°åŒ–ï¼Œå¯¹åŠŸèƒ½æ— ç›´æ¥å½±å“ï¼Œå…³é”®åœ¨äºç¡®ä¿æ‰€æœ‰å¼•ç”¨å‡å·²æ›´æ–°å¹¶é€šè¿‡å®Œæ•´æµ‹è¯•ã€‚

---

### Make compressed-tensors MoEs support ignored layers (#17828)
**SHA**: `107958a` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/107958a4894646deac7bcf81306e5ee084a575ab)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼º / ä»£ç é‡æ„  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  

**ğŸ“‹ å˜æ›´æ‘˜è¦**  
1. åœ¨ `compressed_tensors.py` ä¸­å°†å±‚å¿½ç•¥é€»è¾‘ä» `get_quant_method` ç§»è‡³ç»Ÿä¸€çš„ `get_scheme_dict`ï¼Œå¹¶æ–°å¢ `_add_fused_moe_to_target_scheme_map` è¾…åŠ©å‡½æ•°ï¼Œä»¥ä¾¿åœ¨ Linear è¢«èåˆä¸º `FusedMoE` æ—¶è‡ªåŠ¨æ˜ å°„ç›®æ ‡é‡åŒ–æ–¹æ¡ˆã€‚  
2. `compressed_tensors_moe.py` å¢åŠ å¯¹ `FusedMoE` çš„ç‰¹æ®Šå¤„ç†ï¼šåœ¨è·å–ä¸“å®¶å±‚çš„é‡åŒ–æ–¹æ¡ˆæ—¶ç»Ÿä¸€æ£€æŸ¥å¹¶åœ¨å…¨éƒ¨è¢«å¿½ç•¥æ—¶è¿”å› `UnquantizedFusedMoEMethod`ï¼ŒåŒæ—¶å¯¹å¤šä¸“å®¶æ–¹æ¡ˆä¸ä¸€è‡´æŠ›å¼‚å¸¸ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**  
- `sglang.srt.layers.quantization.compressed_tensors.*`ï¼ˆé‡åŒ–æ–¹æ¡ˆè§£æã€ç›®æ ‡æ˜ å°„ï¼‰  
- `sglang.srt.layers.quantization.compressed_tensors_moe.py`ï¼ˆMoE é‡åŒ–è·¯å¾„ã€æœªé‡åŒ–å›é€€ï¼‰  
- ç›¸å…³çš„æ¨¡å‹åŠ è½½ã€æƒé‡æ‹†åˆ†ã€åç«¯ kernel è°ƒåº¦ä»£ç ã€‚  

**ğŸ’¡ å…³æ³¨å»ºè®®**  
1. **æµ‹è¯•è¦†ç›–**ï¼šè¡¥å…… MoE + ignoredâ€‘layer åœºæ™¯çš„å•å…ƒ/é›†æˆæµ‹è¯•ï¼Œç¡®ä¿è¿”å› `UnquantizedFusedMoEMethod` å¹¶ä¸”ä¸ä¼šè§¦å‘æ„å¤–çš„é‡åŒ–è·¯å¾„ã€‚  
2. **æ˜ å°„å†²çª**ï¼šæ£€æŸ¥ `_add_fused_moe_to_target_scheme_map` åœ¨å·²æœ‰ `FusedMoE` é”®æ—¶çš„è¡Œä¸ºï¼Œé˜²æ­¢è¦†ç›–ç”¨æˆ·è‡ªå®šä¹‰æ˜ å°„ã€‚  
3. **æ€§èƒ½æ£€æŸ¥**ï¼š`get_scheme_dict` åœ¨æ¯å±‚éƒ½ä¼šè°ƒç”¨ `should_ignore_layer` ä¸ `find_matched_target`ï¼Œåœ¨å¤§æ¨¡å‹åŠ è½½æ—¶ç•™æ„æ˜¯å¦å‡ºç°æ˜¾è‘—çš„é¢å¤–å¼€é”€ã€‚  
4. **å‘åå…¼å®¹**ï¼šç¡®è®¤æ—§ç‰ˆä»£ç ï¼ˆä»åœ¨ `get_quant_method` ä¸­ç›´æ¥åˆ¤æ–­å¿½ç•¥ï¼‰åœ¨æ–°å®ç°ä¸‹è¡Œä¸ºä¿æŒä¸€è‡´ï¼Œé¿å…å› è¿”å› `None` å¼•èµ·çš„å¼‚å¸¸ã€‚  
5. **æ–‡æ¡£æ›´æ–°**ï¼šåœ¨é‡åŒ–é…ç½®æ–‡æ¡£ä¸­æ³¨æ˜ â€œMoE å±‚å¯è¢« ignoreï¼Œè¿”å›æœªé‡åŒ–å®ç°â€ ä»¥åŠ `Linear â†’ FusedMoE` çš„è‡ªåŠ¨æ˜ å°„è§„åˆ™ã€‚  

æ€»ä½“æ¥çœ‹ï¼Œæ­¤æ¬¡æ”¹åŠ¨æå‡äº†å‹ç¼©å¼ é‡å¯¹ MoE çš„å…¼å®¹æ€§ï¼Œå…³é”®åœ¨äºå®Œæ•´éªŒè¯å¿½ç•¥é€»è¾‘å’Œæ˜ å°„ä¸€è‡´æ€§ï¼Œé˜²æ­¢åœ¨å¤æ‚ MoE ç»“æ„ä¸‹å‡ºç°é‡åŒ–ä¸åŒ¹é…æˆ–æ€§èƒ½é€€åŒ–ã€‚

---

### [DLLM] Add JointThreshold algorithm for joint M2T and T2T decoding (#18171)
**SHA**: `1465224` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/14652243bdf4c18f6eb68b90469e1bb7135c7254)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼º  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  

**ğŸ“‹ å˜æ›´æ‘˜è¦**  
ä¸º DLLMï¼ˆDiffusion Language Modelï¼‰æ–°å¢ JointThreshold ç®—æ³•ï¼Œå®ç°äº†åœ¨åŒä¸€æ¬¡è§£ç ä¸­åŒæ—¶è¿›è¡Œ Maskâ†’Tokenï¼ˆM2Tï¼‰å’Œ Tokenâ†’Tokenï¼ˆT2Tï¼‰ä¸¤é˜¶æ®µçš„é˜ˆå€¼æ§åˆ¶ã€‚æ–‡æ¡£åŒæ­¥æ·»åŠ äº†å¯¹åº”é…ç½®è¯´æ˜ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**  
- `sglang/srt/dllm/algorithm/`ï¼šæ–°å¢ `joint_threshold.py`ï¼Œç»§æ‰¿ `DllmAlgorithm`ã€‚  
- é…ç½®è§£æï¼š`sglang/srt/dllm/config.py` éœ€è¦è¯»å– `thresholdã€edit_thresholdã€max_post_edit_stepsã€penalty_lambda` å››ä¸ªæ–°å­—æ®µã€‚  
- è¿è¡Œæ—¶è·¯å¾„ï¼š`ModelRunner.forward` åœ¨è¿­ä»£å¾ªç¯ä¸­è¢«å¤šæ¬¡è°ƒç”¨ï¼Œæ¶‰åŠ KV ç¼“å­˜çš„ä¿æ´»é€»è¾‘ã€‚  
- æ–‡æ¡£ï¼š`docs/supported_models/text_generation/diffusion_language_models.md`ã€‚  

**ğŸ’¡ å…³æ³¨å»ºè®®**  
1. **å•å…ƒæµ‹è¯•**ï¼šä¸º `JointThreshold.run` æ·»åŠ è¦†ç›–æ‰€æœ‰åˆ†æ”¯çš„æµ‹è¯•ï¼ˆæ—  maskã€ä»… M2Tã€ä»… T2Tã€ä¸¤è€…æ··åˆã€é‡å¤æƒ©ç½šå¼€å¯ç­‰ï¼‰ã€‚  
2. **é…ç½®æ ¡éªŒ**ï¼šåœ¨ `DllmConfig` ä¸­åŠ å…¥èŒƒå›´æ£€æŸ¥ï¼Œé˜²æ­¢ `threshold`ã€`edit_threshold` è¶…å‡º `[0,1]`ï¼Œä»¥åŠ `max_post_edit_steps` ä¸ºè´Ÿå€¼çš„æƒ…å†µã€‚  
3. **æ€§èƒ½ç›‘æ§**ï¼šè¯¥å®ç°ä¼šåœ¨æ¯æ¬¡è¿­ä»£éƒ½è°ƒç”¨ `model_runner.forward`ï¼Œè¯·åœ¨ CI ä¸­åŠ å…¥åŸºå‡†æµ‹è¯•ï¼Œç¡®è®¤ç›¸è¾ƒäºå·²æœ‰ `LowConfidence` ä¸ä¼šå‡ºç°æ˜¾è‘—å›é€€ã€‚  
4. **ç¼“å­˜ä¸€è‡´æ€§**ï¼š`any_changed_in_last_step` ç”¨äºå†³å®šæ˜¯å¦é¢å¤–å‰å‘ï¼Œç¡®ä¿ `can_run_graph` æ ‡è®°åœ¨æ‰€æœ‰åˆ†æ”¯è¿”å›æ—¶ä¿æŒä¸€è‡´ï¼Œé¿å…å›¾åˆ‡æ¢é”™è¯¯ã€‚  
5. **å‘åå…¼å®¹**ï¼šé»˜è®¤å‚æ•°ä¿æŒåŸæœ‰è¡Œä¸ºï¼ˆthreshold 0.5ã€edit_threshold 0ï¼‰ï¼Œç¡®ä¿æœªæ˜¾å¼æŒ‡å®šæ—¶å·²æœ‰æ¨¡å‹ä»å¯æ­£å¸¸è¿è¡Œã€‚  

ä»¥ä¸Šæ”¹åŠ¨å¯¹ DLLM è§£ç æµç¨‹å½±å“è¾ƒå¤§ï¼Œå»ºè®®åœ¨å‘å¸ƒå‰å®Œæˆä¸Šè¿°éªŒè¯ï¼Œå¹¶åœ¨ CHANGELOG ä¸­æ³¨æ˜æ–°å¢ JointThreshold åŠå…¶ä½¿ç”¨åœºæ™¯ã€‚

---

### [AMD] Update aiter to v0.1.10.post2 (#18423)
**SHA**: `3f3c201` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/3f3c2012433fd21bcbda7fd1e7db408d67daf9a9)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼ºï¼ˆæ›´æ–° AMDâ€¯aiter è‡³ v0.1.10.post2 å¹¶æ‰©å±• MLA/KVâ€‘cache æ¥å£ï¼‰  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  
**ğŸ“‹ å˜æ›´æ‘˜è¦**ï¼š  
- Docker é•œåƒå°† AITER ä¾èµ–å‡çº§åˆ° `v0.1.10.post2`ï¼Œå¹¶æ”¹ä¸º `amd-aiter` åŒ…åã€‚  
- `aiter_backend.py` ä¸­æ–°å¢ `kv_last_page_len` å‚æ•°ï¼Œè´¯ç©¿ `make_mla_meta_data`ã€`forward_*`ã€`forward_decode` ç­‰è·¯å¾„ï¼Œå¹¶ç»Ÿä¸€ä½¿ç”¨ `sm_scale`ã€`logit_cap` å‘½åã€‚  
- CI è„šæœ¬åŠ å…¥ AITER åŒ…åæ›¿æ¢ã€kernel æš–æœºï¼ˆrmsnormã€rotaryã€activation ç­‰ï¼‰å¹¶ç»†åˆ†ä¸º 5 æ­¥ã€‚  
- CI é…ç½®åŠæµ‹è¯•æ³¨å†Œçš„é¢„è®¡è¿è¡Œæ—¶é•¿å‡ä¸Šè°ƒï¼Œä»¥é€‚é…æ›´å¤§çš„ partition å’Œæ›´æ…¢çš„ AMD ç¯å¢ƒã€‚  

**ğŸ¯ å½±å“èŒƒå›´**ï¼š  
- `python/sglang/srt/layers/attention/aiter_backend.py`ï¼ˆæ ¸å¿ƒæ³¨æ„åŠ›å±‚å®ç°ï¼‰  
- Docker é•œåƒæ„å»ºï¼ˆ`docker/rocm.Dockerfile`ï¼‰  
- AMD CI æµç¨‹ï¼ˆ`scripts/ci/amd/*.sh`ã€`.github/workflows/pr-test-amd.yml`ï¼‰  
- å¤šé¡¹æµ‹è¯•æ³¨å†Œçš„æ—¶é—´ä¼°ç®—ã€‚  

**ğŸ’¡ å…³æ³¨å»ºè®®**ï¼š  
1. **å…¼å®¹æ€§éªŒè¯**ï¼šç¡®è®¤æ—§ç‰ˆ `aiter`ï¼ˆå¦‚ `v0.1.9`ï¼‰çš„æ¨¡å‹æ–‡ä»¶åœ¨å‡çº§åä»èƒ½æ­£å¸¸åŠ è½½ï¼Œå°¤å…¶æ˜¯ KVâ€‘cache åºåˆ—åŒ–æ ¼å¼æ˜¯å¦å— `kv_last_page_len` å½±å“ã€‚  
2. **å‚æ•°ä¼ é€’**ï¼š`kv_last_page_len` ç°åœ¨åœ¨å¤šä¸ªè·¯å¾„ä¸­è¢«æ˜¾å¼ä¼ å…¥ï¼Œæ£€æŸ¥æ‰€æœ‰è°ƒç”¨æ–¹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰æ¨ç†è„šæœ¬ï¼‰æ˜¯å¦å·²æ›´æ–°å¯¹åº”ç­¾åï¼Œé˜²æ­¢å‚æ•°ç¼ºå¤±å¯¼è‡´è¿è¡Œæ—¶å¼‚å¸¸ã€‚  
3. **æ€§èƒ½åŸºå‡†**ï¼šCI æš–æœºæ­¥éª¤å·²ç»†åŒ–ï¼Œå»ºè®®åœ¨æœ¬åœ°æˆ– AMD å®æœºä¸Šè·‘ä¸€æ¬¡å®Œæ•´çš„ `run_suite.py`ï¼Œå¯¹æ¯”å‰åæ¨ç†æ—¶å»¶ä¸æ˜¾å­˜å ç”¨ï¼Œç¡®ä¿æ–° kernel ç¼–è¯‘æœªå¼•å…¥å›é€€ã€‚  
4. **æµ‹è¯•æ—¶é—´**ï¼šCI ä¸­å¤šå¤„ `est_time` ä¸Šè°ƒï¼Œè‹¥åç»­å‡ºç°è¶…æ—¶ï¼Œè¯·é€‚æ—¶è°ƒé«˜å¯¹åº” job çš„ `timeout-minutes`ï¼ˆå¦‚ diffusion server æµ‹è¯•å·²ä» 45â€¯â†’â€¯60â€¯minï¼‰ã€‚  
5. **æ–‡æ¡£åŒæ­¥**ï¼šæ›´æ–° README/CHANGELOGï¼Œæ³¨æ˜ `kv_last_page_len` æ–°å¢åŠ `sm_scale`/`logit_cap` å‚æ•°æ”¹åï¼Œå¸®åŠ©ä½¿ç”¨è€…å¿«é€Ÿè¿ç§»ã€‚  

æ€»ä½“è€Œè¨€ï¼Œæœ¬æ¬¡æ›´æ–°ä¸º AMD ç¯å¢ƒå¼•å…¥äº†æ›´å®Œæ•´çš„ MLA æ”¯æŒå’Œæ›´ç¨³å¥çš„ kernel é¢„çƒ­ï¼Œè‹¥æŒ‰ä¸Šè¿°æ£€éªŒç‚¹é€é¡¹ç¡®è®¤ï¼Œé£é™©å¯æ§ã€‚

---

### fix: use --no-build-isolation for human-eval install (#18455)
**SHA**: `b564dce` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/b564dcec61622d1fa3aa5fe0d5b8e5cbd9fff206)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šBug ä¿®å¤  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  
**ğŸ“‹ å˜æ›´æ‘˜è¦**ï¼šåœ¨ CI å·¥ä½œæµä¸­å®‰è£… *human-eval* æ—¶ï¼Œæ–°å¢ `--no-build-isolation` å‚æ•°ï¼Œé¿å… pip åœ¨éš”ç¦»çš„ä¸´æ—¶è™šæ‹Ÿç¯å¢ƒä¸­é‡æ–°æ„å»ºä¾èµ–ï¼Œä»è€Œé˜²æ­¢ç¼ºå¤±å·²æœ‰çš„åº“ï¼ˆå¦‚ PyTorchï¼‰å¯¼è‡´å®‰è£…å¤±è´¥ã€‚  
**ğŸ¯ å½±å“èŒƒå›´**ï¼š  
- `.github/workflows/pr-test.yml`ï¼ˆä¸¤æ®µ CI æ­¥éª¤ï¼‰  
- ä»…é™ CI ç¯å¢ƒï¼Œè¿è¡Œæ—¶ä»£ç åŠç”¨æˆ·å®‰è£…æµç¨‹ä¸å—å½±å“ã€‚  

**ğŸ’¡ å…³æ³¨å»ºè®®**  
1. **ç¡®è®¤ä¾èµ–ä¸€è‡´æ€§**ï¼š`--no-build-isolation` ä¼šè®© *human-eval* ç›´æ¥ä½¿ç”¨ CI ç°åœºå·²å®‰è£…çš„ä¾èµ–ï¼Œå»ºè®®åœ¨ CI å‰æ˜¾å¼å®‰è£…æ‰€éœ€çš„ä¾èµ–ï¼ˆå¦‚ `torch>=2.x`ï¼‰ï¼Œé¿å…å› ç¯å¢ƒå˜åŠ¨è€Œå‡ºç°éšè—çš„å…¼å®¹æ€§é—®é¢˜ã€‚  
2. **ç¯å¢ƒæ¸…ç†**ï¼šä½¿ç”¨è¯¥å‚æ•°å¯èƒ½å¯¼è‡´åŒ…æ®‹ç•™åœ¨å…¨å±€ç¯å¢ƒï¼Œè€ƒè™‘åœ¨ CI æœ€åæ·»åŠ æ¸…ç†æ­¥éª¤ï¼ˆ`pip uninstall -y -r requirements.txt`ï¼‰ä»¥é˜²æ­¢åç»­ä½œä¸šå—æ±¡æŸ“ã€‚  
3. **æ–‡æ¡£æ›´æ–°**ï¼šåœ¨é¡¹ç›®çš„ CI è¯´æ˜æˆ–è´¡çŒ®æŒ‡å—ä¸­æ ‡æ˜æ­¤ä¿®æ”¹åŸå› ï¼Œå¸®åŠ©è´¡çŒ®è€…åœ¨æœ¬åœ°å¤ç° CI æ—¶äº†è§£éœ€è¦æ‰‹åŠ¨åŠ ä¸ŠåŒæ ·çš„å‚æ•°ã€‚  
4. **å…¼å®¹æ€§å›å½’æµ‹è¯•**ï¼šåœ¨æœ¬åœ°æˆ–é¢„å‘å¸ƒç¯å¢ƒè¿è¡Œä¸€æ¬¡å®Œæ•´çš„ `human-eval` å®‰è£…ä¸æµ‹è¯•ï¼Œç¡®ä¿æ–°å¢å‚æ•°ä¸ä¼šå¼•å…¥æ„å¤–çš„æ„å»ºé”™è¯¯ã€‚  

æ€»ä½“è€Œè¨€ï¼Œæ­¤ä¿®æ”¹é’ˆå¯¹ CI ä¸­çš„ä¾èµ–æ„å»ºéš”ç¦»å¯¼è‡´çš„å®‰è£…å¤±è´¥é—®é¢˜ï¼Œé£é™©æœ‰é™ä¸”ä¸å½±å“åº“çš„æ­£å¸¸ä½¿ç”¨ã€‚è‹¥åç»­è¿ç§»è‡³æ›´ä¸¥æ ¼çš„éš”ç¦»ç­–ç•¥ï¼Œè¯·åŒæ­¥æ›´æ–°å¯¹åº”çš„ä¾èµ–å£°æ˜ã€‚

---

### Refactoring Mooncake TE as a shared distributed component (#17810)
**SHA**: `bffd765` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/bffd76541730d6fbcd98b0d109d8e026cbb29639)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼ºï¼ˆMooncake Transfer Engine å…±äº«åŒ– & ä»£ç é‡æ„ï¼‰  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  
**ğŸ“‹ å˜æ›´æ‘˜è¦**ï¼šå°†åŸæœ¬åˆ†æ•£åœ¨ `sglang.srt.disaggregation.mooncake` åŒ…ä¸‹çš„ Mooncakeâ€¯Transferâ€¯Engine æŠ½å–ä¸ºå…¨å±€å…±äº«ç»„ä»¶ï¼Œæ”¾å…¥ `sglang.srt.distributed.device_communicators` å¹¶æä¾› `init_mooncake_transfer_engine` / `get_mooncake_transfer_engine` æ¥å£ã€‚æ¨¡å‹å¯åŠ¨æ—¶ç»Ÿä¸€åˆå§‹åŒ–ï¼Œæ‰€æœ‰éœ€è¦ Mooncakeâ€¯TE çš„æ¨¡å—ï¼ˆKVâ€¯disaggregationã€encoderâ€¯disaggregationã€HiCacheâ€¯store ç­‰ï¼‰æ”¹ä¸ºé€šè¿‡è¯¥å…¨å±€å…¥å£è·å–å®ä¾‹ï¼Œç§»é™¤å„è‡ªçš„å±€éƒ¨åˆ›å»ºé€»è¾‘å¹¶ç»Ÿä¸€ç®¡ç† IB è®¾å¤‡é…ç½®ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**  
- `srt/disaggregation/*`ï¼ˆencode_receiverã€encode_serverã€mooncake/connã€transfer_engineï¼‰  
- `srt/distributed/device_communicators/mooncake_transfer_engine.py`ï¼ˆæ ¸å¿ƒå®ç°ï¼‰  
- `srt/distributed/parallel_state.py`ï¼ˆæ–°å¢è·å–å‡½æ•°ï¼‰  
- `srt/model_executor/model_runner.py`ï¼ˆæ¨¡å‹å¯åŠ¨æ—¶ç»Ÿä¸€åˆå§‹åŒ–ï¼‰  
- `srt/mem_cache/storage/mooncake_store/mooncake_store.py`ï¼ˆæš‚æ—¶ç¦ç”¨å¤ç”¨ï¼‰  

**ğŸ’¡ å…³æ³¨å»ºè®®**  

1. **åˆå§‹åŒ–é¡ºåº**ï¼š`ModelRunner.init_shared_mooncake_transfer_engine` ä¾èµ– `self.gpu_id` ä¸ `self.server_args`ï¼ŒåŠ¡å¿…åœ¨ `torch.distributed` å®Œæˆåè°ƒç”¨ï¼Œé˜²æ­¢å¤šè¿›ç¨‹ä¸­å‡ºç°æœªåˆå§‹åŒ–çš„æƒ…å†µã€‚å¯ä»¥åœ¨ `parallel_state.init_distributed_environment` åç«‹å³è°ƒç”¨ `init_mooncake_transfer_engine`ï¼Œè€Œä¸æ˜¯åœ¨ `ModelRunner.__init__` é‡Œã€‚  

2. **çº¿ç¨‹å®‰å…¨**ï¼šå½“å‰ `_mooncake_transfer_engine` é‡‡ç”¨å…¨å±€å˜é‡ä¸”åœ¨é¦–æ¬¡è°ƒç”¨ `init_mooncake_transfer_engine` æ—¶åˆ›å»ºã€‚è‹¥åœ¨åŒä¸€èŠ‚ç‚¹çš„å¤šä¸ªè¿›ç¨‹/çº¿ç¨‹å¹¶å‘åˆ›å»ºï¼Œå¯èƒ½å‡ºç°ç«äº‰ã€‚å»ºè®®åœ¨å‡½æ•°ä½“å†…åŠ  `threading.Lock` é˜²æ­¢é‡å¤å®ä¾‹åŒ–ã€‚  

3. **é…ç½®å…¼å®¹**ï¼š`MooncakeTransferEngine.__init__` ç°åœ¨é»˜è®¤ `gpu_id=0`ï¼Œè€Œä¹‹å‰æ˜¾å¼ä¼  `None` æ—¶ä¼šèµ° `get_ib_devices_for_gpu`ã€‚è¯·ç¡®è®¤åœ¨ CPUâ€‘only æˆ–å¤š GPU ç¯å¢ƒä¸‹ï¼Œæ–°é»˜è®¤è¡Œä¸ºä¸å¯¼è‡´é”™è¯¯ã€‚  

4. **é”™è¯¯æç¤º**ï¼šåœ¨ `batch_register`ã€`batch_transfer_sync` ç­‰è·¯å¾„ä»ä¿ç•™æ—§çš„ â€œupgrade Mooncakeâ€ ä¿¡æ¯ï¼Œå»ºè®®ç»Ÿä¸€åœ¨ `MooncakeTransferEngine` ä¸­æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼Œä¾¿äºä¸Šå±‚æ•è·å¹¶ç»™å‡ºç»Ÿä¸€é”™è¯¯ã€‚  

5. **èµ„æºå›æ”¶**ï¼šå…±äº«å®ä¾‹åœ¨è¿›ç¨‹é€€å‡ºæ—¶æ˜¯å¦éœ€è¦æ˜¾å¼è°ƒç”¨ `engine.shutdown()`ï¼ˆè‹¥ Mooncake æä¾›ï¼‰å°šæœªçœ‹åˆ°ï¼Œå»ºè®®åœ¨ `ModelRunner.__del__` æˆ– `parallel_state.shutdown` ä¸­åŠ å…¥æ¸…ç†é€»è¾‘ï¼Œé˜²æ­¢æ®‹ç•™ RDMA å¥æŸ„ã€‚  

6. **å•å…ƒæµ‹è¯•**ï¼šæ–°å¢çš„å…¨å±€è·å–è·¯å¾„å·²ç»åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œå»ºè®®æ–°å¢ `test_mooncake_shared_engine.py`ï¼Œè¦†ç›–ï¼šâ‘ é¦–æ¬¡åˆå§‹åŒ–è¿”å›å®ä¾‹ï¼›â‘¡é‡å¤è°ƒç”¨è¿”å›åŒä¸€å¯¹è±¡ï¼›â‘¢æœªåˆå§‹åŒ–æ—¶è¿”å› `None`ã€‚  

7. **æ–‡æ¡£æ›´æ–°**ï¼šREADME/éƒ¨ç½²æŒ‡å—ä¸­åº”è¯´æ˜ â€œMooncake Transfer Engine ç°åœ¨æ˜¯å…¨å±€å…±äº«ï¼Œåªéœ€åœ¨æ¨¡å‹å¯åŠ¨æ—¶ä¸€æ¬¡åˆå§‹åŒ–â€ã€‚  

æ•´ä½“æ¥çœ‹ï¼Œæ­¤æ¬¡æ”¹åŠ¨æå‡äº† Mooncakeâ€¯TE çš„å¤ç”¨ç‡å¹¶ç®€åŒ–äº†ä»£ç è·¯å¾„ï¼Œä½†éœ€è¦å…³æ³¨å¤šè¿›ç¨‹ç¯å¢ƒä¸‹çš„åˆå§‹åŒ–é¡ºåºã€çº¿ç¨‹å®‰å…¨ä»¥åŠèµ„æºå›æ”¶ï¼Œä»¥å…åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼éƒ¨ç½²æ—¶å‡ºç°éšè”½çš„è¿æ¥æ³„æ¼æˆ–é…ç½®ä¸ä¸€è‡´é—®é¢˜ã€‚

---

### Add tensor parallelism support to LFM2 ShortConv layers (#17777)
**SHA**: `656a3d7` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/656a3d742edb501ac849ead1df10f1c1fb71363a)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼º  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  

**ğŸ“‹ å˜æ›´æ‘˜è¦**  
1. ä¸º LFM2 ä¸­çš„ ShortConv å±‚åŠ å…¥ Tensorâ€‘Parallelï¼ˆTPï¼‰æ”¯æŒï¼›éšè—ç»´åº¦åœ¨ TP ä¹‹é—´åˆ‡åˆ†ã€‚  
2. `lfm2.py` ä¸­æ”¹ç”¨ `MergedColumnParallelLinear` / `RowParallelLinear`ï¼Œå¹¶åœ¨å·ç§¯æƒé‡/åç½®ä¸Šæ·»åŠ  `sharded_weight_loader`ã€‚  
3. `configs/lfm2.py` è°ƒæ•´ `mamba2_cache_params` è®¡ç®—ï¼Œä½¿ `num_heads=tp_size` èƒ½å…¼å®¹æ— çŠ¶æ€çš„ ShortConvã€‚  
4. æƒé‡åŠ è½½é€»è¾‘ç»Ÿä¸€ä¸º â€œconv.convâ€ â†’ `conv_weight` / `conv_bias`ï¼Œå¹¶åœ¨åŠ è½½æ—¶è¿›è¡Œ squeeze ä¸åˆ†ç‰‡ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**  
- `python/sglang/srt/configs/lfm2.py`ï¼ˆç¼“å­˜å‚æ•°ï¼‰  
- `python/sglang/srt/models/lfm2.py`ï¼ˆæ¨¡å‹ç»“æ„ã€å‰å‘ã€æƒé‡åŠ è½½ï¼‰  
- ä¾èµ– `sglang.srt.layers.linear`ã€`sglang.srt.distributed` çš„æ‰€æœ‰ TP åœºæ™¯  

**ğŸ’¡ å…³æ³¨å»ºè®®**  
- **å…¼å®¹æ€§**ï¼šæœªå¼€å¯ TP æ—¶ä»åº”ä¿æŒåŸè¡Œä¸ºï¼Œç¡®ä¿ `get_tensor_model_parallel_world_size()` é»˜è®¤è¿”å› 1ã€‚  
- **æƒé‡ä¸€è‡´æ€§**ï¼šæ ¸å¯¹ HF è½¬æ¢è„šæœ¬ï¼Œç¡®è®¤ `conv.conv.weight`/`bias` åç§°åŒ¹é…ï¼›è‹¥æ¨¡å‹å·²æœ‰è‡ªå®šä¹‰æƒé‡æ–‡ä»¶ï¼Œéœ€æä¾›è¿ç§»è„šæœ¬ã€‚  
- **æ€§èƒ½éªŒè¯**ï¼šåœ¨å¤šå¡ç¯å¢ƒä¸‹è·‘å®Œæ•´çš„é¢„å¡«å…… + è§£ç åŸºå‡†ï¼Œè§‚å¯Ÿ `conv_weight` åˆ†ç‰‡æ˜¯å¦å¯¼è‡´é¢å¤–çš„é€šä¿¡å¼€é”€ã€‚  
- **å•å…ƒæµ‹è¯•**ï¼šæ–°å¢å¯¹ `Lfm2ShortConv.forward` çš„ TPâ€‘aware æµ‹è¯•ï¼Œç¡®ä¿ `in_proj`ã€`out_proj` è¾“å‡ºç»´åº¦ä¸åŸå®ç°ç›¸åŒã€‚  
- **æ–‡æ¡£**ï¼šåœ¨ README/ä½¿ç”¨æ‰‹å†Œä¸­è¡¥å…… â€œå¼€å¯ TPï¼š`--tensor-parallel-size N`â€ çš„è¯´æ˜ä»¥åŠå¯¹ ShortConv çš„ç‰¹æ®Šè¦æ±‚ã€‚  

æ€»ä½“æ¥è¯´ï¼Œæ­¤æ¬¡æ”¹åŠ¨ä¸º LFM2 å¼•å…¥äº†å¯æ‰©å±•çš„å¹¶è¡Œèƒ½åŠ›ï¼Œè‹¥æµ‹è¯•é€šè¿‡ï¼Œå°†æ˜¾è‘—æå‡å¤§æ¨¡å‹çš„æ¨ªå‘æ‰©å±•æ€§ï¼›ä½†éœ€æ³¨æ„æƒé‡åˆ‡åˆ†è·¯å¾„å’Œç¼“å­˜å‚æ•°åœ¨ TP ç¯å¢ƒä¸‹çš„æ­£ç¡®æ€§ã€‚

---

#### ğŸŸ¢ ä½é‡è¦åº¦å˜æ›´ (7)

### Fix MMLU benchmark to auto-download data and resolve path issue (#18486)
**SHA**: `0b4d4f2` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/0b4d4f28388ab324766812ff8c69ca7ed2cfd4da)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šä»£ç é‡æ„  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šä¸º MMLU åŸºå‡†æ–°å¢è‡ªåŠ¨ä¸‹è½½å¹¶è§£å‹æ•°æ®çš„é€»è¾‘ï¼Œé»˜è®¤ data ç›®å½•æ”¹ä¸ºè„šæœ¬æ‰€åœ¨è·¯å¾„ä¸‹çš„ `data`ï¼Œè§£å†³è·¯å¾„æ‰¾ä¸åˆ°çš„é—®é¢˜ã€‚

---

### [AMD] CI - Fix AMD daily image release and install dependency (#18452)
**SHA**: `28717e3` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/28717e3d283d7f4eb9b2e912f5045da26db94392)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šé…ç½®è°ƒæ•´  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šåœ¨ AMD CI é•œåƒä¸­å°† `z3-solver` å›ºå®šä¸º 4.15.4.0 ä»¥ä½¿ç”¨ manylinux wheelï¼Œé¿å… GCC ç‰ˆæœ¬é—®é¢˜ï¼›ä¸º `human-eval` é¢„è£… `setuptools` å¹¶ä»¥ `--no-build-isolation` å®Œæˆå®‰è£…ã€‚

---

### [BugFix][PD]Fix metadata_buffer_index leak when aborted in PD (#17483)
**SHA**: `68e31a3` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/68e31a348507dc6371ac53f3c0aff893d579adc6)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šä»£ç é‡æ„  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šæ–°å¢ `release_req_to_metadata_buffer` è¾…åŠ©å‡½æ•°ï¼Œå¹¶åœ¨é¢„å¡«å……æµç¨‹åŠè°ƒåº¦å™¨çš„ abort é€»è¾‘ä¸­è°ƒç”¨ï¼Œç¡®ä¿åœ¨è¯·æ±‚ä¸­æ­¢æ—¶æ­£ç¡®é‡Šæ”¾ `metadata_buffer_index`ï¼Œä¿®å¤æ³„æ¼é—®é¢˜ã€‚

---

### [ModelOPT] Support Qwen 3 Next Coder NVFP4 (#18224)
**SHA**: `bf89cc3` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/bf89cc3803873a00879c516e247df611ad3247a7)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šä»£ç é‡æ„  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šä¸º Qwenâ€¯3â€¯Next æ¨¡å‹åŠ å…¥é‡åŒ–é…ç½®çš„ fusedâ€‘module æ˜ å°„å¹¶åœ¨åŠ è½½æƒé‡æ—¶ç»Ÿä¸€åç§°è½¬æ¢ï¼Œä¿®æ­£ FP8 KVâ€‘cache scale çš„æ˜ å°„ä»¥åŠå‚æ•°åæ›¿æ¢é€»è¾‘ã€‚

---

### Update author information in pyproject.toml (#18453)
**SHA**: `75997eb` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/75997ebe8ddf228670824637e67d36bc884ef4ac)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šé…ç½®è°ƒæ•´  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šåœ¨ `sgl-kernel/pyproject.toml` ä¸­å°†ä½œè€…ä¿¡æ¯ç”±ä¸ªäººé‚®ç®±ä¿®æ”¹ä¸º â€œSGLang Kernel Team <sglang@lmsys.org>â€ã€‚

---

### [Kimi-K2.5] Fix missing `quant_config` in `KimiK25` (#18440)
**SHA**: `071bf2c` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/071bf2ce094c6f45e6039bf5f858f271f8be9f0b)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šä»£ç é‡æ„  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šåœ¨ `KimiK25` æ¨¡å‹çš„æ„é€ å‡½æ•°ä¸­æ–°å¢ `self.quant_config = quant_config`ï¼Œä¿®å¤äº†ç¼ºå¤±é‡åŒ–é…ç½®å¯¼è‡´çš„æ½œåœ¨é”™è¯¯ã€‚

---

### [diffusion] chore: revise process title (#18446)
**SHA**: `6601bc2` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/sgl-project/sglang/commit/6601bc24da8a3a3b345a429d9315222c2d181dc4)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šä»£ç é‡æ„  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šåœ¨ GPU worker åˆå§‹åŒ–æ—¶ï¼Œæ”¹ä¸ºä¾æ®æ¨¡å‹å¹¶è¡Œï¼ˆTPã€Ulyssesã€Ringã€CFGï¼‰çŠ¶æ€åŠ¨æ€è®¾ç½®è¿›ç¨‹æ ‡é¢˜ï¼Œæå‡è¿›ç¨‹å¯è¾¨è¯†æ€§ã€‚

---

