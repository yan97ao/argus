# æ¯æ—¥æ›´æ–°æŠ¥å‘Šï¼ˆ2026-02-08ï¼‰

## vllm-project/vllm

| æäº¤æ—¶é—´ | ä½œè€… | æäº¤ä¿¡æ¯ |
|----------|------|----------|
| 2026-02-08 20:57:16 | Reagan Lee | Add embedding input functionality for disabled modalities [remake] (#32493) |
| 2026-02-08 15:17:26 | TJian | [ROCm] [CI] Reduce Resource of two test groups (#34059) |
| 2026-02-08 15:16:34 | Nick Hill | [Perf] Simplify DeepseekV32 tokenizer, ensure fast detokenization used (#33855) |
| 2026-02-08 11:21:12 | Andreas Karatzas | [ROCm][Bugfix] fix act_quant_fusion module import error (#34069) |
| 2026-02-08 00:52:38 | Cyrus Leung | [CI/Build] Skip GCS test (#34057) |

### ğŸ“Š ç»Ÿè®¡æ‘˜è¦
> æœ¬æ—¥å…± 5 ä¸ªæäº¤ | ğŸ”´é«˜ 0 | ğŸŸ¡ä¸­ 2 | ğŸŸ¢ä½ 3
## ğŸ“‹ ç›®å½•

- [vllm-project/vllm](#vllm-project-vllm)
  - [ğŸ“Š ç»Ÿè®¡æ‘˜è¦](#-ç»Ÿè®¡æ‘˜è¦)
  - [ğŸŸ¡ ä¸­é‡è¦åº¦å˜æ›´ (2)](#-ğŸŸ¡-ä¸­é‡è¦åº¦å˜æ›´-2)
    - [Add embedding input functionality for disabled modalities...](#c4df59a)
    - [[Perf] Simplify DeepseekV32 tokenizer, ensure fast detoke...](#a96197f)
  - [ğŸŸ¢ ä½é‡è¦åº¦å˜æ›´ (3)](#-ğŸŸ¢-ä½é‡è¦åº¦å˜æ›´-3)
    - [[ROCm] [CI] Reduce Resource of two test groups (#34059)](#785cf28)
    - [[ROCm][Bugfix] fix act_quant_fusion module import error (...](#ab10d79)
    - [[CI/Build] Skip GCS test (#34057)](#7fcb705)
#### ğŸŸ¡ ä¸­é‡è¦åº¦å˜æ›´ (2)

### Add embedding input functionality for disabled modalities [remake] (#32493)
**SHA**: `c4df59a` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/vllm-project/vllm/commit/c4df59ad43037a846eed353ce4c17dc264d18f4a)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼ºï¼ˆä¸ºâ€¯`limit_mm_per_prompt=0`â€¯çš„æ¨¡æ€å¼•å…¥é¢„è®¡ç®— embedding è¾“å…¥ï¼‰  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  
**ğŸ“‹ å˜æ›´æ‘˜è¦**ï¼š  
1. åœ¨ `MultiModalConfig` ä¸­åŠ å…¥è¯´æ˜å¹¶åœ¨ `--enable-mm-embeds` ä¸º true æ—¶ï¼Œè‹¥ç”¨æˆ·å°†æŸæ¨¡æ€çš„ `limit_per_prompt` è®¾ä¸º 0ï¼Œé¢„è®¡ç®—çš„ `<modality>_embeds` å°†è¢«è§†ä¸ºåˆæ³•è¾“å…¥ï¼Œè·³è¿‡è®¡æ•°æ ¡éªŒã€‚  
2. å¤šå¤„ä¿®æ”¹å¤„ç†æµç¨‹ï¼š  
   - `chat_utils.MultiModalItemList.add` é‡Œæ¡ä»¶æ€§åœ°ç»•è¿‡ `validate_num_items`ï¼›  
   - `budget` ä¸ `processor` åœ¨è®¡ç®—æ´»è·ƒæ¨¡æ€ã€token ä¸Šé™ä¸ encoder é¢„ç®—æ—¶ï¼ŒåŒºåˆ† â€œtower æ¨¡æ€â€(èµ° encoder) ä¸ â€œembeddingâ€‘only æ¨¡æ€â€(ä»…å­˜ cache)ï¼›  
   - `processing.context.parse_mm_data` ä¸ dummyâ€‘input ç”Ÿæˆå‡½æ•°åœ¨éªŒè¯é˜¶æ®µå¯¹ embeddingâ€‘only æ•°æ®ä¸å†æŠ›é”™ï¼›  
   - `registry.supports_multimodal_inputs` ä»è¿”å› trueï¼Œä»¥ä¿ç•™ multimodal åŸºç¡€è®¾æ–½ã€‚  
3. æ–°å¢å•å…ƒæµ‹è¯• `tests/entrypoints/llm/test_mm_embeds_only.py` ä¸ç›¸åº”çš„å¤šæ¨¡æ€å¤„ç†æµ‹è¯•ï¼Œç¡®ä¿ï¼š  
   - embedding è¾“å…¥å¯ä»¥å¾—åˆ°è¾“å‡ºä¸”ä¸é˜»å¡ï¼›  
   - åŸå§‹å›¾åƒä»å—é™ä¸º 0 æ—¶è¢«æ‹’ç»ï¼›  
   - çº¯æ–‡æœ¬æç¤ºä»å¯æ­£å¸¸å·¥ä½œã€‚  

**ğŸ¯ å½±å“èŒƒå›´**ï¼š  
- `vllm/config/multimodal.py`ã€`vllm/entrypoints/chat_utils.py`ã€`vllm/multimodal/budget.py`ã€`vllm/multimodal/processing/`ï¼ˆcontextã€processorã€dummy_inputsï¼‰  
- `vllm/multimodal/registry.py`ã€`vllm/v1/worker/gpu_model_runner.py`  
- ç›¸å…³å•å…ƒæµ‹è¯•ç›®å½•  

**ğŸ’¡ å…³æ³¨å»ºè®®**ï¼š  
- **ç”¨æˆ·**ï¼šå¯ç”¨ `--enable-mm-embeds` å¹¶å°†æŸæ¨¡æ€ limit è®¾ä¸º 0 æ—¶ï¼Œåªèƒ½æä¾›å¯¹åº”çš„ `_embeds` æ•°æ®ï¼›è‹¥è¯¯ä¼ åŸå§‹å›¾ç‰‡ä»ä¼šæŠ› `ValueError`ã€‚è¯·åœ¨å‰ç½®æ•°æ® pipeline ä¸­å®Œæˆç‰¹å¾æå–ï¼Œä»¥é¿å…é¢å¤–çš„ encoder å¼€é”€ã€‚  
- **å¼€å‘è€…**ï¼šç¡®è®¤ `allowed_mm_limits` çš„è®¡ç®—å§‹ç»ˆéµå¾ª `min(user_limit, supported_limit)`ï¼Œé˜²æ­¢å‡ºç°è´Ÿæ•°æˆ–è¶…èŒƒå›´çš„æƒ…å†µï¼›å»ºè®®åœ¨ `MultiModalItemList.add` ä¸­åŠ å…¥æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•ç»•è¿‡çš„è®¡æ•°è·¯å¾„ã€‚  
- **æ€§èƒ½**ï¼šåœ¨çº¯ embeddingâ€‘only åœºæ™¯ä¸‹ï¼Œ`gpu_model_runner` å·²çŸ­è·¯ encoder profilingï¼Œé¿å…ä¸å¿…è¦çš„ç®—å­è°ƒç”¨ã€‚è‹¥åç»­è®¡åˆ’æ”¯æŒæ›´å¤æ‚çš„ embeddingâ€‘only è®¡ç®—ï¼ˆä¾‹å¦‚è·¨åºåˆ—ç¼“å­˜ï¼‰ï¼Œéœ€ç›¸åº”æ‰©å±• `encoder_compute_budget` ä¸ `encoder_cache` çš„ç®¡ç†ã€‚  

æ€»ä½“è€Œè¨€ï¼Œæ­¤æ¬¡æ”¹åŠ¨ä¸ºåœ¨èµ„æºå—é™æˆ–æ— éœ€è§†è§‰ encoder çš„éƒ¨ç½²åœºæ™¯æä¾›äº†è½»é‡åŒ–çš„å¤šæ¨¡æ€å…¥å£ï¼Œä¿æŒå‘åå…¼å®¹çš„åŒæ—¶ï¼Œå¯¹å†…éƒ¨é¢„ç®—ä¸éªŒè¯é€»è¾‘åšäº†ç»†è‡´çš„åˆ†æ”¯å¤„ç†ï¼Œé£é™©å¯æ§ã€‚

---

### [Perf] Simplify DeepseekV32 tokenizer, ensure fast detokenization used (#33855)
**SHA**: `a96197f` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/vllm-project/vllm/commit/a96197f564cb848c5a89ae3438a8bc21f5f5d2c6)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½å¢å¼ºï¼ˆç®€åŒ– DeepSeekâ€‘V3.2 Tokenizerï¼Œå¼ºåˆ¶ä½¿ç”¨ FastTokenizerï¼‰  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¡ ä¸­  

**ğŸ“‹ å˜æ›´æ‘˜è¦**  
1. å°† `DeepseekV32Tokenizer` ä»åŸæ¥çš„ `CachedHfTokenizer` å­ç±»é‡æ„ä¸ºä»…åŒ…è£…æ ‡å‡† `AutoTokenizer`ï¼Œé€šè¿‡ `get_deepseek_v32_tokenizer` åŠ¨æ€ç”Ÿæˆ FastTokenizer å¹¶æ·»åŠ  DeepSeekâ€‘V3.2 çš„èŠå¤©æ¨¡æ¿å®ç°ã€‚  
2. `renderer/deepseek_v32.py` çš„ `tokenizer` å±æ€§ç±»å‹æ”¹ä¸º `HfTokenizer`ï¼Œå¯¹åº”çš„ `get_tokenizer` è¿”å›ä¹ŸåŒæ­¥ä¿®æ”¹ã€‚  
3. æµ‹è¯•ä¸­æ–°å¢å¯¹ `deepseek-ai/DeepSeek-V3`ï¼ˆ`tokenizer_mode="deepseek_v32"`ï¼‰çš„æ£€æŸ¥ï¼Œç¡®ä¿è¿”å›çš„æ˜¯ FastTokenizer å¹¶ä¸”ç±»ååŒ…å« `DSV32`ã€‚  
4. ç§»é™¤ `backend_xgrammar.py` ä¸­å¯¹ `DeepseekV32Tokenizer` çš„ç‰¹æ®Šå¤„ç†é€»è¾‘ï¼Œç»Ÿä¸€èµ° HuggingFace æ ‡å‡†è·¯å¾„ã€‚  

**ğŸ¯ å½±å“èŒƒå›´**  
- **vllm/tokenizers/deepseek_v32.py**ï¼ˆæ ¸å¿ƒå®ç°ï¼‰  
- **vllm/renderers/deepseek_v32.py**ï¼ˆæ¸²æŸ“å™¨ï¼‰  
- **tests/tokenizers_/test_basic.py**ï¼ˆå•å…ƒæµ‹è¯•ï¼‰  
- **vllm/v1/structured_output/backend_xgrammar.py**ï¼ˆXGrammar åç«¯ï¼‰  
- ç›¸å…³ importï¼ˆ`CachedHfTokenizer`ã€`deepseek_v32_encoding`ï¼‰çš„ä½¿ç”¨æ–¹  

**ğŸ’¡ å…³æ³¨å»ºè®®**  
1. **å…¼å®¹æ€§**ï¼šæ—§ä»£ç å¯èƒ½ä»ç„¶æœŸå¾… `DeepseekV32Tokenizer` å®ä¾‹å…·å¤‡åŸæœ‰å±æ€§ï¼ˆå¦‚ `is_fast`ã€`vocab_size`ã€`added_vocab` ç­‰ï¼‰ï¼Œè¯·ç¡®è®¤è¿™äº›å±æ€§åœ¨åŒ…è£…ç±»ä¸­ä»å¯è®¿é—®ï¼Œæˆ–åœ¨è¿ç§»æ–‡æ¡£ä¸­è¯´æ˜æ›¿ä»£æ–¹å¼ã€‚  
2. **ç¼“å­˜**ï¼š`get_cached_tokenizer` ä»åœ¨ä½¿ç”¨ï¼Œç¡®ä¿ `__reduce__` å®ç°èƒ½åœ¨å¤šè¿›ç¨‹/åºåˆ—åŒ–åœºæ™¯ä¸‹æ¢å¤åŒ…è£…åçš„ tokenizerï¼Œé¿å…å‡ºç° â€œcannot pickleâ€ é”™è¯¯ã€‚  
3. **FastTokenizer å¼ºåˆ¶**ï¼šè‹¥ç”¨æˆ·åœ¨ç¦»çº¿ç¯å¢ƒæˆ–è‡ªå®šä¹‰åˆ†æ”¯ä¸­ä½¿ç”¨ä¸æ”¯æŒ fast å®ç°çš„ tokenizerï¼Œå½“å‰æ–­è¨€ä¼šå¤±è´¥ã€‚å»ºè®®åœ¨ `get_tokenizer`/`from_pretrained` ä¸­ç»™å‡ºæ›´å‹å¥½çš„é”™è¯¯æç¤ºæˆ–å›é€€æ–¹æ¡ˆã€‚  
4. **æ–‡æ¡£ & ç¤ºä¾‹**ï¼šæ›´æ–° README/ä¾‹å­ï¼Œæ˜ç¡® `tokenizer_mode="deepseek_v32"` éœ€è¦ HF fast tokenizerï¼ˆ`pip install "transformers[sentencepiece]"`ï¼‰ï¼Œå¹¶è¯´æ˜ç±»åå·²è¢«åŠ¨æ€é‡å‘½åä¸º `DSV32<OriginalClass>`ã€‚  
5. **æµ‹è¯•è¦†ç›–**ï¼šæ–°å¢å¯¹ `apply_chat_template` çš„è¾¹ç•Œæƒ…å†µï¼ˆå¦‚ä»…ç³»ç»Ÿæ¶ˆæ¯ã€å·¥å…·è°ƒç”¨ã€æ€è€ƒæ¨¡å¼åˆ‡æ¢ï¼‰è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿åŒ…è£…åçš„ `encode`ã€`decode` è¡Œä¸ºä¿æŒä¸åŸå®ç°ä¸€è‡´ã€‚  

æ€»ä½“è€Œè¨€ï¼Œæ­¤æ¬¡é‡æ„æ˜¾è‘—ç®€åŒ–äº† DeepSeekâ€‘V3.2 çš„ tokenizer å®ç°ï¼Œæå‡äº†è¿è¡Œæ—¶é€Ÿåº¦ï¼Œä½†è¯·é‡ç‚¹éªŒè¯å…¼å®¹æ€§å’Œåºåˆ—åŒ–è·¯å¾„ï¼Œä»¥é˜²åœ¨å¤šè¿›ç¨‹éƒ¨ç½²æˆ–æ—§ä»£ç ç¯å¢ƒä¸­å‡ºç°éšè—é”™è¯¯ã€‚

---

#### ğŸŸ¢ ä½é‡è¦åº¦å˜æ›´ (3)

### [ROCm] [CI] Reduce Resource of two test groups (#34059)
**SHA**: `785cf28` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/vllm-project/vllm/commit/785cf28ffffeddeecf79018074a222b7c5938f9c)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šé…ç½®è°ƒæ•´  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šå°† CI æµ‹è¯•æµæ°´çº¿ä¸­ä¸¤é¡¹ Benchmarks æ­¥éª¤çš„ `agent_pool` ä» `mi325_8` è°ƒæ•´ä¸º `mi325_1`ï¼Œä»¥é™ä½èµ„æºå ç”¨ã€‚

---

### [ROCm][Bugfix] fix act_quant_fusion module import error (#34069)
**SHA**: `ab10d79` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/vllm-project/vllm/commit/ab10d798555ee3611f82e71cbe573086fb92a4ed)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šä»£ç é‡æ„  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šä¿®å¤ ROCm ç¯å¢ƒä¸‹çš„æ¨¡å—å¯¼å…¥é”™è¯¯ï¼Œå°† `activation_quant_fusion` çš„ç›¸å¯¹å¯¼å…¥è·¯å¾„ä»ä¸Šå±‚ç›®å½•æ”¹ä¸ºåŒå±‚ç›®å½•çš„ `act_quant_fusion`ï¼Œç¡®ä¿ `ActivationQuantPattern` èƒ½æ­£ç¡®åŠ è½½ã€‚

---

### [CI/Build] Skip GCS test (#34057)
**SHA**: `7fcb705` | ğŸ”— [æŸ¥çœ‹æäº¤](https://github.com/vllm-project/vllm/commit/7fcb705b80176fbdb92dd94f27f566c876d8b8a9)

**ğŸ¯ å˜æ›´ç±»å‹**ï¼šæµ‹è¯•ä¿®æ”¹  
**âš¡ é‡è¦ç¨‹åº¦**ï¼šğŸŸ¢ä½  
**ğŸ“‹ æ‘˜è¦**ï¼šåœ¨ `test_runai_model_loader_download_files_gcs` ä¸Šæ·»åŠ  `@pytest.mark.skip` æ ‡è®°ï¼Œæš‚æ—¶è·³è¿‡å›  GCS è®¿é—®é—®é¢˜å¯¼è‡´çš„æµ‹è¯•ï¼Œå¾…é—®é¢˜è§£å†³åæ¢å¤ã€‚

---

