# 每日更新报告（2026-01-28）

## ai-dynamo/dynamo

| 提交时间 | 作者 | 提交信息 |
|----------|------|----------|
| 2026-01-28 18:42:53 | Yan Ru Pei | chore: make core kv-router its own crate (#5677) |
| 2026-01-28 11:51:29 | Alec | chore: bump vLLM to 0.14.1 (#5691) |
| 2026-01-28 11:01:34 | Hongkuan Zhou | feat: global router for hierarchical planner (#5697) |
| 2026-01-28 09:39:58 | GuanLuo | chore: add multimodal image benchmark scripts for performance evaluation (#5509) |
| 2026-01-28 09:24:12 | Keiven C | docs: DYN-1967 update metrics docs after kvstats removal (#5704) |
| 2026-01-28 09:22:10 | Keiven C | fix: correct SGLang metrics prefix from sglang_ to sglang: (#5701) |
| 2026-01-28 06:26:11 | Dmitry Tokarev | chore: Bump rust lib oneshot to 0.1.13 (#5694) |
| 2026-01-28 06:06:34 | Graham King | chore: Fix tests logging setup (#5693) |
| 2026-01-28 05:21:23 | Yan Ru Pei | chore: type ZmqMessage (#5689) |
| 2026-01-28 04:37:08 | Qi Wang | feat: implement EncoderCacheManager (#5632) |
| 2026-01-28 02:55:50 | Biswa Panda | fix: add recv timeout for zmq transport (#5685) |
| 2026-01-28 02:47:26 | Nate Mailhot | fix: link checking (#5209) |

### 📊 统计摘要
> 本日共 12 个提交 | 🔴高 3 | 🟡中 4 | 🟢低 5
## 📋 目录

- [ai-dynamo/dynamo](#ai-dynamo-dynamo)
  - [📊 统计摘要](#-统计摘要)
  - [🔴 高重要度变更 (3)](#-🔴-高重要度变更-3)
    - [feat: global router for hierarchical planner (#5697)](#8ebfd1e)
    - [feat: implement EncoderCacheManager (#5632)](#4636eca)
    - [fix: link checking (#5209)](#9c71f28)
  - [🟡 中重要度变更 (4)](#-🟡-中重要度变更-4)
    - [chore: make core kv-router its own crate (#5677)](#649d9b7)
    - [chore: add multimodal image benchmark scripts for perform...](#903f818)
    - [fix: correct SGLang metrics prefix from sglang_ to sglang...](#e555780)
    - [fix: add recv timeout for zmq transport (#5685)](#bc76247)
  - [🟢 低重要度变更 (5)](#-🟢-低重要度变更-5)
    - [chore: bump vLLM to 0.14.1 (#5691)](#63bee8b)
    - [docs: DYN-1967 update metrics docs after kvstats removal ...](#8e72fb6)
    - [chore: Bump rust lib oneshot to 0.1.13 (#5694)](#2d6babe)
    - [chore: Fix tests logging setup (#5693)](#90b0759)
    - [chore: type ZmqMessage (#5689)](#382a26f)
#### 🔴 高重要度变更 (3)

### feat: global router for hierarchical planner (#5697)
**SHA**: `8ebfd1e` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/8ebfd1e4e7f12c69a16a95c38c4f387278a166eb)

**🎯 变更类型**：功能增强  
**⚡ 重要程度**：🔴 高  
**📋 变更摘要**：在 `components/src/dynamo` 新增 **global_router** 模块，实现一个在前端与各本地 router 之间的层级路由服务。该服务同时注册为 `Prefill` 与 `Decode` 两类 worker，依据请求的 **输入序列长度 (ISL)、首令时间目标 (TTFT)、上下文长度、交叉令延迟目标 (ITL)** 通过配置的二维网格映射选择对应的 **prefill** 或 **decode** 池（命名空间），并将请求转发给对应的本地 router。同步更新了 GitHub CI 过滤、CODEOWNERS 与示例文档，提供完整的配置、使用脚本以及 README。

---

### 🎯 影响范围
- **核心组件**：`dynamo.frontend`、`dynamo.router`、`dynamo.mocker`、`dynamo.runtime`（新增 client/endpoint 交互）。
- **新模块**：`dynamo.global_router`（`__init__.py`, `__main__.py`, `handler.py`, `pool_selection.py`）。
- **CI/治理**：`.github/filters.yaml`、`CODEOWNERS` 增加对 `global_router` 目录的监控。
- **示例**：`examples/hierarchical_planner`（完整的配置、运行脚本、文档）。

---

## 🔍 技术洞察

### 架构影响
| 维度 | 影响描述 |
|------|----------|
| **层级结构** | 引入 **Global Router** 作为额外的中间层，实现 **前端 → Global Router → 本地 Router → Worker** 的四层链路，支持基于 SLA 的池选择。 |
| **命名空间** | 通过 `DYN_NAMESPACE` 环境变量区分不同池的 Dynamo 命名空间，避免前端与本地 router 注册冲突。 |
| **注册模型** | 使用 `register_llm` 同时注册 `ModelType.Prefill` 与 `ModelType.Chat|Completions`，保持对现有前端模型注册机制的兼容。 |
| **可插拔性** | 池数量、命名空间及映射策略全部由 JSON 配置驱动，支持灵活的水平扩缩容。 |
| **依赖关系** | `handler` 通过 `runtime.namespace(...).component(...).endpoint(...).client()` 动态创建 `Client`，对 `dynamo.runtime` 的新 API 有一定依赖。 |

### 性能影响
| 维度 | 正向效果 | 潜在负面 |
|------|----------|----------|
| **额外网络往返** | 只在同进程或同机器内部（基于 `dyn://` 协议）创建 RPC，延迟一般在毫秒级。 | 增加一次 **router → global router → local router** 的跳转，可能在跨机器部署时导致额外网络 RTT。 |
| **负载均衡** | 可以根据 **TTFT/ITL SLA** 将请求分配到最适合的池，实现更好的资源利用率和吞吐。 | 错误的映射表或不均衡的池配置会导致热点池，性能下降。 |
| **并发** | 每个池拥有独立的本地 router 与 worker，天然支持并行处理。 | 全局 Router 本身是单实例，若请求速率极高，需要监控其 CPU/IO 利用率并考虑水平扩展（如多实例+服务发现）。 |
| **监控/指标** | `serve_endpoint` 加入 `metrics_labels`（`service=global_router`），便于区分 prefill/ decode 负载。 | 需要在监控平台补全 **pool selection**、**转发时延** 等自定义指标，避免盲点。 |

### 安全考虑
- **配置安全**：`load_config` 直接 `json.load` 并抛出异常，未做 schema 校验，恶意或错误的 JSON 可能导致服务启动失败或映射错误。建议加入 **JSON Schema** 验证或 Pydantic 模型。  
- **输入校验**：`handler.handle_prefill/handle_decode` 仅取 `token_ids`、`extra_args`，未验证 **ISL、TTFT、ITL** 是否为合法数值或是否超出配置范围，可能导致异常或错误路由。  
- **网络暴露**：`global_router` 通过 `runtime.namespace(...).component(...).endpoint(... )` 注册公开的 RPC 接口，若部署在不受信任网络，需要配合 **TLS / mTLS** 或 **授权 token**（现有 Dynamo 框架已有安全层，但需确认在多命名空间场景下的访问控制策略）。  
- **权限继承**：`CODEOWNERS` 已加入对应目录，保证审查流程；但在 CI 中未增加 **安全审计** 检查，需要在工作流中加入安全 lint（例如 `bandit`）。  

---

## ⚠️ 潜在风险
1. **配置不一致**  
   - `num_prefill_pools` 与 `prefill_pool_dynamo_namespaces` 长度不匹配、映射矩阵维度错误会抛 `ValueError`，导致服务启动失败。  
   - 默認 `default_ttft_target` / `default_itl_target` 為 `None` 時，會使用區間中點；若用戶未提供 `extra_args` 且配置區間過大，選擇的池可能不符合實際需求。

2. **单点故障**  
   - Global Router 为唯一入口，若进程崩溃或资源耗尽（CPU/内存）会导致整个服务不可用。需要配合 **process supervisor**（systemd、k8s deployment）并实现 **健康检查**。

3. **资源泄漏**  
   - `handler.initialize` 中对每个本地 router 创建 `Client`，但在异常退出时未显式关闭，可能导致 dangling 连接。建议在 `finally` 或 `async with` 中管理。

4. **并发竞争**  
   - `handler` 的成员变量（如 `prefill_clients`）在多协程环境下只读，但如果后期加入动态池增删，需加锁或使用 `asyncio.Lock`。

5. **错误传播**  
   - `handle_prefill/handle_decode` 捕获异常后直接 `raise`，这会导致对应 endpoint 的 `serve_endpoint` 终止并可能触发全局 router 重启。可以改为返回错误结构并记录，避免服务整体挂掉。

6. **兼容性**  
   - 目前仅在 **vLLM** 与 **Mocker** 后端上实现同步 prefill 路径；若用户在同一集群中混用 **SGLang**、**TensorRT-LLM**，会因缺少 bootstrap 支持而产生运行时错误。

---

## 💡 关注建议
| 类别 | 建议 |
|------|------|
| **配置管理** | - 使用 **Pydantic** 或 **jsonschema** 对 `global_router_config.json` 进行严格校验（字段类型、范围、矩阵维度）。<br>- 为每个池提供 **可选的超时/重试** 配置，以防单池失效时自动切换。 |
| **容错/高可用** | - 将 Global Router 部署为 **多个副本 + 负载均衡**（如 k8s Service），并使用共享的 **状态持久化**（如 etcd）记录已注册的本地 router 列表。<br>- 实现 **健康检查 endpoint**（`/healthz`），供 orchestrator 监控。 |
| **资源回收** | - 在 `handler.initialize` 与异常路径中加入 `client.close()`（如果 `Client` 支持），确保连接在异常退出时释放。 |
| **性能监控** | - 记录 **转发前后时延**（request 接收 → 本地 router 返回），并在监控平台上做 SLA 报警。<br>- 对每个池的 **并发量、队列深度** 进行

---

### feat: implement EncoderCacheManager (#5632)
**SHA**: `4636eca` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/4636ecaf8860ff641af0625a9e44be0d70f3c6d2)

**🎯 变更类型**：功能增强（feat）  
**⚡ 重要程度**：🔴高  

**📋 变更摘要**  
本次提交在 `components/src/dynamo/common/memory` 中新增了 **EncoderCacheManager**，实现了基于 `OrderedDict` 的 LRU 缓存，用于存放 encoder 产生的 embedding 张量。缓存大小以字节为单位进行严格的容量限制，并在插入时自动驱逐最久未使用的条目。同步提供了一套完整的单元测试，覆盖初始化、基本读写、LRU 驱逐、内存统计以及对非连续张量的断言。  

**🎯 影响范围**  
- `dynamo.common.memory` 包（新增 `encoder_cache_manager.py`、`__init__.py`）  
- 未来所有需要复用 encoder 输出的组件（如 tokenizer、retriever、pipeline）可通过 `EncoderCacheManager` 引入缓存层  
- 测试目录 `dynamo/common/tests/memory`（新增 243 行单元测试）  

**🔍 技术洞察**  

| 维度 | 影响分析 |
|------|----------|
| **架构影响** | - 引入了 **纯 Python 层** 的缓存服务，使得 encoder 的输出可以在同一进程内复用，降低重复计算成本。<br>- 采用 **显式依赖注入**（`EncoderCacheManager` 实例在需要的组件中创建），对现有架构侵入最小，易于后期在 `dynamo.core` 或 `dynamo.pipeline` 中统一管理。<br>- 通过 `__all__` 暴露，保持了对外 API 的清晰度，未来可在 `dynamo.common` 统一提供更多缓存实现（如磁盘缓存）。 |
| **性能影响** | - **命中率提升**（取决于调用方）可显著降低 encoder 前向推理的 GPU/CPU 负载，尤其在批量处理或多轮对话场景下。<br>- LRU 实现基于 `OrderedDict.move_to_end`，在 CPython 中为 **O(1)**，对常规插入/查询开销几乎可以忽略。<br>- 额外的 **内存统计与日志** 开销极低；唯一可能的性能瓶颈是 **张量尺寸计算**（`tensor.element_size()*tensor.numel()`）在极大张量时略有开销，但仍属常数级。 |
| **安全考虑** | - 代码本身不涉及网络或文件 I/O，安全风险主要来自 **内部资源滥用**：恶意或错误的调用方可以不断插入极大张量导致 **内存耗尽**（虽然超过容量的张量会被拒绝，但连续插入接近容量的张量仍会触发大量 evict‑log）。<br>- **线程安全**声明为 “非线程安全”，若在多线程/多进程环境误用，可能出现竞争导致统计不一致或缓存失效。<br>- 日志中会打印键的前缀，可泄露业务敏感的 **content‑hash**，建议在生产环境使用 **INFO** 级别以上的过滤或脱敏。 |
| **可维护性** | - 代码结构简洁，使用标准库实现，易于阅读和维护。<br>- 通过 `@property stats` 暴露统一统计，便于监控和调优。<br>- 单元测试覆盖率高（覆盖初始化、LRU、大小跟踪、统计、异常路径），降低后续改动的回归风险。 |

**⚠️ 潜在风险**  

1. **非线程安全**：若在 `asyncio` 之外的多线程环境使用，可能出现 race condition，导致缓存状态错乱。  
2. **非连续张量断言**：`_tensor_size` 强制要求张量连续；在实际使用中，某些转置或切片操作得到的张量可能非连续，导致 `AssertionError`，使用方需要显式 `.contiguous()`，否则易引发运行时异常。  
3. **GPU 张量管理**：缓存的张量可能在 GPU 上，`OrderedDict` 保存的是 `torch.Tensor` 对象的引用，若未在 eviction 时调用 `tensor.detach()` 或手动 `torch.cuda.empty_cache()`，会导致 **GPU 显存泄漏**。  
4. **键碰撞/哈希冲突**：当前仅使用字符串键，若业务侧自行构造不唯一的 key（如截断的 hash），会导致误覆盖。  
5. **日志泄露**：`logger.debug` 打印键的前 16 位，可能泄露业务敏感信息。  

**💡 关注建议**  

| 建议 | 说明 |
|------|------|
| **线程安全包装** | 若计划在多线程/多进程环境使用，考虑在内部加 `threading.Lock` 或使用 `collections.UserDict` + `asyncio.Lock`，并在文档中标明使用约束。 |
| **GPU 安全 eviction** | 在 `set` 方法的 eviction 路径中加入 `evicted_tensor.cpu()`（或 `del evicted_tensor`）并显式调用 `torch.cuda.empty_cache()`，避免显存残留。 |
| **连续张量自动处理** | 将 `_tensor_size` 改为在非连续时自动 `tensor = tensor.contiguous()`，或在 `set` 前统一调用 `tensor = tensor.contiguous()`，降低使用门槛。 |
| **键规范化** | 在 API 层添加 `def _normalize_key(key: str) -> str`，比如使用 SHA‑256 完全散列，防止业务自行产生冲突。 |
| **日志脱敏** | 在生产环境将 `logger.debug` 调整为 `logger.info` 并去除键值打印，或使用 `hash(key)[:8]` 替代完整前缀。 |
| **监控与告警** | 将 `stats` 接口接入现有监控平台（Prometheus、Grafana），设置 **利用率 > 80%** 或 **miss率高于阈值** 的告警，以便及时调节容量。 |
| **文档示例** | 在 `README` 或组件文档中加入典型使用示例（包括 `contiguous` 处理、GPU vs CPU 示例），帮助开发者快速上手且避免常见坑。 |
| **扩展性** | 预留 `backend` 抽象（如基于 `diskcache`、`redis`）的接口，方便以后实现跨进程或分布式缓存。 |

---  

**总结**  
此次引入的 `EncoderCacheManager` 为 Dynamo 项目提供了一个轻量级、易于集成的 embedding 缓存方案，能够显著降低重复 encoder 计算的开销。代码实现简洁且配套测试完整，风险主要集中在 **线程安全** 与 **GPU 显存管理** 两个方面。通过上述针对性的改进与监控措施，可在保证安全与稳定性的前提下，快速释放缓存带来的性能红利。

---

### fix: link checking (#5209)
**SHA**: `9c71f28` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/9c71f28634ffa0be942301b80b9e1bfca9b8dd34)

**🎯 变更类型**：Bug修复  

**⚡ 重要程度**：🔴高  

**📋 变更摘要**：  
- 对 `.github/workflows/detect_broken_links.py` 进行大幅重构，解决了以下问题：  
  1. 误报 attribution、LICENSE 等文件的链接：引入 `skip_patterns` 并在文件遍历阶段过滤。  
  2. 处理 markdown 中的 symlink 链接时与 GitHub 实际行为不一致：改为 **相对 symlink 本身** 解析路径。  
  3. 纠正对目录链接、非 markdown（图片、代码等）文件链接的判断逻辑，加入 `error_reason` 记录更友好的错误信息。  
- 同步更新 CI 工作流 `docs-link-check.yml`，在 GitHub 注释中输出 `error_reason`。  
- 更新 README 中的链接与路径，使文档保持最新。

**🎯 影响范围**：  
- CI/CD 链路检查脚本 `detect_broken_links.py`（GitHub Actions）。  
- GitHub Actions 工作流文件 `docs-link-check.yml`（错误报告展示）。  
- 项目根目录及 `examples/`、`README.md` 中的文档链接（展示层面，无运行时影响）。  

---  

### 🔍 技术洞察  

| 维度 | 影响说明 |
|------|-----------|
| **架构影响** | 仅影响 CI 链路检查子系统，属于 **外围工具**，不触及 Dynamo 主体代码或运行时库。对项目整体架构安全、可用性无结构性冲击。 |
| **性能影响** | 增加了少量字符串匹配 (`skip_patterns`、路径后缀判断) 与 `Path.is_dir()` 检查；在 CI 环境下的文件数量在千级别，性能开销几毫秒，属于 **忽略不计**。 |
| **安全考虑** | - 采用 `Path.resolve()` 前对 symlink 位置而非目标解析，避免出现 **路径穿越** 导致错误报告或潜在泄露本地文件路径的情况。<br>- 仍然使用 `Path` 的安全 API，未引入外部输入的 shell 调用或系统命令，安全风险极低。 |
| **可维护性** | - 代码结构更清晰：把 “是否为 markdown/目录/其他文件” 判定抽离为四段布尔变量，便于后续增删判定规则。<br>- 引入 `error_reason` 字段，错误信息更具可读性，调试时不必再回溯脚本。<br>- `skip_patterns` 集中管理，可随时在 CI 中添加新文件类型。 |

---  

### ⚠️ 潜在风险  

1. **误报/漏报新类型文件**：`skip_patterns` 只列举了常见的 attribution/第三方许可证文件，若项目未来新增其他不应检查的文档（如 `NOTICE`），仍会被误报。  
2. **相对路径解析差异**：改为相对 symlink 本身解析后，若仓库中已有基于“目标目录”写的链接（历史遗留），可能会被错误标记为断链。  
3. **目录链接判断依赖尾随斜杠**：如果链接指向目录但未加 `/`，而实际路径为目录，仍会被当作文件处理，可能出现误报。  
4. **CI 兼容性**：工作流中加入 `error_reason` 的输出格式，如果后续有人在别处解析原始 JSON 结构，可能需要同步更新。  

---  

### 💡 关注建议  

- **对现有文档做一次全量审查**：尤其是那些通过 symlink 引入的 markdown，确认链接仍保持有效。  
- **持续维护 `skip_patterns`**：在仓库新增特殊文档（如 `CODEOWNERS`、`SECURITY.md`）时及时加入过滤列表。  
- **在 CI 中保留宽松模式**：可考虑在 `detect_broken_links.py` 添加 `--ignore-warnings` 参数，以便在新链接迁移期间暂时抑制非关键报错。  
- **文档更新同步**：README 中的链接已经修正，建议在下一个发布迭代中同步更新对应的 `recipes/` 目录结构，以避免用户点击失效链接。  
- **监控 CI 运行结果**：首次部署后观察 Broken Link 检查的报告频率，若出现大量新报错，需快速回滚或手动修正文档。  

---  

**总体结论**：此次提交显著提升了项目文档链接检查的准确性和可读性，避免了 CI 因误报而阻塞的风险，对项目的交付质量和维护效率具有 **高价值**，建议合并后在下一次 CI 运行中观察实际效果。

---

#### 🟡 中重要度变更 (4)

### chore: make core kv-router its own crate (#5677)
**SHA**: `649d9b7` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/649d9b7d30fab690f3e7b886e1d6cd47be383420)

**🛠 变更类型**：重构（将 KV Router 从 `dynamo-llm` 拆分为独立 crate）  
**⚡ 重要程度**：🟡 中  

**📋 核心改动**  
1. 新增 `lib/kv-router` crate，声明 `metrics` 与 `bench` 可选特性，并在 `Cargo.toml` 中加入 workspace 成员。  
2. `dynamo-llm` 现在通过 `dynamo-kv-router` 依赖引用其实现，删除原有内部代码的重复实现；相关路径 (`use crate::kv_router::…`) 全部改为 `use dynamo_kv_router::…`。  
3. 将原先 `kv_router` 模块的错误、协议、近似算法等文件迁移到新 crate，并在 `lib.rs` 中统一导出关键类型（`RadixTree`, `RouterEvent`, `MaybeError` 等）。  
4. 为避免在未开启 `metrics` 时仍引用 `dynamo-runtime`，在 `indexer.rs` 中使用 `#[cfg(feature = "metrics")]` 条件编译，并提供一个简易的 `MaybeError` trait 替代实现。  
5. 更新 `dynamo-tokens`：新增 `uuid` 依赖、把 `blocks.rs` 中的 `UniqueBlock` 与 `GlobalHash` 移到独立模块并公开。  
6. 移除原 `llm` crate 中的基准 `radix_tree_microbench`，改为在 `kv-router` 中使用 `bench` 特性。  
7. 相关模块（`scheduler.rs`, `sequence.rs`, `mocker/*`）的 `use` 路径全部指向 `dynamo_tokens`，确保统一的 token 定义。  

**🎯 影响范围**  
- `dynamo-llm`（编译时需开启 `metrics` 特性，否则会缺少 `MaybeError` 实现）。  
- `dynamo-runtime`（仅在 `kv-router` 启用 `metrics` 时被拉入）。  
- `dynamo-tokens`（新增 `uuid` 依赖，暴露 `blocks` 子模块）。  
- 所有使用 KV Router 的上层项目（如示例、benchmark）需更新 Cargo 依赖路径及特性声明。  

**💡 关注建议**  
1. **特性一致性**：在 CI 中加入矩阵测试，分别在 `metrics` 开/关下编译 `dynamo-llm`，确保 `MaybeError` 的两套实现都能通过。  
2. **文档/示例同步**：更新 README 与 benchmark 脚本，使用 `cargo bench -p dynamo-kv-router --bench radix_tree_microbench`。  
3. **版本兼容**：确认 workspace 中其他 crates（如 `dynamo-async-openai`）的 `Cargo.toml` 没有遗漏对 `dynamo-kv-router` 的可选依赖。  
4. **运行时依赖**：若历史二进制仍在 `metrics` 关闭的环境运行，需要在 `KvIndexerMetrics::new` 中安全处理 `None`（当前已通过 `#[cfg(feature = "metrics")]` 隐藏）。  
5. **测试覆盖**：迁移后原 `kv_router` 单元测试已在新 crate 中保留，建议在 `dynamo-llm` 中添加几条高层集成测试，验证 `dynamo_llm::kv_router` 的公开 API 与旧行为一致。  

整体来看，此次拆分提升了模块化和可复用性，但请务必在所有打开/关闭 `metrics` 场景下进行完整编译、单元与集成测试，以避免运行时缺失符号或特性冲突。

---

### chore: add multimodal image benchmark scripts for performance evaluation (#5509)
**SHA**: `903f818` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/903f81849826bcc49954b473fdab3f9726fbbca6)

**🎯 变更类型**：功能增强（新增多模态图片基准脚本、本地媒体服务器示例）+ 重构（编码路径改为异步、可通过 `VLLM_ENCODER` 切换实现）  

**⚡ 重要程度**：🟡 中  

**📋 变更摘要**  
1. 新增 three benchmark shell 脚本（large、small、small‑50‑isl‑ratio），用于评估多模态模型在不同尺寸图片和不同 prompt 长度下的吞吐与延迟。  
2. 新增 `benchmarks/multimodal/local_media_server.py`，提供本地图片服务备选实现。  
3. `encode_worker_handler` 将调用 `encode_image_embeddings` 包装为 `asyncio.to_thread`，避免阻塞主协程。  
4. 在 `encode_utils` 与 `model.py` 中新增 `VLLM_ENCODER` 环境变量，默认使用 vLLM 自带视觉编码器；通过 `load_vision_model` 直接返回 vLLM 的视觉子模型。  
5. 调整示例启动脚本的 GPU‑memory‑utilization、max‑model‑len 参数，以及单/多 GPU 启动顺序，防止两个 vLLM 实例争抢同一块显存。  

**🎯 影响范围**  
- `components/src/dynamo/vllm/multimodal_handlers/`（编码工作线程）  
- `components/src/dynamo/vllm/multimodal_utils/`（编码工具、模型加载）  
- `examples/backends/vllm/launch/`（启动脚本）  
- `benchmarks/multimodal/`（新增 benchmark 与本地服务器工具）  

**💡 关注建议**  

1. **兼容性**：`VLLM_ENCODER` 默认开启，若用户仍依赖原 `transformers` 编码器，需要在运行前显式 `export VLLM_ENCODER=0`，并在文档中说明。  
2. **异步安全**：`asyncio.to_thread` 只包装 CPU‑bound 编码函数，确保该函数内部不再依赖全局 CUDA 上下文，否则可能出现多线程 CUDA 初始化冲突。建议在 CI 中加入并发编码的压力测试。  
3. **显存管理**：`load_vision_model` 现在会实例化完整的 vLLM 模型再取视觉子模块，显存占用明显提升。请在 README 或 benchmark 文档中提醒用户根据显卡容量调低 `gpu_memory_utilization` 或使用 `VLLM_ENCODER=0`。  
4. **脚本可维护性**：benchmark 脚本硬编码了 URL 与请求数，建议提供 `--request-count`、`--warmup-request-count` 等可选参数，以便用户自行定制。  
5. **本地媒体服务器**：当前实现仅作参考，未在 CI 中使用。若后续正式采用，请考虑加入缓存控制、超时重试以及 `Content-Type` 检测，避免因图片格式不一致导致 benchmark 误差。  
6. **清理 Debug 标记**：代码中多处 `# [gluo NOTE]` 提及调试开关，计划在下个里程碑前移除或封装为内部 feature flag。  

总体来看，改动为多模态评测提供了完整的脚本和更高效的编码路径，但需要注意显存占用和环境变量的默认行为，建议在文档中补充使用说明并增加相应的自动化测试。

---

### fix: correct SGLang metrics prefix from sglang_ to sglang: (#5701)
**SHA**: `e555780` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/e5557803ef04bfdc2784b913b4f3abaf26019497)

**🎯 变更类型**：Bug 修复  
**⚡ 重要程度**：🟡 中  
**📋 变更摘要**：修正了 SGLang 指标前缀的错误写法。`publisher.py` 中去掉了错误的 `add_prefix="sglang_"`，改为仅使用 `metric_prefix_filters=["sglang:"]`；相应地，测试用例也将期望的指标名称从 `sglang_*` 改为 `sglang:*`（正则 `^sglang:\w+`），确保收集到的指标前缀与实际导出的保持一致。  

**🎯 影响范围**  
- **核心组件**：`components/src/dynamo/sglang/publisher.py`（指标注册与前缀处理）  
- **测试套件**：`tests/utils/payloads.py`（指标名称校验）  
- 可能波及的模块：使用 SGLang 指标的监控面板、Grafana 仪表盘以及任何基于 `sglang:` 前缀的告警规则。  

**💡 关注建议**  
1. **确认部署**：在生产环境重新部署后，检查 Prometheus 中 `sglang:` 前缀的指标是否已成功出现，避免因旧的 `sglang_` 前缀导致的监控盲区。  
2. **更新告警/仪表盘**：若已有告警或仪表盘硬编码为 `sglang_*`，需同步改为 `sglang:`。  
3. **兼容性检查**：该改动是向后兼容的（仅去除错误前缀），但建议保留旧前缀的迁移脚本，以防偶尔仍有旧版本残留指标。  
4. **持续集成**：确保 CI 中的指标检查（`MetricCheck`）通过，防止未来再次出现前缀不一致的问题。  

整体来看，此次修改仅涉及名称前缀的校正，对业务功能无直接影响，但对监控数据的准确性至关，建议在部署后验证一次 Prometheus 抓取结果。

---

### fix: add recv timeout for zmq transport (#5685)
**SHA**: `bc76247` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/bc76247dfffa655f66ea4b46bb1a190556f24461)

**🎯 变更类型**：Bug 修复  
**⚡ 重要程度**：🟡 中（阻塞导致的测试/运行时卡死被根除，但行为略有变化）  

**📋 变更摘要**  
- 为 ZMQ 订阅端（`ZmqSubTransport`）加入 `ZMQ_RCVTIMEOUT_MS = 100` ms 的接收超时，避免在 “slow‑joiner” 场景下永久阻塞。  
- 将 `socket.set_rcvtimeo` 从 `-1`（无限阻塞）改为上面的常量。  
- 收包循环改为在阻塞任务中返回 `Option<...>`，当收到 `EAGAIN`（超时）时返回 `None` 并继续轮询。  

**🎯 影响范围**  
- `lib/runtime/src/transports/event_plane/zmq_transport.rs` 中的 ZMQ 传输层实现。  
- 与 ZMQ 相关的单元测试和可能使用该传输的上层模块（如事件平面、调度器等）。  

**💡 关注建议**  
- **开发者**：  
  1. 检查是否有业务对 **阻塞** 的假设（如期望 `recv` 永不返回 `None`），必要时在上层添加超时重试或日志。  
  2. 超时时间硬编码为 100 ms，若不同部署需更灵活，可考虑通过环境变量或配置项暴露。  
  3. 运行完整的集成测试，确保在网络抖动或高负载下仍能保持消息顺序与完整性。  

- **用户**：  
  - 此次修复是透明的，API 未变，现象上会看到之前卡住的测试/服务能够顺利退出或继续运行。若对极端低延迟有特殊要求，可关注后续是否提供可调超时配置。  

总体而言，此改动提升了系统鲁棒性，消除了因 ZMQ “slow‑joiner” 引起的永久阻塞风险，副作用仅为在极短的超时时间窗口内可能略微增加轮询次数。

---

#### 🟢 低重要度变更 (5)

### chore: bump vLLM to 0.14.1 (#5691)
**SHA**: `63bee8b` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/63bee8b3039e3598860f2edca06b84f4e452c963)

**🎯 变更类型**：配置调整  
**⚡ 重要程度**：🟢低  
**📋 摘要**：将 vLLM 版本从 0.14.0 升级至 0.14.1，更新 Dockerfile、安装脚本、pyproject.toml 中的依赖声明，并同步文档中的版本说明。

---

### docs: DYN-1967 update metrics docs after kvstats removal (#5704)
**SHA**: `8e72fb6` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/8e72fb69cf05220bb74bf264f4ea01c252bfbb40)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：删除已移除的 KV 缓存统计 (kvstats) 相关文档与示例，并相应更新 Python 代码生成的模块导入，确保文档与生成代码保持一致。

---

### chore: Bump rust lib oneshot to 0.1.13 (#5694)
**SHA**: `2d6babe` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/2d6babe5fce25435ef1ff9ec7e2008d6c29245f4)

**🎯 变更类型**：配置调整  
**⚡ 重要程度**：🟢低  
**📋 摘要**：将 `oneshot` 依赖从 0.1.11 升级至 0.1.13，并相应更新 Cargo.lock（包括 checksum 与锁文件中新增的 lru、tmq、zmq 等依赖的记录）。整体仅影响构建配置，无功能代码改动。

---

### chore: Fix tests logging setup (#5693)
**SHA**: `90b0759` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/90b075943270e8cb9dc3b81f223da6853d30c4c9)

**🎯 变更类型**：测试修改  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在两个单元测试中改用 `crate::logging::init()` 初始化日志，删除了冗余的 `tracing_subscriber` 初始化代码和未使用的 `futures::StreamExt` 导入。

---

### chore: type ZmqMessage (#5689)
**SHA**: `382a26f` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/382a26f0ab7c53eb74f5f4ee6827521d5afa8a66)

**🎯 变更类型**：代码重构  
**⚡ 重要程度**：🟢低  
**📋 摘要**：新增 `ZmqMessage` 结构体封装 ZMQ 多部件消息，并将原先的元组接收逻辑重构为返回该结构体，提升代码可读性与可维护性。

---

