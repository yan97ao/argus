# 每日更新报告（2026-01-15）

## ai-dynamo/dynamo

| 提交时间 | 作者 | 提交信息 |
|----------|------|----------|
| 2026-01-15 11:55:01 | atchernych | fix: Dyn-1729 enable etcd-less GAIE deployment in the helm chart (#5432) |
| 2026-01-15 08:23:09 | Anish | docs: Documentation audit and updates for 0.8 (#5380) |
| 2026-01-15 07:16:46 | Ryan McCormick | docs: Add pip install section to kvbm readme (#5423) |
| 2026-01-15 05:23:18 | Harrison Saturley-Hall | feat: frontend container attributions from EPP (#5435) |
| 2026-01-15 05:13:44 | MatejKosec | feat: SLA Planner configuration support for DEP and TEP VLLM (#4783)<br>Extends the MOE planner profiler to support  TEP (tensor expert parallel) and DEP (data expert parallel) configs with the vllm backend |
| 2026-01-15 03:29:33 | Qi Wang | fix: fix worker's push_handler non-blocking error upon stop word (#5157) |
| 2026-01-15 02:54:16 | Neal Vaidya | fix: update hello_world example to remove etcd (#5422) |
| 2026-01-15 02:46:17 | Keiven C | fix: build.sh to use release branch for version detection (#5425) |
| 2026-01-15 02:34:22 | Dillon Cullinan | fix: Clean up Velonix PR workflows (#5405) |
| 2026-01-15 00:20:42 | Graham King | chore(router): Remove deprecated best_worker_id and metrics_labels (#5412) |
| 2026-01-15 00:13:22 | jh-nv | fix: Properly handle multiple text components from request (#5196) |

### 📊 统计摘要
> 本日共 11 个提交 | 🔴高 5 | 🟡中 5 | 🟢低 1
## 📋 目录

- [ai-dynamo/dynamo](#ai-dynamo-dynamo)
  - [📊 统计摘要](#-统计摘要)
  - [🔴 高重要度变更 (5)](#-🔴-高重要度变更-5)
    - [fix: Dyn-1729 enable etcd-less GAIE deployment in the hel...](#cf57c76)
    - [feat: frontend container attributions from EPP (#5435)](#6716de5)
    - [feat: SLA Planner configuration support for DEP and TEP V...](#7cfd966)
    - [fix: Clean up Velonix PR workflows (#5405)](#202dfc3)
    - [fix: Properly handle multiple text components from reques...](#e22bb03)
  - [🟡 中重要度变更 (5)](#-🟡-中重要度变更-5)
    - [docs: Documentation audit and updates for 0.8 (#5380)](#0d597e7)
    - [fix: fix worker's push_handler non-blocking error upon st...](#31189ee)
    - [fix: update hello_world example to remove etcd (#5422)](#332da40)
    - [fix: build.sh to use release branch for version detection...](#90ed9ab)
    - [chore(router): Remove deprecated best_worker_id and metri...](#c5458b9)
  - [🟢 低重要度变更 (1)](#-🟢-低重要度变更-1)
    - [docs: Add pip install section to kvbm readme (#5423)](#553acb4)
#### 🔴 高重要度变更 (5)

### fix: Dyn-1729 enable etcd-less GAIE deployment in the helm chart (#5432)
**SHA**: `cf57c76` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/cf57c7668afda71cc8ac092a66292d3d4a77dcd8)

**🎯 变更类型**：功能增强 / Bug 修复  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：在 GAIE（GPU‑Accelerated Inference Engine）Helm Chart 中加入 `epp.dynamo.useEtcd` 开关，默认使用 Kubernetes Service Discovery（EndpointSlices）而非原先强制的 etcd。为此更新了文档、Helm 模板、RBAC 权限以及默认 values，使得部署可以在无 etcd 环境下运行，同时仍保留通过 `--set epp.dynamo.useEtcd=true` 启用 etcd 的选项。  

**🎯 影响范围**：  
- `deploy/inference-gateway/helm/dynamo-gaie/`（Chart 模板、values、README）  
- `deploy/inference-gateway/helm/dynamo-gaie/templates/cluster-role.yaml`（RBAC）  
- `deploy/inference-gateway/helm/dynamo-gaie/templates/dynamo-epp.yaml`（容器 env）  
- `recipes/llama-3-70b/vllm/agg/gaie/k8s-manifests/rbac/cluster-role.yaml`（Endpoint → EndpointSlice 权限调整）  

**🔍 技术洞察**  

- **架构影响**  
  - 引入了 **Discovery Backend 选择器**：`kubernetes`（默认）或 `etcd`。这使 GAIE 可以在仅有标准 Kubernetes 集群的环境中直接运行，降低对外部 etcd 集群的依赖。  
  - 为 etcd 路径添加了 `POD_NAMESPACE/NAME/UID` 环境变量，便于插件在 etcd 中注册/发现自身实例。  
  - 新增了对 `dynamoworkermetadatas` CR（`nvidia.com` API） 的 RBAC 权限，以支持通过 etcd 之外的方式管理工作节点元数据。  

- **性能影响**  
  - **Kubernetes Service Discovery**（EndpointSlices）相较于 etcd 具有更低的网络跳数和更快的缓存更新，预计在大多数集群中可降低路由查询延时。  
  - 对于仍使用 etcd 的场景，额外的 Pod 信息注入不会产生显著开销。  
  - 由于默认切换为 `kubernetes`，在无需部署 etcd 的集群中省去 etcd 的启动、维护成本。  

- **安全考虑**  
  - 新增的 RBAC 权限对 `dynamoworkermetadatas` 授予了 **创建、更新、删除** 权限，若 Chart 被误用于非受信任的命名空间，可能导致恶意工作节点元数据注入。建议将该角色绑定到受限的命名空间或使用 `PodSecurityPolicy`/`OPA Gatekeeper` 进行约束。  
  - `ETCD_ENDPOINTS` 环境变量在启用 etcd 时直接暴露集群内部地址，若集群网络未做隔离，可能被非授权容器访问。使用 TLS 或网络策略对 etcd 服务进行访问控制是必要的。  

**⚠️ 潜在风险**  

1. **配置遗漏**：用户在已有 etcd 部署的环境中若忘记显式设置 `--set epp.dynamo.useEtcd=true`，会意外切换到 Kubernetes discovery，导致路由不匹配或查询不到已有模型。  
2. **RBAC 过宽**：对 `dynamoworkermetadatas` 赋予全部 CRUD 权限可能冲突于最小权限原则，尤其在多租户集群中。  
3. **版本不兼容**：`EndpointSlice` API 需要 K8s 1.21+；在旧版集群上仍依赖 `endpoints`（已在 `recipes/...` 中删除），可能导致部署失败。  
4. **环境变量冲突**：新增的 `POD_*` 环境变量在某些自定义容器镜像中可能已有同名变量，导致意外覆盖。  

**💡 关注建议**  

- **部署验证**：在首次使用新 Chart 前，通过 `helm template` 检查渲染结果，确认 `useEtcd` 开关行为符合预期。  
- **RBAC 审计**：如果不使用 `dynamoworkermetadatas`，可在 `values.yaml` 中提供 `enableWorkerMetadataRBAC` 开关，按需开启。  
- **兼容性检查**：在集群版本低于 1.21 时，提供回退到 `endpoints` 的选项或提示升级 K8s。  
- **安全加固**：为 etcd 部署启用 TLS、NetworkPolicy，并限制 `etcd` Service 只被 `dynamo-gaie` Pod 能访问。  
- **监控和日志**：在容器启动脚本中记录实际使用的 discovery backend（`DYN_DISCOVERY_BACKEND` 或 `ETCD_ENDPOINTS`），便于后期排查。  

通过上述改动，GAIE 在无 etcd 环境下可直接部署，降低运维复杂度，同时保留对已有 etcd 部署的兼容路径。后续建议持续关注 RBAC 最小化、K8s 版本兼容以及 discovery backend 的健康监控。

---

### feat: frontend container attributions from EPP (#5435)
**SHA**: `6716de5` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/6716de5513c8c2e07af0352c56ed7741768c6811)

**🎯 变更类型**：功能增强（文档/合规性）

**⚡ 重要程度**：🔴高  

**📋 变更摘要**：  
- 新增 `ATTRIBUTIONS-container-frontend.md`，完整列出前端容器使用的第三方组件及其许可证信息。  
- 旨在满足开源许可证合规要求，提升项目在法律审计和企业采用时的可信度。  
- 预计对构建、发行流程没有直接影响，但为后续合规检查提供必要依据。

**🎯 影响范围**：  
- **发行/打包脚本**（可能需要将该文件随发行包一起分发）  
- **文档生成/站点**（若项目自动聚合 `*.md` 文件）  
- **合规审计流程**（法律/合规团队）

**🔍 技术洞察**  

- **架构影响**：  
  - 本次改动仅涉及文档层面，不会改变代码结构、API 或模块依赖。  
  - 若项目的 CI/CD 流程对 `*.md` 文件进行 lint 或版权检查，需要确保新文件符合相应规则（如行宽、标题层级）。

- **性能影响**：  
  - 完全不影响运行时性能。唯一可能的间接影响是构建产物体积微增（文件随二进制/镜像一起打包），但一般在几 KB 量级，可忽略。

- **安全考虑**：  
  - 文档中若误披露内部敏感信息或未授权的代码片段，可能引发信息泄露风险。需要确认所有列出的 attribution 均来源于公开许可证，且未包含未经授权的专有代码。

**⚠️ 潜在风险**  

1. **合规遗漏**：如果 attribution 列表不完整或对应许可证版本号错误，仍可能在法律审计时被发现缺陷。  
2. **CI/CD 中断**：项目若启用了 Markdown lint、拼写检查或自动版权校验，新文件未通过可能导致 CI 失效。  
3. **发布包体积**：如果发行镜像默认把项目根目录全部复制，新增的大文件（≈13 KB）会被打入镜像，可能对极致压缩需求的环境产生微小影响。  
4. **误导信息**：若文档与实际依赖不匹配（比如某组件已经升级或移除），会产生文档和代码不一致的潜在混淆。

**💡 关注建议**  

- **合规审查**：在合并前请法律/合规团队核对列表完整性、许可证版本以及版权声明的准确性。  
- **CI 适配**：确保现有的 Markdown lint、spell‑check 或 attribution‑checker 流程已覆盖新增文件，防止因格式或拼写错误导致 CI 失效。  
- **发布脚本**：检查 `Dockerfile`、`cargo package` 或其他打包脚本，判断是否需要显式将该文件加入发行产物（通常是需要的，以满足许可证要求）。  
- **文档同步**：将该 attribution 文件在项目的文档站点或 GitHub Pages 中展示，并在 `README` 添加链接，提升可见性。  
- **后续维护**：建立定期（如每次依赖升级后）更新 attribution 的流程，最好通过脚本自动生成或校验，以降低人工维护出错概率。  

---  

*结论*：此次提交属于高重要性的合规文档补全，对系统功能、性能与安全几乎没有直接影响，但对许可证合规、法律风险以及 CI/CD 稳定性有显著正面价值。建议在合并前完成合规复核，并在 CI 中加入相应的 Markdown 检查以避免后续阻塞。

---

### feat: SLA Planner configuration support for DEP and TEP VLLM (#4783)
**SHA**: `7cfd966` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/7cfd966e51c5da33068ccdc0e4179b98a5aab818)

**🎯 变更类型**：功能增强  
**⚡ 重要程度**：🔴高  

**📋 变更摘要**  
- 为 vLLM 后端的 MOE Planner 增加了对 TEP（Tensor Expert Parallel）和 DEP（Data Expert Parallel）配置的支持，包括自动计算资源、参数调优以及 KV‑cache 大小的正确统计。  
- 新增 `--deployment-timeout` 参数并在相关部署等待逻辑中使用，提升长时间启动的容错能力。  
- 对配置模型、绘图以及预填充参数进行细化，防止多节点 DP/TP 场景下的 OOM 与插值错误。  

**🎯 影响范围**  
- `benchmarks/profiler/profile_sla.py`  
- `benchmarks/profiler/utils/config.py`、`config_modifiers/vllm.py`、`plot.py`、`profiler_argparse.py`  
- 相关的内部工具函数：`remove_valued_arguments`、`setup_worker_service_resources`、`validate_and_get_worker_args` 等  

**🔍 技术洞察**  

- **架构影响**  
  - 引入了 **多节点专家并行**（TEP/DEP）配置路径，涉及 `Container.resources` 扩展以支持 RDMA 或自定义资源。  
  - `set_config_tep_size` 与 `set_config_dep_size` 实现了 **资源调度 + 参数规整**（统一使用 `--tensor-parallel-size`、`--data-parallel-size`），并在配置模型时自动开启 `--enable-expert-parallel`。  
  - 通过 `setup_worker_service_resources` 将 **GPU‑per‑node** 与 **并行度** 关联，影响调度层的 Pod 规格生成。  

- **性能影响**  
  - **KV‑cache 统计**：从 “每 rank” 乘以 `attention_dp_size` 得到总大小，避免在多 DP 场景下低估内存需求。  
  - **预填充限额**：依据实际 DP 大小计算每 GPU 的 `--max-num-batched-tokens`，防止 DEP 场景下因全局 token 上限导致 OOM。  
  - **绘图鲁棒性**：Cubic 插值失败时自动降级到 Linear，提升 profiling 报表生成的成功率。  

- **安全考虑**  
  - 新增的 `deployment_timeout` 仅是超时控制，不涉及权限或数据安全。  
  - 通过 `resources` 字段可以向容器声明 RDMA 等特权资源，若配置不当可能导致资源滥用，需要在 CI/生产环境做好审计。  

**⚠️ 潜在风险**  

1. **参数兼容性**：删除 `--tp`、`--dp` 等别名后，外部脚本仍可能使用旧参数，导致启动失败。  
2. **资源误配**：`setup_worker_service_resources` 依赖 `num_gpus_per_node` 与并行度的正确匹配，错误的数值会产生不符合实际的 Pod 规格（可能导致调度卡死或节点资源浪费）。  
3. **KV‑cache 计算误差**：若 `attention_dp_size` 与实际 DP 不一致，统计的总 KV‑cache 可能高估/低估，进而影响后续优化决策。  
4. **超时设置**：默认 1800 s 较长，若部署异常会导致 CI 长时间阻塞；相反，过小的 timeout 可能提前中断成功的部署。  

**💡 关注建议**  

- **回归测试 & 单元测试**：为 `set_config_tep_size` / `set_config_dep_size` 增加覆盖所有别名、异常路径的测试，确保老参数仍能被容忍或给出明确错误提示。  
- **文档更新**：在 README 与 CLI 帮助中说明 `--deployment-timeout`、`--enable-expert-parallel` 以及新资源字段的使用场景与限制。  
- **监控与报警**：在生产环境对 `deployment_timeout` 超时事件做告警，以防长时间卡住的部署影响业务。  
- **安全审计**：对 `resources` 字段的值做白名单校验，防止不受信任的用户声明高危硬件（如 RDMA）导致资源争用。  
- **兼容层**：考虑在 `remove_valued_arguments` 前做一次参数映射（如保留 `--tp` → `--tensor-parallel-size`），保持向后兼容性。  

---

---

### fix: Clean up Velonix PR workflows (#5405)
**SHA**: `202dfc3` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/202dfc36e99ca675d2834dffb74958b04ecedeb3)

**🎯 变更类型**：Bug修复 / 重构  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：本次提交对 `.github/workflows/pr.yaml` 进行大幅度清理与重构。主要将原先分散的 CUDA 13 构建任务（vllm‑cuda‑13、sglang‑cuda‑13、trtllm‑cuda‑13）合并进统一的框架工作流，并通过矩阵化 `cuda_version` 实现一次性构建不同 CUDA 版本的镜像；同时统一步骤、规范名称、加入超时限制并对 ARM 平台的测试做条件过滤。  
**🎯 影响范围**：  
- CI/CD 工作流（PR 触发的 Docker 构建、镜像推送、自动化测试）  
- 镜像标签命名规则（`ai-dynamo/dynamo:<sha>-<framework>-cuda<major>-<arch>`）  
- 受影响的 GitHub Actions 依赖（`docker-build`, `docker-tag-push`, `pytest`）  

### 🔍 技术洞察
- **架构影响**  
  - **工作流层面**：从多条独立工作流统一为 3 条（vllm、sglang、trtllm）加上公共 `operator-build`，提升维护性，降低重复配置风险。  
  - **矩阵化**：引入 `cuda_version` 矩阵，使同一作业能够一次性产出 CUDA 12.9 与 CUDA 13.0 两套镜像，减少 CI 资源占用与排队时间。  
  - **可复用步骤**：通过 YAML 锚点 `&runtime-container-build-push-test` 抽取构建‑推送‑测试步骤，降低未来改动时的疏漏概率。  
- **性能影响**  
  - **CI 运行时长**：合并后同一作业会并行执行两个 CUDA 版本的构建，整体耗时相当于原来两条独立作业的叠加，但因共享 `checkout`、`docker login` 等步骤，实际耗时略有下降。  
  - **资源使用**：矩阵并行度保持不变（AMD64 GPU、ARM CPU 各两台），不增加额外机器需求。  
- **安全考虑**  
  - **密钥泄露**：未修改 secrets 使用方式，仍通过 `${{ secrets.* }}` 传递，无新增风险。  
  - **镜像标签**：统一命名规则避免手动拼写错误，有助于后续审计与访问控制。  

### ⚠️ 潜在风险
1. **矩阵变量拼写错误**  
   - `env.FRAMEWORK` 与 `${{ matrix.cuda_version.major }}` 组合的标签模板若出现意外空值，可能导致镜像未被正确推送。  
2. **ARM 测试被意外过滤**  
   - 通过 `if: ${{ env.FRAMEWORK != 'trtllm' || matrix.platform.arch == 'amd64' }}` 排除 `trtllm` 在 ARM 上的测试；若未来添加了需要在 ARM 上运行的 `trtllm` 测试，此条件会导致漏测。  
3. **超时设置**  
   - 为每个框架作业统一设定 `timeout-minutes: 90`，在极端网络/依赖下载情况下可能触发强制终止，导致 CI 误报失败。  
4. **移除的独立 CUDA 13 作业**  
   - 若外部系统（如内部监控或调度脚本）硬编码了 `vllm-cuda-13`、`sglang-cuda-13` 等作业名称，改名后会导致监控告警失效。  
5. **标签兼容性**  
   - 新增的 `-cuda<major>` 标签会影响已有的 downstream 镜像拉取脚本，需要同步更新部署文档与 CI/CD downstream 依赖。  

### 💡 关注建议
- **CI 验证**：在合并后先在 `main` 分支通过 2‑3 次 PR 完整跑通，确认所有矩阵组合均成功构建、推送并产生期望的镜像标签。  
- **监控更新**：检查内部监控、仪表盘或自动化部署脚本中是否存在硬编码的工作流名称或标签，及时同步更改。  
- **文档同步**：更新仓库的 CI/CD 文档、镜像拉取指南以及 `README` 中的标签说明，防止用户因标签变化导致拉取失败。  
- **ARM 测试路线**：如果未来计划在 ARM GPU（如 AWS Graviton + NVIDIA GPU）上运行 `trtllm`，请提前评估并移除当前的 ARM 测试过滤条件。  
- **回滚策略**：保留旧的 `vllm-cuda-13.yml`、`sglang-cuda-13.yml` 等文件的历史版本，以便在新矩阵出现异常时快速恢复。  

---  
此变更显著提升 CI 工作流的可维护性与统一性，但需要关注矩阵配置的正确性、标签兼容性以及外部监控的同步更新。祝开发顺利！

---

### fix: Properly handle multiple text components from request (#5196)
**SHA**: `e22bb03` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/e22bb0376fec83e690c8715d2987378433ca2d5c)

**🎯 变更类型**：Bug修复 / 功能增强  
**⚡ 重要程度**：🔴 高  

**📋 变更摘要**  
- 通过新增 `extract_user_text` 工具函数，改进了对 **多文本组件** 的提取逻辑，原来只能取第一个 `text` 项，现在会遍历所有 `user` 角色的 `text` 内容并用换行连接。  
- 相关模块（`preprocessor_handler.py`、示例代码、`__init__.py`）统一使用该函数，防止因消息结构变化导致的 `IndexError`。  
- 为 `SamplingParams` 添加 `field_serializer`，统一序列化方式，提升兼容性。  
- 新增单元测试覆盖各种消息组合场景，确保功能可靠。

**🎯 影响范围**  
- `components/src/dynamo/vllm/multimodal_handlers/preprocessor_handler.py`（核心请求预处理）  
- `components/src/dynamo/vllm/multimodal_utils/`（新增 `chat_message_utils.py`，`__init__.py` 导出）  
- 示例工程 `examples/multimodal/`（处理器与协议）  
- `components/src/dynamo/vllm/multimodal_utils/chat_processor.py`（删除未使用的属性）  
- `protocol.py`（新增 `field_serializer`）  
- 全项目单元测试 `components/src/dynamo/vllm/tests/test_chat_message_utils.py`

---

### 🔍 技术洞察  

| 维度 | 影响分析 |
|------|----------|
| **架构影响** | - **解耦**：将用户文本抽取抽象为独立工具函数，提升代码可复用性，减少处理器内部的硬编码。<br>- **模块边界**：`multimodal_utils` 现在多出一个子模块 `chat_message_utils`，对外通过 `__init__` 暴露，保持向后兼容。<br>- **示例同步**：示例工程也引入同名工具，保持一致性，但出现了两套实现（核心 vs 示例），未来可考虑抽取至共享库以避免重复。 |
| **性能影响** | - 额外的遍历 `messages`（一次线性扫描）和 `content`（同样线性），时间复杂度 **O(N)**（N 为消息与内容项总数），在 typical 多模态请求（几条消息、每条少量内容）中开销微乎其微。<br>- 产生的 `\n` 连接字符串对后续 token 化有轻微额外成本，整体可忽略。 |
| **安全考虑** | - 现在在无法找到任何用户文本时抛出明确的 `ValueError`，避免进入未定义状态，提升安全性与可调试性。<br>- 未引入外部依赖或执行不可信代码，安全风险基本为 **0**。 |
| **兼容性** | - 更改了预处理器对请求的解析方式，原来只取第一段 `text`，现在会合并多段。若上游模型对提示格式有严格假设（例如仅接受单行 prompt），可能导致行为差异，需要在文档或调用方明确。<br>- `field_serializer` 的加入改变了 `SamplingParams` 的 JSON 表现形式（使用 `msgspec` 编码后再 `json.loads`），但保持了原有字典结构，兼容性风险低。 |

---

### ⚠️ 潜在风险  

1. **Prompt 长度激增**  
   - 多段 `text` 合并后，生成的 `prompt` 可能超出模型的最大 token 限制，引发截断或错误。  
2. **行为差异**  
   - 以前仅使用第一段文字的业务（如依赖换行分割的提示模板）可能需要适配。  
3. **重复实现**  
   - 示例工程与核心实现各自维护 `extract_user_text`，若未来修改同步不及时，可能出现不一致的行为。  
4. **异常信息泄露**  
   - `ValueError` 中直接打印异常对象 `e`（在旧代码），新实现仅抛出统一错误信息，风险降低，但仍需确保不泄露请求内部结构。  

---

### 💡 关注建议  

1. **文档与使用指南**  
   - 在 API 文档中说明 **多文本合并** 的规则（换行连接），并提示调用方注意 **prompt 长度**。  
2. **长度校验**  
   - 在 `preprocessor_handler.generate` 前加入对 `prompt` token 长度的检查，超限时提前返回友好错误或截断。  
3. **统一工具实现**  
   - 将示例工程的 `extract_user_text` 替换为对核心库的直接 import，或抽取至共享的 `utils` 包，以避免代码分叉。  
4. **回归测试**  
   - 在 CI 中加入针对 **极端长文本**、**仅图片**、**空文字** 的测试，确保异常路径保持稳定。  
5. **监控与日志**  
   - 在生产环境记录 `user_text` 长度或截断情况，帮助运维评估潜在的性能或质量影响。  

---

---

#### 🟡 中重要度变更 (5)

### docs: Documentation audit and updates for 0.8 (#5380)
**SHA**: `0d597e7` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/0d597e7c556152e370fb06143611b9a7f92f3561)

**🎯 变更类型**：文档新增/重构  
**⚡ 重要程度**：🟡 中  
**📋 变更摘要**：本次 PR 为 Dynamo 0.8 版本进行一次大型文档审计与补全，新增 Fault Tolerance、Event Plane、Request Plane 等章节并在目录结构中加入对应入口；同时对后端部署指南（sglang、trtllm、vllm）及基础设施启动说明作了统一的措辞更新。  

**🎯 影响范围**  

| 模块 | 影响 | 备注 |
|------|------|------|
| `docs/_sections`、`docs/design_docs`、`docs/fault_tolerance` | 新增 6 + 12 + 10+ 个 rst/markdown 文件 | 为故障恢复、事件层、请求层提供完整概念与操作指引 |
| `docs/backends/*/README.md` | 文本修改，统一「启动基础设施」章节的表述 | 与部署脚本保持一致，避免误导 |
| `docs/hidden_toctree.rst`、`docs/index.rst` | 添加新章节的 TOC 条目 | 影响 Sphinx 生成的站点结构 |
| CI / 文档生成脚本（若存在） | 需要包含新文件 | 否则会出现 “file not found” 错误 |

**💡 关注建议**  

1. **目录与交叉引用**  
   - 确认 `docs/_sections/fault_tolerance.rst`、`docs/design_docs/event_plane.md`、`docs/design_docs/request_plane.md` 已在 `conf.py` 的 `exclude_patterns` 之外，否则会被意外排除。  
   - 检查所有内部链接（如 `../fault_tolerance/README.md`）在生成的 HTML 中是否解析成功，尤其是新加入的 `fault_tolerance`、`event_plane`、`request_plane` 章节。

2. **Sphinx 构建**  
   - 本次改动在 `hidden_toctree.rst` 增加了多条 `toctree` 项，建议在本地运行 `make html` 并打开生成的页面，验证侧边栏层级是否符合预期（例如 `Fault Tolerance` 与 `Frontends`、`Backends` 同级）。  
   - 若使用自动 TOC 生成（如 `sphinx.ext.autosummary`），确保新章节的 `.. toctree::` 标记已经加入对应的 `maxdepth`，避免出现空白节点。

3. **CI 文档检查**  
   - 若项目 CI 中有 “doc lint” 或 “spell‑check” 步骤，请同步更新文件列表，避免因为新文件未被检测导致 CI 失效。  
   - 增加对 `SPDX` 头部的统一检查脚本，以防后续文件遗漏。

4. **对外可视化**  
   - `docs/index.rst` 添加了 **Fault Tolerance**、**Request Plane**、**Event Plane** 的入口，建议在 README（GitHub 项目页）中适当提醒用户新文档已上线，以提升可发现性。  

5. **潜在回归**  
   - 文档中对 “Start Infrastructure Services (Local Development Only)” 的说明与部署脚本保持同步；若脚本参数或默认值变更，请同步更新相应文档段落，以免出现 **docker compose** 示例与实际行为不一致的情况。  

**总结**：此 PR 主要是文档层面的扩充与统一，代码路径未受影响。只要确保 Sphinx 构建通过、目录层级完整、交叉链接有效，且 CI 文档检查已覆盖新文件，就不会对运行时产生副作用。建议在合并前本地完整生成一次 HTML 并手动走查一次全部新章节，以防遗漏的标题层级或链接错误。

---

### fix: fix worker's push_handler non-blocking error upon stop word (#5157)
**SHA**: `31189ee` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/31189eeafa4faec265ffa89ec98ec03aecabc65f)

**🎯 变更类型**：Bug 修复  
**⚡ 重要程度**：🟡 中  

**📋 变更摘要**  
- 修正 `push_handler` 在向下游 publisher 发送响应时，因 **非阻塞发送失败** 而误报错误的情形。  
- 当 `Context` 已经被其它线程标记为停止 (`stop_generating`) 时，改为记录 **warn** 并避免再次调用 `stop_generating`，防止误触发错误计数。  

**🎯 影响范围**  
- `core::runtime::pipeline::network::ingress::push_handler.rs`  
- 关联的日志、错误计数指标（`error_counter`）以及 `Context` 停止逻辑  
- 可能波及到使用相同 `push_handler` 的所有模型推理流（如文本生成、图像生成等）  

**💡 关注建议**  
1. **日志级别**：新增 `warn` 分支后，请在部署环境验证是否会产生大量预期的警告，避免噪声掩盖真实错误。  
2. **指标准确性**：注释已说明错误计数会因“取消”而被膨胀，若业务对错误率有严格监控，考虑再引入单独的 `cancel_counter`。  
3. **并发测试**：加入针对 `context.stop_generating` 与 `publisher.send` 同时触发的 race‑condition 场景的单元/集成测试，确保两种顺序都能安全恢复。  
4. **向后兼容**：该改动仅改变日志和调用 `stop_generating` 的时机，不会影响已有 API，部署后可直接使用。  

总体而言，此次修复提升了在客户端提前关闭连接时的容错表现，避免误报错误并保持统一的错误统计。建议在 CI 中补充对应的并发异常测试以防止未来回归。

---

### fix: update hello_world example to remove etcd (#5422)
**SHA**: `332da40` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/332da40075d4ebe2c99c248204690211fe608f98)

**🎯 变更类型**：Bug 修复  
**⚡ 重要程度**：🟡 中  
**📋 变更摘要**：将 `hello_world` 示例的 README 从依赖外部 etcd 服务改为使用文件 KV 存储，更新启动指令并添加环境变量说明。  
**🎯 影响范围**：`examples/custom_backend/hello_world/README.md`（文档），涉及示例运行方式；对功能代码无直接影响。  

**💡 关注建议**  
1. **文档与实现保持一致**：确保示例代码 (`hello_world.py`、`client.py`) 确实在未显式提供 etcd 参数时默认使用 `DYN_STORE_KV=file`，否则可能出现运行时错误。  
2. **环境变量使用说明**：在示例目录的 `README` 或 `Cargo.toml` 中明确标出 `DYN_STORE_KV` 的可选值（`file`、`etcd`），并给出切换方式，以免用户误以为不需配置。  
3. **CI 测试覆盖**：加入 CI 步骤，自动执行 `DYN_STORE_KV=file python hello_world.py` 与 `client.py`，验证该配置下示例能成功启动并产生预期输出。  
4. **对比其他示例**：项目中仍有依赖 etcd 的示例，保持文档层面的统一说明（如“需自行启动 etcd”），避免新旧示例的使用体验冲突。  

总体而言，此次改动提升了 `hello_world` 示例的上手便捷性，仅涉及文档，风险低。请在发布前确认 README 与实际行为一致，并在 CI 中加入对应的验证。

---

### fix: build.sh to use release branch for version detection (#5425)
**SHA**: `90ed9ab` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/90ed9ab0e3b1afb8eea9b723084b53807653bc48)

**🎯 变更类型**：Bug修复  
**⚡ 重要程度**：🟡 中  

**📋 变更摘要**  
`container/build.sh` 现在在获取当前代码库的版本号时，优先查找 `release/X.Y.Z` 分支，而不是仅靠最近的 tag。若未找到发布分支，则回退到按版本排序的 git tag（过滤掉 `test-rc`），仍无结果时默认 `0.0.1`。同时添加了信息日志，强化了错误提示。  

**🎯 影响范围**  
- **构建脚本**：所有依赖 `container/build.sh` 的 CI/CD 流程、Docker 镜像构建以及本地 `make build` 等都会受到新版版本解析逻辑的影响。  
- **版本标记**：使用 `release/*` 分支的项目在未打 tag 的情况下也能得到正确的版本号，防止出现 “unknown version”。  

**💡 关注建议**  
1. **分支命名规范**：确保发布分支严格采用 `release/X.Y.Z` 形式，否则脚本会误判并回退到 tag。  
2. **CI 环境**：CI 运行时应保证 `git fetch --all --tags` 已拉取远程 release 分支，否则可能只能得到旧的 tag。  
3. **兼容性测试**：在没有 release 分支且无合法 tag 的环境下，确认默认 `0.0.1` 不会破坏版本依赖或镜像标签策略。  
4. **日志监控**：脚本已加入 `INFO` 输出，建议在 CI 日志中关注 “Using version from latest release branch” 信息，以验证分支解析是否生效。  

通过上述检查，可避免因版本解析失误导致的镜像冲突或发布混乱。

---

### chore(router): Remove deprecated best_worker_id and metrics_labels (#5412)
**SHA**: `c5458b9` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/c5458b99541360be9d0be151cea69e06ec777050)

**🎯 变更类型**：功能增强、重构  
**⚡ 重要程度**：🟡 中  

**📋 变更摘要**  
1. 删除 `KvPushRouter.best_worker_id`，统一改用 `best_worker()`（返回 (worker_id, dp_rank, overlap_blocks)）。  
2. 移除 `WorkerMetricsPublisher.create_endpoint` 中的 `metrics_labels` 参数，所有调用改为只传 `component`。  
3. 相应的 Python 绑定、类型提示 (`_core.pyi`)、文档以及示例代码全部同步更新，并在 Rust 侧加入 deprecation 警告。

**🎯 影响范围**  
- `components/src/dynamo/router/__main__.py`、各后端 publisher (`sglang`, `trtllm`, `vllm`、示例）  
- Rust 绑定 (`lib/bindings/python/rust/llm/kv.rs`) 与 Pyi 文件  
- 文档 `docs/router/kv_cache_routing.md`  
- 任何直接调用 `best_worker_id` 或 `create_endpoint(..., metrics_labels=…)` 的用户代码。

**💡 关注建议**  
1. **代码迁移**：确保所有 Python 调用改为 `await router.best_worker(...)` 并解构为 `worker_id, _, overlap`（若不需要 `dp_rank` 可用 `_` 占位）。  
2. **Metrics 初始化**：删除 `metrics_labels` 参数后，检查自定义监控或统计逻辑是否仍需要额外标签；如有，可在 `WorkerMetricsPublisher` 内部自行添加。  
3. **兼容性**：库已不再提供 `best_worker_id` 的后备实现，旧版本脚本将直接抛 `AttributeError`。建议在升级指南中明确搬迁步骤，或在项目内部保留短期的兼容包装层。  
4. **文档/示例**：确认所有 README、示例和 CI 测试已同步到新 API，防止因文档不一致导致用户困惑。  
5. **测试**：新增对 `best_worker` 返回三元组的单元测试，验证 `dp_rank` 正确填充；同时检查 `WorkerMetricsPublisher.create_endpoint` 在不传 `metrics_labels` 时仍能成功注册。  

整体而言，删除已废弃的接口可简化代码路径，但升级用户需要一次性完成 API 替换，务必在发布说明中强调迁移操作。

---

#### 🟢 低重要度变更 (1)

### docs: Add pip install section to kvbm readme (#5423)
**SHA**: `553acb4` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/553acb4848f5a6ee694615f79b4870b5fc41f490)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在 `kvbm` README 中新增 Pip 安装示例，添加支持矩阵链接，并将章节标题调整为 “Installation”。其它文字未改动。

---

