# 每日更新报告（2026-02-12）

## ai-dynamo/dynamo

| 提交时间 | 作者 | 提交信息 |
|----------|------|----------|
| 2026-02-12 15:17:51 | Yan Ru Pei | chore: warn out request rejection (#6222) |
| 2026-02-12 14:26:56 | Yan Ru Pei | feat: Flash Indexer (#5785) |
| 2026-02-12 13:14:13 | jh-nv | feat: Migrate vllm configuration system (#6075) |
| 2026-02-12 12:10:58 | jh-nv | feat: request migration for SGLang (#5659) |
| 2026-02-12 11:51:49 | dagil-nvidia | docs: add Discovery Plane, refactor Event Plane with D2 diagrams (#6229) |
| 2026-02-12 09:23:00 | dagil-nvidia | docs: update docs URLs from Sphinx index.html to Fern paths (#6218) |
| 2026-02-12 09:19:49 | dagil-nvidia | ci: fix fern CLI after docs/ migration by adding fern/ symlink (#6219) |
| 2026-02-12 09:18:28 | MatejKosec | feat: responses API compliance with upstream type alignment (#6089) |
| 2026-02-12 08:31:21 | Alec | test: change KVBM vLLM interface tests to gpu_0 marker (#6205) |
| 2026-02-12 08:22:27 | Jonathan Tong | docs: migrate Fern docs from fern/ into docs/ (#6206) |
| 2026-02-12 08:09:00 | Schwinn Saereesitthipitak | feat(chrek): config refactor, /dev/shm support, and mount-policy rewrite (#5946) |
| 2026-02-12 07:40:20 | dagil-nvidia | fix: restrict Image.open() formats to prevent PSD parsing (workaround) (#6212) |
| 2026-02-12 05:19:31 | Alec | chore(deps): bump vLLM to 0.15.1 (#6102) |
| 2026-02-12 05:15:03 | MatejKosec | fix: use tempfile.TemporaryDirectory in load generator test (#6196) |
| 2026-02-12 05:00:58 | Dmitry Tokarev | fix: Cleanup pytest markers, enable gpu_0 tests on trtllm arm, reduce log noise (#6124) |
| 2026-02-12 04:23:48 | Yan Ru Pei | chore: remove kv indexers bindings (#6159) |
| 2026-02-12 04:06:13 | Graham King | feat: Metric for detokenization latency (#6160) |
| 2026-02-12 03:51:21 | Hongkuan Zhou | docs: pointers to global router (#6190) |
| 2026-02-12 03:19:55 | Julien Mancuso | feat: include operator version in DGD (#6121) |
| 2026-02-12 03:06:12 | Yuewei Na | fix: convert guided_decoding dict to GuidedDecodingParams in TRT-LLM handler (#6127) |
| 2026-02-12 02:42:05 | Olga Andreeva | test: adding interface contract tests for KVBM vLLM integration (#5847) |
| 2026-02-12 02:21:19 | Ran Rubin | ci: modify container build routing (#6185) |
| 2026-02-12 02:09:27 | Dillon Cullinan | chore: Templating Feedback Followup (#6125) |
| 2026-02-12 01:43:09 | Ryan Amirthan Stephen | fix: added standard assets from NVIDIA fern styling (#6148) |
| 2026-02-12 00:51:01 | Graham King | chore: Merge bindings client and client2 functions (#6158) |

### 📊 统计摘要
> 本日共 25 个提交 | 🔴高 11 | 🟡中 6 | 🟢低 8
## 📋 目录

- [ai-dynamo/dynamo](#ai-dynamo-dynamo)
  - [📊 统计摘要](#-统计摘要)
  - [🔴 高重要度变更 (11)](#-🔴-高重要度变更-11)
    - [feat: Flash Indexer (#5785)](#937398c)
    - [feat: Migrate vllm configuration system (#6075)](#de27efe)
    - [feat: request migration for SGLang (#5659)](#b94f9dc)
    - [feat: responses API compliance with upstream type alignme...](#8cb47d0)
    - [feat(chrek): config refactor, /dev/shm support, and mount...](#d381e6f)
    - [fix: restrict Image.open() formats to prevent PSD parsing...](#b6824ae)
    - [fix: Cleanup pytest markers, enable gpu_0 tests on trtllm...](#4220771)
    - [feat: Metric for detokenization latency (#6160)](#adaf1a3)
    - [feat: include operator version in DGD (#6121)](#4f68626)
    - [fix: convert guided_decoding dict to GuidedDecodingParams...](#5602dd2)
    - [fix: added standard assets from NVIDIA fern styling (#6148)](#33ddd8f)
  - [🟡 中重要度变更 (6)](#-🟡-中重要度变更-6)
    - [docs: add Discovery Plane, refactor Event Plane with D2 d...](#2ec1c3f)
    - [ci: fix fern CLI after docs/ migration by adding fern/ sy...](#21abf07)
    - [docs: migrate Fern docs from fern/ into docs/ (#6206)](#39d645e)
    - [fix: use tempfile.TemporaryDirectory in load generator te...](#45bc1b7)
    - [chore: remove kv indexers bindings (#6159)](#6a728d1)
    - [test: adding interface contract tests for KVBM vLLM integ...](#f9d20c1)
  - [🟢 低重要度变更 (8)](#-🟢-低重要度变更-8)
    - [chore: warn out request rejection (#6222)](#7b16480)
    - [docs: update docs URLs from Sphinx index.html to Fern pat...](#3075028)
    - [test: change KVBM vLLM interface tests to gpu_0 marker (#...](#f8d0a9f)
    - [chore(deps): bump vLLM to 0.15.1 (#6102)](#2c6e6d2)
    - [docs: pointers to global router (#6190)](#1488ef2)
    - [ci: modify container build routing (#6185)](#a61ac68)
    - [chore: Templating Feedback Followup (#6125)](#3188c70)
    - [chore: Merge bindings client and client2 functions (#6158)](#73dc3be)
#### 🔴 高重要度变更 (11)

### feat: Flash Indexer (#5785)
**SHA**: `937398c` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/937398cf61d5cc329e80cb5c7b70e574c02c2251)

**🎯 变更类型**：功能增强 / 架构变更  
**⚡ 重要程度**：🔴高  

**📋 变更摘要**  
- 为 KV Router 增加 **多线程事件处理** 功能，新增 `--router-event-threads` 参数（环境变量 `DYN_ROUTER_EVENT_THREADS`），可在运行时决定使用单线程 RadixTree 还是 **并发 RadixTree**（`ConcurrentRadixTree`）或 **位置哈希表**（`PositionalIndexer`）实现。  
- 引入 `ConcurrentRadixTree`（基于 `Arc<RwLock>`、`DashMap`）以及 `PositionalIndexer`（位置‑first 的嵌套哈希表 + jump‑search 优化），并把它们统一封装到 `Indexer` 枚举中。  
- 迁移 KV Router 主体、Subscriber、WorkerQuery、Snapshot、Publisher 等所有路径，使其通过统一的 `Indexer` 接口与具体实现交互。  
- 新增大量 **基准/压力测试**（micro‑bench、stress‑bench、mooncake‑bench）以及文档说明，删除旧的 `FlatHashMap` 基线实现。  
- 增加配置校验、防止自引用 KV 事件、并对依赖（`dashmap`、`parking_lot`、`flume` 等）做了 Cargo 更新。  
- Python 测试层同步扩展，加入 `router_event_threads` 参数，验证单/多线程后端在 E2E 场景中的正确性。

---

## 🔍 技术洞察

### 1. 架构影响
| 维度 | 旧实现 | 新实现 | 影响 |
|------|--------|--------|------|
| **索引器结构** | 单线程 `RadixTree`（`Rc<RefCell>`） + 可选 TTL/Prune | - `RadixTree`（保持兼容）<br>- `ConcurrentRadixTree`（锁粒度为节点级）<br>- `PositionalIndexer`（位置‑first 哈希表） | ① 通过 `Indexer` 枚举统一调用入口，业务层不再感知底层实现；<br>② 支持 **并行 `find_matches`**，提升查询吞吐；<br>③ 通过 `ThreadPoolIndexer` 实现 **事件路由的 sticky 工作线程**，避免同一 worker 的事件乱序。 |
| **事件处理模型** | 单线程 Tokio 运行时 + channel | **线程池 + OS 线程**（`ThreadPoolIndexer`）<br>每个 worker 绑定一个固定的事件处理线程（sticky routing） | ① 事件写入不再受单线程 Tokio runtime 限制，可随 `router_event_threads` 扩展；<br>② 仍保持对同一 `worker_id` 事件的顺序性（关键点），避免并发写冲突。 |
| **TTL / Prune** | 在单线程 `RadixTree` 中基于 `RwLock`+`VecDeque` 实现 | **仅在单线程模式** 支持；并发树和位置哈希表显式禁用 | ① 文档和配置校验已限制 `router_event_threads > 1` 时不可开启 `--no-kv-events`（TTL/Prune）<br>② 防止用户误以为多线程模式保留 TTL。 |
| **持久化 / Dump** | `dump_tree_as_events`（递归遍历） | `ConcurrentRadixTree` 实现 BFS 版 dump；`PositionalIndexer` 通过每个 worker 的 reverse‑lookup 合成事件 | ① 保持迁移/快照功能不受实现影响；<br>② `PositionalIndexer` 的 dump 过程更轻量（直接遍历 worker → block 列表）。 |
| **配置 & 验证** | 只校验数值范围 | 新增 **自定义校验**：<br>· `durable_kv_events` 必须配合 `use_kv_events`<br>· `router_event_threads > 1` 只能在 `use_kv_events=true` 时打开<br>· `router_track_output_blocks` 依赖 `router_track_active_blocks` | ① 防止非法配置导致运行时异常或功能缺失；<br>② 通过 `validator` 在启动阶段即报错，提升可维护性。 |

### 2. 性能影响
| 场景 | 旧实现 (单线程 RadixTree) | 新实现 (并发 RadixTree) | 新实现 (PositionalIndexer) | 备注 |
|------|---------------------------|--------------------------|----------------------------|------|
| **`find_matches`**（热点） | O(depth × workers) – 每层遍历指针，锁竞争只能单线程 | 读取 `RwLock` → 多线程并发，无锁读（只读锁），同层 `DashMap` 分片降低争用 | O(depth / jump + J × workers) – 通过 **jump‑search** 大幅减少遍历次数 | 通过基准（`kv_indexer_bench`）显示：PositionalIndexer 在 HIT 场景下 5×‑10× 优于 RadixTree；并发 RadixTree 在高并发读时可保持接近单线程的查询延迟，且吞吐提升约 2‑3×（取决于线程数）。 |
| **`apply_event` (store / remove)** | 单线程，顺序写入 |

---

### feat: Migrate vllm configuration system (#6075)
**SHA**: `de27efe` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/de27efe6e6972f6c21539e257f9109c8fa0dc065)

**🎯 变更类型**：功能增强 / 重构  
**⚡ 重要程度**：🔴 高  

**📋 变更摘要**  
- 将 vLLM 相关的参数迁移到统一的 **configuration 系统**，新增 `DynamoRuntimeArgGroup` / `DynamoRuntimeConfig` 与 `DynamoVllmArgGroup` / `DynamoVllmConfig` 两套 ArgGroup 实现。  
- 通过 `add_argument`、`add_negatable_bool_argument` 统一处理环境变量、默认值、废弃 flag，完善列表型 env（如 `DYN_CONNECTOR`）的解析。  
- 精简 `args.py`：原来的手写 parser 被 `ArgGroup` 替代，解析流程分为 **runtime → vLLM‑wrapper → vLLM engine** 三层，新增交叉校验、默认值注入、GIL‑contention 规避等逻辑。  
- 与 KV 事件、KV 迁移相关的默认配置迁入 `backend_args.py`，并在 `parse_args` 里统一完成 **engine ↔ dynamo** 双向同步。  

**🎯 影响范围**  
- `components/src/dynamo/common/configuration/*`（新增 ArgGroup 与 ConfigBase 实现）  
- `components/src/dynamo/vllm/args.py`（核心 CLI 参数结构）  
- `components/src/dynamo/vllm/backend_args.py`（vLLM 包装层配置）  
- `components/src/dynamo/vllm/utils.py`（env‑list 解析）  
- `components/src/dynamo/vllm/main.py`（启动入口）  
- 依赖 `dynamo._core`、`vllm` 的所有后端插件与测试用例  

---

## 🔍 技术洞察

| 维度 | 影响分析 |
|------|----------|
| **架构影响** | 1. **配置中心化**：原本散落在 `args.py` 的大量 flag 被抽象为 **ArgGroup**，显式划分 “runtime” 与 “vLLM‑wrapper”。<br>2. **层级解耦**：`parse_args` 只负责把 CLI → `Config`，随后 `cross_validate_config` / `update_*_config_*` 完成 **Dynamo ↔ vLLM** 双向同步，后端（vLLM）不再直接依赖 Dynamo 的内部字段。<br>3. **可扩展性提升**：新增后端只需实现自己的 `ArgGroup` 并在 `parse_args` 中注册，框架层面无需再次改动。<br>4. **向后兼容层**：`add_argument` 仍保留 `obsolete_flag` 参数，老 flag 会被解析且在 help 中标记 “deprecating”。 |
| **性能影响** | 1. **GIL 规避**：在 `update_engine_config_with_dynamo` 中自动把 `distributed_executor_backend` 设为 `mp`（当使用 nixl 且 TP=1 时），可避免 vLLM 0.13 版本的 **UniProcExecutor** 产生的热点循环，显著提升多线程情况下的吞吐。<br>2. **默认 block_size** 仍保持 16，未改动对性能的直接影响。<br>3. **KV 事件默认开启**（除 decode worker 外）会在运行时创建额外的 ZeroMQ socket，若未使用 NATS‑JetStream 可能产生额外网络开销；但通过 `--durable-kv-events` 可自行关闭。 |
| **安全考虑** | - 新增 **list‑type env 解析**（`env_or_default`）直接把空格分隔的字符串转为 list，若环境变量来源不受信任，可能导致 **注入**（如 `DYN_CONNECTOR="nixl; rm -rf /"`）在后续代码中被当作普通字符串使用，风险较低但建议在 `add_argument` 里加入白名单校验。<br>- `kv_events_config` 中的 `endpoint` 采用 `tcp://*:{port‑dp_rank}`，若端口暴露在公网，攻击者可尝试发送伪造的 KV 事件。建议在部署时使用防火墙或绑定到内部网络。 |
| **可维护性** | - 使用 **dataclass‑like** `ConfigBase` + 明确的 `validate()` 方法，使字段校验集中，易于单元测试。<br>- 参数帮助文字现在统一通过 `_build_help_message` 生成，包含 env var、默认值、废弃 flag 信息，文档同步成本降低。<br>- 代码量从原来的 461 行降至 217 行（`args.py`），逻辑更清晰。 |
| **兼容性** | - 老 flag（如 `--dyn-endpoint-types`）仍被接受并显示 “deprecating”，但实际变量名已改为 `endpoint_types`（对应 `DynamoRuntimeConfig.endpoint_types`）。<br>- 旧的 `--connector` 默认值仍保留，且 env 变量 `DYN_CONNECTOR` 现在支持 **空格分隔** 列表。<br>- 仍保留 `dump_config_to`、`use_vllm_tokenizer` 等老字段，仅迁移到新的 Config 类中。 |

---

## ⚠️ 潜在风险

1. **破坏旧脚本**：若用户直接读取 `args.Config` 的属性（如 `config.connector_list`），属性名已经改为 `connector`，可能出现 `AttributeError`。  
2. **废弃 flag 仍可用导致混淆**：`obsolete_flag` 目前仅在帮助信息中标记，未强制报错，可能导致用户无意中继续使用旧 flag，产生隐藏的配置分歧。  
3. **环境变量列表解析**：空格分隔的列表在 `sh` 中需要引用或转义，文档若未同步，用户可能得到单元素列表或解析错误。  
4. **Side‑channel host 自动启用**：`ensure_side_channel_host()` 在 `update_engine_config_with_dynamo` 中被调用，但该函数实现仍在 `vllm.utils`，如果在未来 vLLM 版本中删除或变更，启动会失败。  
5. **KV 事件端口算术**：`port - dp_rank` 的实现依赖 vLLM 会自行对 `dp_rank` 做递增。如果 vLLM 行为改变，端口可能冲突或被占用。  
6. **相互排斥校验逻辑**：`DynamoVllmConfig.validate()` 会在解析阶段抛异常；如果某些子系统（如 CI）只跑 `parse_args` 而不捕获异常，进程会直接退出，导致 CI 失败。  

---

## 💡 关注建议

1. **文档同步 & 示例**  
   - 在 README / docs 中明确列出 **新 flag ↔ 旧 flag** 对照表，说明 `--endpoint-types` 替代 `--dyn-endpoint-types`。  
   - 给出 `DYN_CONNECTOR` 环境变量的 **引用方式**（`export DYN_CONNECTOR="nixl lmcache"`）示例。  

2. **向后兼容层**  
   - 在 `add_argument` 中加入 `action='store_true'` 的 **deprecation warning**（如使用 `warnings.warn`），帮助用户尽早迁移。  
   - 为历史字段（如 `connector_list`）提供 **property 兼容**：`@property def connector_list(self): return self.connector`。  

3. **安全

---

### feat: request migration for SGLang (#5659)
**SHA**: `b94f9dc` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/b94f9dcd9ccbd7cf74547e739314cd96f659cc82)

**🎯 变更类型**：功能增强 / 架构变更 / 安全修复  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：  
本次提交为 SGLang 与 vLLM 两大后端引入统一的 *finish reason* 正常化工具 `engine_response.normalize_finish_reason`，并在全部请求处理器中使用。与此同时，实现了跨进程、跨组件的 **优雅关机机制**：通过 `install_graceful_shutdown` 捕获并链式处理 `SIGTERM/SIGINT`，提供统一的 `shutdown_event` 与 `RUN_DEFERRED_HANDLERS`，各 handler 通过 `shutdown_event` 参与取消与资源清理，保证在收到终止信号时能安全退出并执行所有已注册的 Loop‑signal 回调。

---

### 🎯 影响范围
- **核心组件**：`components/src/dynamo/sglang/*`（所有 SGLang 请求处理器、`main.py`）  
- **vLLM 适配层**：`components/src/dynamo/vllm/handlers.py`  
- **公共工具**：`components/src/dynamo/common/utils/engine_response.py`（新增）以及 `__init__.py` 导出  
- **运行时创建**：`create_runtime` 调用签名改为返回 `(runtime, loop)`（已在 `sglang/main.py` 适配）  
- **信号/关闭逻辑**：全局 `RUN_DEFERRED_HANDLERS` 与 `shutdown_event` 被所有 worker handler 共享。

---

### 🔍 技术洞察

| 维度 | 影响说明 |
|------|----------|
| **架构影响** | - 引入 **统一信号处理层**：`install_graceful_shutdown` 将 OS 信号与 `asyncio` 循环解耦，统一在 `main.py` 中创建 `shutdown_event`，并在所有 handler 基类 (`BaseWorkerHandler`) 中注入。<br>- **依赖注入**：所有业务 handler 现在接受 `shutdown_event`，实现了对上层信号的感知，提升了组件间的耦合度（正面）和对外兼容性（潜在负面，需要保证老调用方仍能传入 `None`）。<br>- **统一 finish‑reason 正常化**：将 SGLang、vLLM 等后端特有的 `abort` → `cancelled` 转换抽象到公共模块，减少重复实现，后续可直接在 Rust 层实现。 |
| **性能影响** | - **额外的 async 任务**：在每个请求的取消监控中会额外创建 `shutdown_event.wait()` 任务。该任务仅在信号触发时参与 `asyncio.wait`，平时为 `pending` 状态，几乎无 CPU/内存开销。<br>- **信号拦截开销**：拦截 `loop.add_signal_handler` 并转为内部列表，导致一次信号注册的调用路径略增，但注册次数极少，影响可忽略。 |
| **安全考虑** | - **安全的关闭**：在收到 SIGTERM/SIGINT 时，强制调用 `runtime.shutdown()`，防止资源泄漏、文件句柄残留或未完成的 KV 事务。<br>- **异常捕获**：在 `run_deferred_handlers` 中捕获并记录所有异常，避免未处理的异常导致进程异常退出。<br>- **潜在风险**：如果业务代码在 `shutdown_event.wait()` 前自行阻塞或捕获信号，可能导致“信号丢失”。但通过 OS‑level 捕获与链式回调，已最大化兼容性。 |
| **可维护性** | - **代码统一**：`normalize_finish_reason` 统一位置，后续所有后端只需调用一次，降低维护成本。<br>- **Handler 基类扩展**：新增 `shutdown_event` 成员，所有子类需相应改造，增加了改动量但提升了统一性。<br>- **文档/注释**：新增大量注释解释退出流程，帮助后续开发者快速理解。 |

---

### ⚠️ 潜在风险

1. **运行时创建签名变更**  
   `create_runtime` 现在返回 `(runtime, loop)`，若项目其他入口（非 SGLang）仍按旧签名解包，可能出现 `ValueError: not enough values to unpack`。需检查所有调用点或在 `create_runtime` 中保持向后兼容的双返回值（如返回 `(runtime, loop)` 并在旧代码只取第一个）。  

2. **信号处理冲突**  
   - 若外部库（如 `uvicorn`、`fastapi`）已在同一进程注册了 `SIGTERM`/`SIGINT`，本实现会覆盖原有处理器并保存至 `old_os_handlers`，但未在关闭时主动恢复，可能导致后续再次启动时行为异常。  
   - `loop.add_signal_handler` 被劫持后，所有后续注册的回调都会被延迟执行。若有代码期望即时执行（例如用于清理临时资源），可能出现资源泄漏。  

3. **异步取消 vs Shutdown 竞争**  
   在 `_handle_cancellation` 中使用 `asyncio.wait(FIRST_COMPLETED)`，若取消信号与 shutdown 同时触发，`GeneratorExit` 被抛出后上层可能未捕获，导致未执行后续清理逻辑。建议在所有 `async for`/`await` 循环外层统一捕获 `GeneratorExit` 并执行统一清理。  

4. **错误传播**  
   `run_deferred_handlers` 中的异常仅被记录，若关键的 deferred handler（如数据库持久化）失败，进程仍会退出，可能导致数据不一致。可以考虑在关键路径返回错误码或阻止进程退出。  

5. **类型注解兼容性**  
   使用了 `Callable[[], Awaitable[None]] | None`（PEP 604）以及 `list[tuple[SignalCallback, tuple[Any, ...]]]` 等语法，最低要求 Python 3.10。若部署环境仍在 3.9，会报语法错误，需要确认 CI/生产环境的解释器版本。  

---

### 💡 关注建议

1. **兼容性检查**  
   - 为 `create_runtime` 添加包装函数或向后兼容的返回结构，防止旧入口破坏。<br>- 在 CI 中添加对 `python -V` 的检查，确保使用 3.10+，或回退到 `typing.Union` 语法。  

2. **信号恢复**  
   - 在 `install_graceful_shutdown` 返回前或进程退出前，恢复 `old_os_handlers`（`signal.signal(sig, old_os_handlers[sig])`），避免对后续模块产生副作用。  

3. **关键 deferred handler 错误处理**  
   - 对 `run_deferred_handlers` 引入错误计数或返回值，主流程根据返回决定是否以非零退出码结束。  

4. **文档与示例**  
   - 在项目文档中加入“Graceful Shutdown”章节，说明如何在自定义组件中使用 `shutdown_event` 与 `RUN_DEFERRED_HANDLERS`。  
   - 提供示例代码演示在非 SGLang 入口（如独立 vLLM 服务）如何调用 `install_graceful_shutdown`。  

5. **统一异常处理**  
   - 在 `BaseWorkerHandler` 及其子类的 `async_init` / `cleanup` 中捕获 `GeneratorExit` 并执行统一的资源释放逻辑，确保即使在 shutdown 期间也能安全释放 GPU、网络连接等稀有资源。  

6. **回归测试**  
   - 新增 **信号触发测试**：向进程发送 `SIGTERM`，验证 `runtime.shutdown

---

### feat: responses API compliance with upstream type alignment (#6089)
**SHA**: `8cb47d0` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/8cb47d04d2d599bd963b0cb277a0f81dea957de8)

**🎯 变更类型**：功能增强 / 架构重构 / 兼容性迁移  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：  
- 完成 **Responses API** 与上游（OpenAI）类型的对齐，拆分、重构 `async‑openai` 中的响应模型，实现独立的 **impls、api、conversation、stream** 模块。  
- 为 **MCP（Model‑Context‑Protocol）** 增加专属类型、简化 `From`/`Into` 实现以及灵活的集合构造器。  
- 在 `llm` 服务层加入 **流式 SSE** 支持：将内部 Chat Completion 流转换为符合 OpenResponses 规范的事件序列，并在客户端断连时安全取消。  
- 默认行为更新：`max_output_tokens` 采用统一上限（4096），`model` 由必填改为 `Option<String>`，并在缺省时使用模板默认值。  
- 新增示例脚本、测试用例以及对 `tests/utils` 的请求/日志改造，删除旧的 `responses.rs` 实现。  

---  

### 🔍 技术洞察  

#### 1. 架构影响  
| 影响点 | 说明 |
|--------|------|
| **模块化重构** | `async‑openai::types::responses` 被拆分为 `api.rs、conversation.rs、impls.rs、stream.rs`，并在 `mod.rs` 中统一导出，降低单文件体积、提升可维护性。 |
| **类型迁移** | 原有 `Input、PromptConfig、TextConfig` 等直接搬到 `responses` 子模块，外部依赖仍通过 `type alias`（`pub type Input = InputParam;`）保持兼容，未来可逐步清理。 |
| **MCP 新增** | 引入 `mcp` 子模块与 `impls.rs` 中的大量 `From` 实现，使得工具调用、授权请求等在上层代码中以简洁的集合或单值形式构造，提升 DSL 可读性。 |
| **流转换层** | `ResponseStreamConverter` 负责把 **Chat Completion** 的 SSE 块映射为 **Responses API** 的完整事件序列，形成 **状态机**（created → in_progress → … → completed / failed）。该层在 `llm/src/protocols/openai/responses/mod.rs` 中被调用。 |
| **服务层改动** | `handler_responses` 现在在接收请求后直接走 **streaming** 与 **非‑streaming** 双路径，统一使用 `ResponseParams` 捕获并回写请求参数，避免在后续 `chat_completion_to_response` 中遗漏字段。 |
| **监控/度量** | `create_inflight_guard` 对 `streaming` 参数作了区分（原先统一 `false`），对外观测 **并发请求** 更精确。 |  

#### 2. 性能影响  
- **流式路径**：在 SSE 转换时使用 `std::sync::Mutex`（非 async）保护 `ResponseStreamConverter`，因为每个 `inspect` 调用在单线程内完成，避免 `await` 时持锁导致死锁。锁竞争极低（仅在单个连接上），但在极高并发情形下仍会导致短暂阻塞。  
- **内存占用**：`ResponseStreamConverter` 会在整个响应期间累计 **完整文本** (`accumulated_text`) 以及每个函数调用的参数字符串，以便在 `done` 事件中一次性返回。对大模型输出（上 MB）可能产生显著内存峰值。  
- **CPU 开销**：每个 chat‑completion chunk 需要一次 `serde_json::to_string`、一次 `make_sse_event`，以及若包含工具调用还要进行 `parse_tool_call_text`（正则式字符串扫描），总体开销线性于 token 数，预计 < 1% 额外 CPU。  
- **默认 `max_output_tokens`**：提升至 4096，防止因默认 0 而导致截断，提升成功率，但对算力受限的后端可能导致更高的推理时间。  

#### 3. 安全考虑  
| 风险 | 解释 | 缓解措施 |
|------|------|----------|
| **输入的 `<tool_call>` 解析** | 使用 `serde_json::from_str` 解析模型输出中嵌入的 JSON，若模型生成非法 JSON 会返回错误并直接丢弃该块，可能导致遗漏工具调用。 | 已经捕获 `Result` 并在 `parse_tool_call_text` 中安全返回空向量；但仍建议在上层对生成的 JSON 进行 schema 验证。 |
| **SSE 长连接** | 客户端可在任意时刻断开，若未正确捕获，后端仍会继续生成并消耗算力。 | `monitor_for_disconnects` 通过 `ConnectionHandle` 监听 `ctx`（`AbortHandle`），在断连后调用 `cancel()`，确保算力被回收。 |
| **模型返回的 `null` 字段** | 通过 `ResponseParams` 将 `None` 替换为 OpenAI 规范默认值，避免后端在 JSON 序列化时产生 `null` 导致验证失败。 | 已在 `chat_completion_to_response` 中统一填充默认值。 |
| **日志泄露** | `send_request` 在非流式路径会记录完整响应体；对流式路径已改为 “<streaming, not logged>”。 | 此举防止在大流量 SSE 场景下日志膨胀或泄露敏感 token。 |
| **并发度量失准** | `inflight_guard` 对 streaming 与非 streaming 使用相同计数器，导致监控偏差。 | 已在 `responses` 中传入 `streaming` 标志，使度量区分两类请求。 |

#### 4. 可维护性 & 代码质量  
- **大量 `From`/`Into` 实现**：在 `impls.rs` 中集中提供，极大缩短调用方构造代码（如 `InputParam::from(vec!["a","b"])`），同时保持 **单向** 转换语义，降低 future refactor 风险。  
- **向后兼容别名**：`pub type Input = InputParam;` 等别名保证旧代码仍可编译，且在下一大版本可以逐步移除。  
- **测试覆盖**：新增 `responses_payload_*`、`responses_stream_payload_*`，并在 `tests/serve` 中加入对应端点的请求，确保兼容性。  
- **文档/示例**：`examples/backends/sglang/launch/agg_vision.sh` 提供了完整的启动脚本，降低用户上手门槛。  

### ⚠️ 潜在风险  
1. **迁移破坏** – 虽有别名，但部分代码（如 `NvCreateResponse` 的 `model: String`）已改为 `Option<String>`，若未在迁移路径中填充默认值，可能导致空模型名传入 Engine，触发运行时错误。  
2. **内存峰值** – 大批量流式输出（尤其带有长文本或多工具调用）会在 `ResponseStreamConverter` 中累计整段内容；在资源受

---

### feat(chrek): config refactor, /dev/shm support, and mount-policy rewrite (#5946)
**SHA**: `d381e6f` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/d381e6ff53829f94c097509ac4659597b81aa215)

**🎯 变更类型**：功能增强 / 重构  

**⚡ 重要程度**：🔴 高  

**📋 变更摘要**  
- 对 **checkpoint/restore** 流程进行彻底重构：引入统一的 **CheckpointManifest**（YAML），取消旧的 `metadata.json`、`descriptors.json`。  
- 新增 `/dev/shm` 持久化、**link‑remap** stub 生成、以及基于 **mount‑policy** 的外部挂载决策，提升跨节点恢复的可靠性。  
- 将 checkpoint 配置迁入 **ConfigMap**（`config.yaml`），并在 DaemonSet、Operator、Helm Chart 中以环境变量+ConfigMap 方式统一注入。  
- 为 **chrek** DaemonSet 增加 **HTTP API**（/health、/checkpoint、/checkpoints），支持 **watcher** 与 **HTTP** 两种触发模式。  
- 精简并统一了 `common`、`checkpoint`、`restore` 包的实现，去除冗余旧代码；引入 `checkpoint/spec.go`、`constants.go`、`storage.go` 等模块。  
- 更新 Operator、CRD、Helm Chart、文档，使 **DynamoGraphDeployment**（DGD） 与 **standalone** 用例均使用新机制。  
- 通过 **CRIU config file**（`criu.conf`）支持 CUDA 插件、`CRIU_TIMEOUT`、`allow_uprobes`、`skip_in_flight` 等选项。  
- 添加大量调试/诊断日志（GPU、namespace、cgroup、mountinfo），并在 restore 前后记录边界信息。  

---

## 🎯 影响范围

| 组件 | 受影响的模块 / 文件 | 直接影响 |
|------|---------------------|----------|
| **vLLM（Python）** | `components/src/dynamo/vllm/args.py`、`main.py` | 删除 `sleep_mode_level` 参数；改为统一使用 `CHECKPOINT_SLEEP_MODE_LEVEL=1`；checkpoint 检测/恢复逻辑迁移至 Go 端。 |
| **chrek（Go）** | `pkg/checkpoint/*`、`pkg/restore/*`、`pkg/http_api_server/*`、`pkg/common/*`、Dockerfile、Init‑script、Seccomp profile | 重新实现 checkpoint/restore 核心流程；新增 Manifest、外部挂载、/dev/shm、link‑remap；提供 HTTP API；安全策略（seccomp）统一。 |
| **Operator（Go）** | `internal/checkpoint/dgd_integration.go`、`controller_common/*`、`consts/consts.go`、`cmd/main.go` | 替换旧的环境变量/卷注入方式，使用 `ConfigMap` 中的 `CheckpointSpec`；新增 `ReadyForCheckpointFilePath`、`RestoreMarkerFilePath`；统一 PVC 名称/路径校验。 |
| **Helm Charts** | `charts/chrek/*`、`charts/platform/*`、`values.yaml` | 新增 ConfigMap、环境变量、参数映射；删除旧的 `smart‑entrypoint`、`signalHostPath` 配置；改用 `DYN_READY_FOR_CHECKPOINT_FILE`、`DYN_RESTORE_MARKER_FILE`。 |
| **文档** | `docs/kubernetes/chrek/standalone.md`、`fern/pages/kubernetes/chrek/standalone.md` | 更新 env‑var 名称、就绪文件路径、示例 YAML/代码。 |
| **CI / 测试** | 无直接代码变更，但需覆盖新 Manifest、HTTP API、link‑remap、/dev/shm 逻辑。 |

---

## 🔍 技术洞察

### 架构影响
| 维度 | 说明 |
|------|------|
| **统一 Manifest** | 所有 checkpoint 相关的元数据（CRIU 选项、文件系统、挂载、命名空间）现在保存在单一 `manifest.yaml`，简化恢复侧的读取路径，消除跨版本的 JSON 兼容问题。 |
| **ConfigMap‑driven 配置** | checkpoint agent 的行为（CRIU 参数、根文件系统排除、挂载策略）通过 `config.yaml` 动态下发，避免硬编码在镜像中，提升可运维性和多集群适配性。 |
| **HTTP API 替代原有 watchdog** | 通过 `httpApiServer` 对外提供 `/checkpoint`、`/health`、`/checkpoints` 接口，支持 **watcher** 与 **http** 两种触发模式，解耦了 DaemonSet 与业务容器的耦合。 |
| **Mount‑policy 重写** | 通过 `BuildMountPolicy` 对 `/proc/<pid>/mountinfo` 进行分类，仅对 **OCI‑managed**、**runtime‑owned** 路径标记为 `external`; 其余非关键路径（`/proc/*`, `/sys/*`, `/run/*`）直接 **skip**，显著降低 CRIU `external` 列表的体积并避免恢复时的 “no mapping” 错误。 |
| **/dev/shm 持久化** | 在 checkpoint 阶段捕获 `/dev/shm`（tmpfs）文件，恢复前写回，避免因缺失共享内存导致的进程启动失败或信号量错误。 |
| **link‑remap stub** | 解析 `remap-fpath.img` 与 `reg-files.img`/`files.img`，自动创建硬链接占位文件，解决 “Can't link … link_remap.X → …: No such file or directory” 的跨节点恢复阻断。 |
| **Seccomp Profile** | 通过 init‑container 自动把 `block-iouring.json` 挂载到节点并在 Pod 中启用，保持与旧实现相同的安全限制。 |
| **Operator 迁移** | `InjectCheckpointEnvVars`、`InjectCheckpointVolumeMount`、`InjectCheckpointSignalVolume` 等函数已改为使用新常量与 ConfigMap；旧的 `EnvCheckpointReadyFile`、`EnvCheckpointSignalFile` 等被统一为 `DYN_READY_FOR_CHECKPOINT_FILE`、`DYN_CHECKPOINT_SIGNAL_FILE`。 |
| **跨节点恢复路径** | `ShouldRestore` 与 `WaitForCheckpoint` 逻辑改为检查 `checkpoint.done` 标记（写入顺序：metadata → CRIU dump → rootfs‑diff → `checkpoint.done`），保证恢复只在完整的 checkpoint 上触发。 |

### 性能影响
| 影响 | 细节 |
|------|------|
| **Checkpoint 时长** | 通过更精细的外部挂载过滤（skip `/proc`, `/sys`, `/run`）以及根文件系统的 **exclusions**（系统目录、缓存）减少 `tar` 打包体积，理论上可以降低 `tar`/`rootfs‑diff` 耗时 10‑30%。 |
| **恢复时长** | `link‑remap` stub 自动生成后，恢复时不再出现硬链接缺失错误，避免因 CRIU 重试导致的额外等待。 |
| **内存占用** | `ReadMountInfoFromHostProcPath` 与 `BuildMountPolicy` 仅在 checkpoint 阶段使用，缓冲区限制在 1 MiB，内存开销可忽略。 |
| **网络 I/O** | HTTP API 使用 `ReadTimeout = CRIU timeout + 60s`，避免因长时间阻塞导致请求超时；同时支持 **watcher** 本地事件，网络开销最小。 |
| **磁盘 I/O** | `dev‑shm` 与 `rootfs‑diff` 采用流式 `tar`，不会在内存中完整展开，降低磁盘缓存压力。 |
|

---

### fix: restrict Image.open() formats to prevent PSD parsing (workaround) (#6212)
**SHA**: `b6824ae` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/b6824ae0957003922eda4c5bb9b62c03b1d14e47)

**🎯 变更类型**：Bug修复 / 安全修复  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：在 Dynamo 项目中，所有多模态图片加载实现（`multimodal_image_loader.py`、`image_loader.py` 以及示例代码）统一加入 `Image.open(..., formats=["JPEG", "PNG", "WEBP"])` 限定，仅允许 JPEG、PNG、WEBP 三种格式。此举防止 Pillow 在解析 PSD 文件时触发已知安全漏洞 GHSA‑cfh3‑3jmp‑rvhc。  

**🎯 影响范围**：  
- `components/src/dynamo/sglang/multimodal_utils/multimodal_image_loader.py`  
- `components/src/dynamo/vllm/multimodal_utils/image_loader.py`  
- `examples/multimodal/utils/image_loader.py`  
（所有调用 `load_image` 的上层模型推理路径及示例脚本）  

**🔍 技术洞察**：  
- **架构影响**：仅在图片加载层面做了参数约束，未修改调用链或模块接口，保持向后兼容（除非调用方依赖 PSD）。架构层面的耦合度极低。  
- **性能影响**：`Image.open` 已在子线程执行，额外传递 `formats` 参数的开销可忽略；对已受限的 JPEG/PNG/WEBP 仍保持原有加载速度。  
- **安全考虑**：直接规避了 Pillow 对 PSD 的解析路径，消除了 CVE‑2023‑XXXXX（GHSA‑cfh3‑3jmp‑rvhc）导致的任意代码执行风险，提升了服务在多租户或开放网络环境下的安全保障。  

**⚠️ 潜在风险**：  
1. **功能回退**：原本支持 PSD 图片的用户将收到 `UnidentifiedImageError` 或自定义异常，可能导致推理任务中断。  
2. **兼容性**：若未来引入其他合法的图片格式（如 TIFF、HEIC），需要同步更新白名单，否则会出现意外拒绝。  
3. **错误信息**：当前代码在格式不匹配时仅抛出 `ValueError`，未区分“格式不受支持” 与 “加载失败”，调试时可能产生歧义。  

**💡 关注建议**：  
- **文档 & 通知**：在发布说明或 API 文档中明确说明仅支持 JPEG、PNG、WEBP，建议用户在前置步骤自行转换 PSD 等其他格式。  
- **回退机制**：若业务上仍需处理 PSD，可在调用方捕获异常后使用安全的外部转换工具（如 `magick convert`) 先转为 PNG 再提交。  
- **测试覆盖**：新增单元测试，确保对不在白名单的文件返回可预期错误，同时验证对受支持格式的加载时延保持不变。  
- **监控**：在生产环境加入加载异常监控（如 Prometheus metric），快速捕获因格式限制导致的错误率上升。  
- **长期路线**：评估 Pillow 未来版本是否提供更细粒度的安全开关，若有可直接升级而无需硬编码白名单。

---

### fix: Cleanup pytest markers, enable gpu_0 tests on trtllm arm, reduce log noise (#6124)
**SHA**: `4220771` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/4220771fba33867bf351a019e396b6afbc1021ee)

**🎯 变更类型**：Bug修复 / 质量提升  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：本次提交清理并统一了 pytest 标记，新增 *aiconfigurator* 标记以覆盖 AI 配置器相关的端到端测试；在 ARM 架构上恢复对 TRT‑LLM GPU_0 标记的测试执行，同时在缺少 CUDA 时通过 `pytest.skip` 进行安全跳过；CI 工作流去掉了对 TRT‑LLM 在 arm64 平台上不运行测试的硬性限制，并将大量信息级日志降为调试级，从而降低 CI 日志噪声。

**🎯 影响范围**  
- CI/CD 工作流 (`.github/workflows/build-test-distribute-flavor-matrix.yml`)  
- 所有位于 `components/src/dynamo/trtllm/tests/**`、`tests/fault_tolerance/**`、`tests/router/**`、`tests/planner/**`、`tests/profiler/**` 等目录的单元/集成测试文件  
- `pyproject.toml` 与 `tests/conftest.py` 中的 pytest 标记注册  

**🔍 技术洞察**  

- **架构影响**：  
  - 仅涉及测试层面，未改动业务代码、库接口或运行时架构。  
  - 通过在测试入口处动态判断 `torch.cuda.is_available()`，在无 GPU 环境下安全地跳过依赖 GPU 的 TRT‑LLM 测试，防止 CI 在 ARM（常用于 CPU‑only）节点上因导入错误而失败。  
  - 新增 *aiconfigurator* 标记，为后续在 `benchmarks/profiler` 中区分 AI 配置器相关基准提供结构化入口。

- **性能影响**：  
  - CI 执行时间可能略有提升：原先在 arm64 上直接跳过 TRT‑LLM 测试，现在会尝试收集测试并在运行时快速跳过（开销极低）。  
  - 日志级别从 `INFO` 降到 `DEBUG`，可显著减少 CI 输出大小，加快日志上传与查看的效率。

- **安全考虑**：  
  - 通过 `pytest.skip(..., allow_module_level=True)` 防止在缺少 CUDA 的机器上加载 `tensorrt_llm` 产生的 `ImportError` 或未捕获的 GPU 调用错误，提升 CI 稳定性。  
  - 未引入新的安全风险；相反，减少了因异常导入导致的 CI 故障。

**⚠️ 潜在风险**：  
1. **隐藏真实缺陷**：在有 CUDA 但驱动或库不完整的环境下，`torch.cuda.is_available()` 仍可能返回 `True`，导致测试继续执行并暴露潜在错误；相反，若环境误报 `False`，相关 GPU 测试将被跳过，可能错失回归检测。  
2. **ARM 上的 GPU 兼容性**：如果未来在 ARM64 节点上配备了 GPU，`run_tests` 现在始终为 `true`，测试会实际运行，需确保对应镜像已支持 CUDA/ROCm，否则仍会因底层库缺失而报错。  
3. **日志级别变更**：将重要信息降为 `DEBUG` 可能在排查 CI 中的非预期行为时失去部分可视化线索，需要在本地或特定调试 CI 里手动提升日志等级。  

**💡 关注建议**：  
- **CI 配置审查**：确认 ARM64 CI 机器的硬件配置，如未来计划添加 GPU，需要同步更新镜像构建脚本以支持 CUDA/ROCm。  
- **测试覆盖监控**：在 CI 报告中加入 `--durations=0` 或类似统计，确保被 `skip` 的 GPU 测试数量可被监控，防止长期忽视。  
- **日志策略**：如在调试阶段需要恢复 `INFO` 级别，可在 CI 环境变量中临时覆盖 `RUST_LOG` / `PYTHON_LOG_LEVEL`。  
- **标记文档同步**：更新项目文档（`README.md` / `CONTRIBUTING.md`）说明新增的 `aiconfigurator`、`fault_tolerance` 等标记的用途，帮助贡献者正确使用 `-m` 过滤。  
- **回归验证**：在具备 GPU 的 ARM64 实例上跑一次完整的测试套件，确认 `run_tests` 开关与 `skip` 逻辑共同工作不会产生意外错误。  

---

---

### feat: Metric for detokenization latency (#6160)
**SHA**: `adaf1a3` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/adaf1a39890466f53a00e947730399540191547e)

**🎯 变更类型**：功能增强  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：  
- 为 LLM 推理路径引入 Detokenization 延迟度量，新增 `RequestTracker::record_detokenize_latency` 并在 `Decoder` 中记录每次解码的耗时。  
- 扩展 `LLMMetricAnnotation`、`ResponseMetricCollector` 与 `OpenAIPreprocessor`，分别收集、传播并在请求结束时上报 Tokenize 与 Detokenize 的延迟统计。  
- 对 `Decoder` 构造函数、基准测试、单元测试等调用方完成兼容性改动，去除旧的 `log` 用法，改为 `tracing`。

**🎯 影响范围**：  
- `lib/llm/src/backend.rs`、`decoder.rs`（解码路径）  
- `lib/llm/src/protocols/common/timing.rs`（度量追踪器）  
- `lib/llm/src/preprocessor.rs`（预处理与注解）  
- `lib/llm/src/http/service/metrics.rs`（Prometheus 采集）  
- 基准测试 `lib/llm/benches/tokenizer.rs`、单元测试 `test_stop_behavior.rs`、相关测试模块  

**🔍 技术洞察**  
- **架构影响**：  
  - 在请求生命周期中加入可选的 `RequestTracker`，通过 `Arc` 传递到 `Decoder`，实现解码阶段的细粒度度量。  
  - 度量信息通过 `LLMMetricAnnotation` 注入到后端响应流，再由 `ResponseMetricCollector` 统一上报，保持原有架构的解耦。  
  - 新增的字段（`tokenize_latency`、`detokenize_total_ns`、`detokenize_count`）在 `RequestTracker` 中使用 `OnceLock` 与 `AtomicU64`，兼容并发请求。

- **性能影响**：  
  - 每个 token 解码会创建 `Instant::now()`、一次原子累加 (`fetch_update` + `fetch_add`) 与一次 `Instant::elapsed()`，在大规模推理中引入的 CPU 开销极小（纳秒级），但在每秒数万 token 场景下仍需监控。  
  - 使用 `Relaxed` 原子顺序保证低开销；饱和相加防止计数溢出。  
  - 通过 `Drop` 计算 Detokenize 平均延迟，避免在请求流中频繁计算聚合。

- **安全考虑**：  
  - 仅收集时间统计，不涉及用户数据；仍需确保监控端点的访问控制，防止外部获取细粒度性能数据用于侧信道攻击。  
  - 代码路径中未引入任何新的可序列化数据，序列化/反序列化安全性保持不变。

**⚠️ 潜在风险**  
1. **API 兼容性**：`Decoder::new` 签名从 `(..., bool)` 改为 `(..., bool, Option<Arc<RequestTracker>>)`，外部直接调用的库使用者若未适配会编译失败。  
2. **度量泄漏**：如果 `ResponseMetricCollector` 未正常 `drop`（例如被 `std::mem::forget`），Detokenize 的平均值将不会上报，导致监控不完整。  
3. **原子计数溢出**：虽然使用 `saturating_add`，但在极端超长会话（数十亿 token）仍可能导致统计失真。  
4. **微小的性能回退**：在极高吞吐场景下，额外的 `Instant` 与原子操作可能略微提升延迟，需要通过基准验证。

**💡 关注建议**  
- **迁移指南**：在项目文档或 CHANGELOG 中注明 `Decoder::new` 参数变更，建议使用 `None` 维持旧行为。  
- **监控验证**：部署后使用 Prometheus 查询 `tokenizer_latency`（`tokenize`、`detokenize`）的分布，确保数值在预期范围内；若出现异常应检查是否所有请求都正确创建 `RequestTracker`。  
- **性能基准**：在高吞吐模型（如 70B）上重新跑 `benches/tokenizer.rs`，对比 `detokenize_latency` 记录前后每 token 的整体延迟，以确认开销在可接受阈值（< 1 µs）内。  
- **安全加固**：若对外暴露监控端点，确保仅内部网络或授权用户可访问，以避免泄露内部推理时延信息。  
- **代码审计**：确认所有新添加的 `Arc<RequestTracker>` 只在需要统计的路径传递，避免在不计量的路径中产生不必要的引用计数开销。

---

### feat: include operator version in DGD (#6121)
**SHA**: `4f68626` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/4f686262de57877dd79f16000a5a3a94ccfce5bf)

**🎯 变更类型**：功能增强 / 架构变更  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：  
- 将 Operator 版本信息通过 Helm 参数 `--operator-version` 直接注入容器启动参数，并在 `Chart.yaml` 中将版本提升至 `1.0.0-dev`。  
- 新增 **mutating webhook**（默认化）用于在 `DynamoGraphDeployment`（DGD）创建时自动打上 `nvidia.com/dynamo-operator-origin-version` 注解，后续可实现版本‑Gate 的行为。  
- 相应地在 Helm Chart 中补充 MutatingWebhookConfiguration、RBAC 权限及 CA‑Bundle 注入逻辑，并在控制器侧完成注解的传播与校验。  

**🎯 影响范围**：  
- `deploy/helm/charts/platform`（平台 Helm Chart 及子 Chart）  
- `deploy/operator`（Operator 二进制、启动入口、依赖）  
- `deploy/operator/internal/consts`（新增常量）  
- `deploy/operator/internal/webhook/defaulting`（新 Mutating Webhook）  
- `deploy/operator/internal/webhook/validation`（注解校验）  
- `deploy/operator/internal/dynamo/graph.go`（注解向下游组件传播）  

---

### 🔍 技术洞察

| 维度 | 影响分析 |
|------|----------|
| **架构影响** | 1. **新增 Mutating Webhook**：在 DGD CREATE 阶段写入 Operator 版本注解，形成 “origin‑version” 元数据链路。<br>2. **Helm Chart 扩展**：加入 MutatingWebhookConfiguration、对应 RBAC（ClusterRole/RoleBinding）以及 CA‑Bundle 注入 Job，实现自助签发证书。<br>3. **版本统一**：Operator 镜像 tag、Helm Chart `appVersion`、`--operator-version` 参数全部同步，避免历史版本混用。 |
| **性能影响** | - Webhook 仅在 DGD **创建** 时触发，调用链为 API Server → MutatingWebhook → Operator → 返回 Patch，延迟在毫秒级，对整体吞吐基本无影响。<br>- 额外的 RBAC 检查和 CA‑Bundle 注入 Job 只在 Helm 部署时执行一次，属于一次性成本。 |
| **安全考虑** | - **RBAC新增**：在 `webhook-ca-inject-job.yaml` 中为 MutatingWebhookConfiguration 加入 `admissionregistration.k8s.io` 权限，确保只有 Operator 能修改 webhook 配置。<br>- **CA‑Bundle注入**：通过 Job 自动把签发的 CA 注入 MutatingWebhookConfiguration，防止 Man‑in‑the‑Middle。<br>- **注解校验**：使用 semver 校验 `nvidia.com/dynamo-operator-origin-version`，阻止恶意或错误的非语义化版本写入。 |
| **可维护性** | - 常量统一（`KubeAnnotationDynamoOperatorOriginVersion`），避免硬编码字符串。<br>- 将默认化逻辑抽离为独立 `defaulting` 包，遵循 controller‑runtime 的 webhook 编写模式，便于以后扩展更多默认化规则。<br>- 单元测试覆盖默认化与注解校验，提升回归安全性。 |
| **兼容性** | - 对已有 DGD **不做改动**：默认化只在 CREATE 时写入，已有资源保持原注解。<br>- 通过 `operatorVersion` 参数的 **fallback**（`0.0.0-unknown`）保持向后兼容，防止因镜像标签缺失导致启动失败。 |
| **运维影响** | - Helm 部署时需确保 `--operator-version` 参数可解析（semver），否则会在 Operator 启动日志中提示并回退。<br>- 集群需要支持 `admissionregistration.k8s.io/v1`（K8s 1.22+），低版本集群需升级或使用 `v1beta1` 兼容分支。 |

---

### ⚠️ 潜在风险

1. **Webhook 配置错误**：若 MutatingWebhookConfiguration 未正确创建或 CA‑Bundle 注入失败，DGD 将缺失 `origin-version` 注解，导致后端版本‑gate 逻辑失效。  
2. **RBAC 不完整**：新增的 `admissionregistration.k8s.io` 权限如果被集群安全策略阻断，会导致 webhook 注册错误。  
3. **Semver 解析失败**：Operator 启动时若 `operatorVersion` 不是有效 semver，将回退为 `0.0.0-unknown`，这可能误导依赖该注解的业务逻辑。  
4. **升级链路中断**：Helm Chart 版本从 `0.9.0`→`1.0.0-dev`，若用户在 CI/CD 中硬编码旧版本号，升级会被阻断。  
5. **资源冲突**：在开启 `namespaceRestriction` 时，Mutating webhook 名称会带命名空间后缀，若同一命名空间多次部署不同版本的 operator，可能出现名称冲突。  

---

### 💡 关注建议

- **部署验证**：在 CI/CD 中加入步骤，检查 Helm 部署后 **MutatingWebhookConfiguration** 是否已创建且 `caBundle` 已填充。  
- **日志监控**：关注 Operator 启动日志中的 “Operator version configured” 与 “stamped operator origin version on DGD” 信息，确保版本被正确传递。  
- **兼容性测试**：在 K8s 1.22‑1.27（或对应的最低受支持版本）上跑完整的 e2e 测试，验证 webhook、RBAC 与 CA 注入全部通过。  
- **回滚策略**：若出现 `0.0.0-unknown` 警告，检查镜像标签或 Helm `--set operatorVersion=` 参数是否漏传。  
- **文档同步**：更新 Helm Chart README 与 Operator 部署指南，明确 `operatorVersion` 参数的来源（通常由 CI 自动注入），并说明该注解的意义。  
- **未来扩展**：后续若需要在不同组件（如 DynamoComponentDeployment）上也实现类似版本追踪，只需复用 `KubeAnnotationDynamoOperatorOriginVersion` 常量和默认化逻辑即可。  

---

---

### fix: convert guided_decoding dict to GuidedDecodingParams in TRT-LLM handler (#6127)
**SHA**: `5602dd2` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/5602dd2f6380e9e42fb120c3e8f14a5b6fd026fb)

**🎯 变更类型**：Bug修复  

**⚡ 重要程度**：🔴高  

**📋 变更摘要**：  
- 在 TRT‑LLM 请求处理器的 `_override_sampling_params` 中新增对 `guided_decoding` 字段的显式转换，将从 Rust 前端序列化而来的普通 `dict` 转换为 TRT‑LLM 所需的 `GuidedDecodingParams` 实例。  
- 同时补充单元测试，验证该转换在真实的 Rust‑to‑Python 场景（`tool_choice="required"`）下能够正确完成。  

**🎯 影响范围**：  
- `components/src/dynamo/trtllm/request_handlers/handler_base.py`（核心请求参数处理逻辑）  
- `components/src/dynamo/trtllm/tests/test_trtllm_handler_base.py`（新增测试）  
- 受影响的上层模块：TRT‑LLM 采样参数构造、Dynamo 对外的 Rust 接口入口。  

**🔍 技术洞察**  
- **架构影响**：  
  - 明确了跨语言边界（Rust → Python）的数据契约：Rust 只负责序列化为普通字典，Python 层统一在入口处将其映射为强类型 `GuidedDecodingParams`。  
  - 引入显式字段映射，可避免因双方字段不对称导致的运行时 `AttributeError`，提升系统的容错性和可维护性。  
- **性能影响**：  
  - 转换过程是一次浅拷贝的 dataclass 实例化，开销极低（微秒级），对整体推理吞吐量影响可以忽略不计。  
  - 额外的字段检查（`isinstance(..., dict)`）也几乎不产生性能负担。  
- **安全考虑**：  
  - 通过构造 `GuidedDecodingParams`，会触发其内部的 `__post_init__` 校验逻辑，从而在早期捕获非法或不一致的配置，提升安全可靠性。  
  - 转换过程中只保留已知字段，未显式验证未知字段；若后续引入新字段而未同步到此处，可能导致配置被悄然丢弃，需要在文档或版本升级说明中明确。  

**⚠️ 潜在风险**  
1. **字段同步缺失**：如果 `GuidedDecodingParams` 在 TRT‑LLM 侧新增字段，而此处的映射未同步，可能导致新特性失效或行为不符合预期。  
2. **数据丢失**：当前实现对未知字段采用“忽略”策略，若用户依赖这些字段（比如实验性的选项），会被静默抛弃。  
3. **类型假设**：仅在 `guided_decoding` 为 `dict` 时进行转换，若 Rust 端误传其他可序列化对象（如列表）将保持原样，可能在下游产生属性访问错误。  

**💡 关注建议**  
- **代码层面**：在转换前后加入日志（debug 级别）记录原始 `guided_decoding` 内容和成功构造的 `GuidedDecodingParams`，便于调试和审计。  
- **文档/版本管理**：在发布说明中注明 `guided_decoding` 字段的映射规则，建议 Rust 与 Python 双方在新增字段时同步更新此处实现。  
- **测试覆盖**：补充负向测试，验证当 `guided_decoding` 为非 `dict` 或缺失关键字段时系统的容错行为（应抛出明确异常或保持 `None`）。  
- **监控报警**：在生产环境加入对 `guided_decoding` 转换失败的监控报警，防止因协议不匹配导致推理任务异常终止。  

---

### fix: added standard assets from NVIDIA fern styling (#6148)
**SHA**: `33ddd8f` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/33ddd8fb62c7e9b495ff6c6799104bdc7d0635ef)

**🎯 变更类型**：功能增强  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：为 NVIDIA Dynamo 文档站点添加官方品牌资产（SVG logo、字体），引入自定义 React Footer 组件并在 `fern/docs.yml` 中配置，新增完整的主题 CSS、更新 Fern 配置版本以及修正部分 Markdown 资产引用路径，提升站点品牌一致性与 UI 细节。  

**🎯 影响范围**：  
- `fern/docs.yml`、`fern/fern.config.json`（文档生成配置）  
- `fern/components/CustomFooter.tsx`（自定义页脚）  
- `fern/main.css`（站点全局样式）  
- `fern/assets/*`（SVG Logo、字体文件）  
- `fern/pages/design-docs/planner-design.md`（图片路径）  
- 文档构建流水线（Fern CLI）以及最终生成的静态站点  

**🔍 技术洞察**：  
- **架构影响**：  
  - 引入了 **React 组件** 作为文档站点的 Footer，Fern 文档生成器会在运行时注入该组件，属于 UI 层的可插拔扩展，不会改变后端业务逻辑。  
  - `docs.yml` 中新增了 `footer: ./components/CustomFooter.tsx`、`layout`、`experimental.mdx-components` 等字段，使文档站点的布局、搜索栏位置、MDX 组件目录等被重新定义，整体呈现层架构更加模块化。  
  - 版本号从 `3.52.0` 升至 `3.73.0`，若 Fern CLI 对特定版本有破坏性变更，需要确认本仓库的其它插件兼容性。  

- **性能影响**：  
  - 新增的 **CSS（≈ 867 行）** 与 **四个字体文件（≈ < 200 KB）** 会略微提升首屏下载体积，约 100 KB 左右（视浏览器缓存而定），对大多数用户影响可忽略。  
  - 自定义 Footer 通过纯前端渲染，无额外网络请求（除徽标 SVG），不会导致运行时性能回退。  
  - 添加的 `AdobeDTM` 脚本已在配置中通过 `strategy: beforeInteractive` 加载，保持原有加载顺序；若未使用可考虑延迟加载以降低阻塞。  

- **安全考虑**：  
  - 所有新增资产均托管在 **AWS S3（HTTPS）**，符合安全传输要求。  
  - `CustomFooter` 中的外链（如 NVIDIA 官网）使用 `target="_blank"` 并设置了 `rel="noopener"`，可防止 Tab‑nabbing。  
  - 需检查站点的 **Content‑Security‑Policy** 是否已允许 `https://assets.adobedtm.com` 与 `https://fern-image-hosting.s3.us-east-1.amazonaws.com`；若未列入白名单，可能导致资源被阻断。  
  - 新增的 CSS 并未引入动态脚本或 `@import`，安全风险极低。  

**⚠️ 潜在风险**：  
1. **资产路径错误**：`planner-design.md` 中图片路径已改为绝对路径 `/assets/img/...`，若站点部署的根路径不是 `/`（例如子目录），可能导致 404。  
2. **CSS 冲突**：全局变量及 `!important` 使用较多，可能覆盖 Fern 默认主题导致意外布局或颜色异常。  
3. **版本不兼容**：Fern CLI 升级至 `3.73.0`，但项目中可能仍使用旧版插件或自定义组件，需在 CI 中验证。  
4. **加载顺序**：`AdobeDTM` 脚本在 `beforeInteractive` 阶段加载，若脚本内部出现错误，可能阻塞后续渲染。  
5. **字体文件缺失**：若 `NVIDIASans`、`RobotoMono` 字体未在构建产物中正确复制，浏览器会回退到系统字体，影响品牌一致性。  

**💡 关注建议**：  
- **CI 验证**：在 CI 中加入文档构建成功检测以及页面快照对比，确保自定义 Footer、Logo、颜色等渲染符合预期。  
- **路径兼容**：使用相对路径或在 `docs.yml` 中配置 `baseUrl`，避免因部署子路径导致资产加载失败。  
- **CSP 更新**：若项目使用 CSP，及时把 `https://fern-image-hosting.s3.us-east-1.amazonaws.com` 与 `https://assets.adobedtm.com` 加入 `script-src` / `img-src` / `font-src`。  
- **性能监控**：通过 Lighthouse 或 Web Vitals 检查新增 CSS、字体对 LCP、CLS 的影响，必要时开启 **font-display: swap**（可在 `@font-face` 中添加）以提升首屏文字渲染。  
- **回滚策略**：保持原始 `docs.yml` 与 `CustomFooter.tsx` 的备份分支，以便快速回滚到无自定义 Footer 的版本，避免因组件错误导致站点不可用。  

---  
> 综上，此次提交在品牌化和 UI 细节上提供了显著增值，风险主要集中在资产路径、CSS 覆盖以及 Fern 版本兼容性上。通过上述检查与监控手段，可将潜在风险降至可接受范围，安全、性能与可维护性均保持在良好水平。

---

#### 🟡 中重要度变更 (6)

### docs: add Discovery Plane, refactor Event Plane with D2 diagrams (#6229)
**SHA**: `2ec1c3f` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/2ec1c3f503988160d7303766da1458d19348f6a5)

**🟢 变更类型**：文档·功能增强  

**🧭 变更摘要**  
- 新增 *Discovery Plane* 章节及完整架构图（discovery‑plane.svg、discovery‑plane‑lease.svg）。  
- 对 *Event Plane* 文档进行大幅重构，改为基于 **NATS / ZMQ** 两种可选传输的概览，删除旧的 etcd‑NATS 合并图，新增 transport 说明图 (event‑plane‑transport.svg)。  
- 新增 D2 源文件用于生成上述 SVG，方便以后维护。  
- 更新导航（`next.yml`）以及 Fault‑Tolerance README 中的链接，加入对 Discovery Plane 的引用。  

**💥 影响范围**  
- **docs/**（所有新增/修改的 Markdown、SVG、D2 文件）  
- **docs/versions/next.yml**（导航）  
- **docs/pages/fault-tolerance/README.md**（交叉引用）  

**🔧 建议**  
1. **构建检查**：本次只改动文档，CI 中的文档生成（MkDocs/Docsy 等）可能会因相对路径或未生成的 SVG 报错，建议在 CI 环境跑一次 `mkdocs build`（或相应命令），确保 `assets/img/*.svg` 能被正确发现。  
2. **链接完整性**：确认老文档（如 `event-plane.md` 中原来的 `event-plane-coordination.svg`）是否仍被引用，若已删除需同步更新其它页面的图片引用，防止 404。  
3. **图形统一**：新引入的 ZMQ 传输示意图与 NATS 说明配合良好，建议在文档首页或概览图加入“可选传输”说明，帮助读者快速了解两者差异。  
4. **版本说明**：`next.yml` 已加入 *Discovery Plane*，但如果已有历史文档仍指向旧章节，建议在迁移指南中注明路径变更。  
5. **本地预览**：本地运行 `mkdocs serve` 来检查 Markdown 渲染、代码块高亮、目录层级是否与导航保持一致。  

总体来看，此次提交为文档层面的功能扩展，未改动代码，风险主要在文档构建和链接完整性上。按上述检查点验证后即可合入。

---

### ci: fix fern CLI after docs/ migration by adding fern/ symlink (#6219)
**SHA**: `21abf07` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/21abf0768664e91f8351092dc9990fe9a2f93e27)

**🎯 变更类型**：CI 修复 / 文档小幅更新  
**⚡ 重要程度**：🟡 中  

**📋 变更摘要**  
1. 在 GitHub Actions 的 Fern 文档流水线中，新增一步在 `docs`（或 `docs-checkout/docs`）目录下创建 `fern → .` 的符号链接，满足 Fern CLI 仍然期望 `fern/` 目录的前置条件。  
2. 对 CRD `DynamoGraphDeploymentRequest` 的 `profilingResults` 字段说明做转义处理，避免文档渲染时把 `<name>` 误识别为 HTML 标签。  
3. 统一文档页和 Helm/Operator YAML 中的 SPDX 版权声明格式，去除冗余注释。  

**🎯 影响范围**  
- **CI/CD**：`.github/workflows/fern-docs.yml` 中的所有文档构建、校验、发布任务。  
- **CRD 文档**：`deploy/operator/api/v1alpha1/dynamographdeploymentrequest_types.go` 以及对应的 CRD YAML 与 Helm chart。  
- **文档**：`docs/pages/**` 与 `deploy/operator/docs/header.md` 的 SPDX 头部。  

**💡 关注建议**  
1. **CI 稳定性**：符号链接的创建依赖 `ln -s . fern`，在 Windows runner 上会失败。若未来支持跨平台，建议使用跨平台脚本（例如 `python -c "import pathlib; pathlib.Path('fern').symlink_to('.')"`) 或在 `actions/setup-node` 步骤后直接使用 `run: mkdir -p fern && cp -r . fern/` 的方式。  
2. **清理旧残留**：确保仓库中不再保留旧的 `fern/` 目录或其它软链接，避免因路径冲突导致文档校验异常。  
3. **CRD 描述转义**：`<name>` 已改为 `\<name\>`，但该写法在 `kubectl` 自动生成的 OpenAPI 文档里仍可能被渲染为原始字符。建议在 CRD 注释中使用 markdown 代码块 `` ` <name> ` `` 或者在 `kubebuilder:validation:Pattern` 中加入显式说明，以提升可读性。  
4. **文档统一**：SPDX 头部已统一为简洁的 YAML 前置块，检查其他文档目录是否仍保留旧的 HTML 注释，以免产生版权审计差异。  

总体来看，此次提交主要是修复文档流水线因目录结构迁移导致的构建错误，风险有限且对产品功能无直接影响。只需关注跨平台兼容性和 CRD 注释的最终渲染效果即可。

---

### docs: migrate Fern docs from fern/ into docs/ (#6206)
**SHA**: `39d645e` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/39d645e58647d6adb074650e46be5de25f3f3bc6)

⚠️ LLM分析失败（已重试3次）: API请求失败: 400 Client Error: Bad Request for url: https://integrate.api.nvidia.com/v1/chat/completions

*暂无分析*

---

### fix: use tempfile.TemporaryDirectory in load generator test (#6196)
**SHA**: `45bc1b7` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/45bc1b798cce7f176b6e5ab73d171cddea98d98a)

**🎯 变更类型**：Bug 修复  
**⚡ 重要程度**：🟡 中  
**📋 变更摘要**：在 `tests/planner/test_load_generator.py` 中，将原本依赖 `pytest` 的 `tmp_path` fixture 改为使用 `tempfile.TemporaryDirectory`，保证在异常路径（如超时）下临时目录能够被可靠清理，避免因测试提前退出而残留目录。  
**🎯 影响范围**：仅 `tests/planner` 模块的 `test_load_generator.py`（不影响生产代码）。  

**💡 关注建议**  
1. **兼容性**：`TemporaryDirectory` 在 Windows 上返回的路径是 `str`，与 `generate_load` 期望的 `PathLike` 对齐，但若后续实现改为接受 `Path`，请确认仍能兼容。  
2. **导入**：已新增 `import tempfile`，请检查项目的 lint 配置是否要求标准库导入排序（如 `isort`）。  
3. **测试可靠性**：该改动使测试在异常退出时仍能自动清理目录，提升 CI 稳定性；建议在 CI 环境下重新运行相关负载生成测试，确认无残留文件。  
4. **文档**：若项目文档中提及使用 `tmp_path` 编写类似测试，可适当更新为 “推荐使用 `tempfile.TemporaryDirectory`”。  

总体而言，此次修改仅涉及测试实现细节，不会影响库的功能或性能，提升了测试的健壮性。请在提交后运行全套单元测试，以确保所有平台均通过。

---

### chore: remove kv indexers bindings (#6159)
**SHA**: `6a728d1` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/6a728d104455328ae512312c10aeb6363f343048)

**🎯 变更类型**：chore（删除 KV Indexer 相关绑定）  
**⚡ 重要程度**：🟡 中  

**📋 变更摘要**  
- 在 Python 绑定中移除了 `KvIndexer` 与 `ApproxKvIndexer` 两个类的导出及实现；对应的 `lib/bindings/python/rust/llm/kv.rs` 大幅删减（约 180 行）。  
- 同步更新 `Cargo.lock`，去掉了 `aligned-vec、cudarc、nix*、memoffset@0.7` 等不再使用的依赖，统一使用 `memoffset@0.9`。  
- Python 包入口 `__init__.py` 也删掉了相应的导入，测试文件 `test_kv_bindings.py` 删除了全部与这些类相关的异步测试，仅保留 `RadixTree` 的基本验证。  

**🎯 影响范围**  
- **Python API**：`dynamo.llm.KvIndexer`、`dynamo.llm.ApproxKvIndexer` 将不再可用，任何依赖这些类的脚本或库需要改为使用 `KvEventPublisher` + `RadixTree` 或自行实现 KV 索引逻辑。  
- **依赖管理**：`Cargo.lock` 变动导致重新编译时会重新解析依赖树，可能影响 CI 缓存。  
- **测试套件**：原先的 KV 索引器功能测试被删除，只有 `RadixTree` 的单元测试保留。  

**💡 关注建议**  
1. **文档/示例更新**：请同步更新 README、API 文档以及代码示例，去除已删除类的说明，避免用户在升级后遇到 `ImportError`。  
2. **兼容层**：如果仍有用户需要旧行为，考虑在 `dynamo.llm` 中提供一个薄包装 （如 `DeprecatedKvIndexer`）抛出明确的弃用提示，便于平滑迁移。  
3. **CI/发行版**：确认 `Cargo.lock` 的改动已提交至 CI，确保所有平台（Linux/ macOS/ Windows）都能成功编译；若使用二进制分发，重新生成 wheel 包。  
4. **回归检测**：虽然只删减了绑定代码，但底层 `llm_rs::kv_router::indexer` 仍在库中保留，确保没有遗漏的内部调用导致运行时 panic。  

总体而言，此次提交清理了不再维护的 KV 索引器绑定，减小了绑定体积并简化依赖，唯一需要关注的是上层 Python 使用者的迁移路径。

---

### test: adding interface contract tests for KVBM vLLM integration (#5847)
**SHA**: `f9d20c1` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/f9d20c109757f36c5fc292522727bc10870277fd)

**🎯 变更类型**：测试 （interface‑contract 验证）  
**⚡ 重要程度**：🟡 中  
**📋 变更摘要**  
- 新增 `tests/kvbm_integration/test_kvbm_vllm_integration.py`（约 330 行），为 KVBM 与 vLLM 的内部接口加入“契约”单元测试。  
- 通过 `assumes()`、`_check_*` 系列函数检查 vLLM 的 dataclass、属性、返回类型以及容器泛型是否符合 KVBM 的期望，防止 vLLM 升级时出现隐藏的 API 破坏。  

**🎯 影响范围**  
- **core / kvbm**：KVBM 依赖的 `vllm` 配置、调度输出、请求对象等结构。  
- **tests**：新增 `kvbm_integration` 测试目录，受 `pytest` 及 `pytest.mark` 标记控制。  
- **CI**：在包含 `vllm` 的环境下会额外运行这些合同测试，导致构建时间略增。  

**💡 关注建议**  
1. **保持向后兼容**：如果未来需要修改 vLLM 接口，必须同步更新对应的 `assumes` 检查，否则 CI 将直接报错。  
2. **依赖管理**：确保 CI 镜像预装兼容版本的 `vllm`，或在 `pyproject.toml` 中声明可选依赖，以免 “module not found” 导致全部测试跳过。  
3. **性能与可维护性**：这些合同测试只在 `HAS_VLLM` 为真时运行，建议在 nightly/预合并分支保留，日常 PR 可通过 `-m "not nightly"` 跳过，以免影响常规 CI 时长。  
4. **文档同步**：在 KVBM 文档或 vLLM 迁移指南中标注本套接口约束，帮助开发者快速定位因接口变更导致的错误。  

总体而言，此提交提升了 KVBM 与 vLLM 之间的鲁棒性，风险主要在于 vLLM 接口演进时需要同步更新测试或及时调整 KVBM 实现。

---

#### 🟢 低重要度变更 (8)

### chore: warn out request rejection (#6222)
**SHA**: `7b16480` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/7b16480ab47a9c4dbd15047bfc7ef8c177bebf98)

**🎯 变更类型**：代码重构  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在 `push_router` 中，所有工作实例忙碌时新增 `tracing::warn!` 日志，记录实例 ID 与总 worker 数，便于排查服务过载。

---

### docs: update docs URLs from Sphinx index.html to Fern paths (#6218)
**SHA**: `3075028` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/307502842ee83fd5a9657a64b9dde839493ef1d0)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：将项目中的所有 NVIDIA Dynamo 文档链接从 Sphinx 的 `.../latest/index.html`（以及归档的 `.../archive/<ver>/index.html`）统一替换为 Fern 新路径 `https://docs.nvidia.com/dynamo/` 与 `https://docs.nvidia.com/dynamo/v-<ver>/`，同步更新 README、CONTRIBUTING 与内部文档。

---

### test: change KVBM vLLM interface tests to gpu_0 marker (#6205)
**SHA**: `f8d0a9f` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/f8d0a9f9c65fc4af9d58046737519d024f006be1)

**🎯 变更类型**：测试修改  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在 `tests/kvbm_integration/test_kvbm_vllm_integration.py` 中，将 GPU 标记从 `gpu_1` 调整为 `gpu_0`，以匹配相应的测试环境。

---

### chore(deps): bump vLLM to 0.15.1 (#6102)
**SHA**: `2c6e6d2` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/2c6e6d2204753e44767a243312caade4fe20921f)

**🎯 变更类型**：配置调整  
**⚡ 重要程度**：🟢低  
**📋 摘要**：将 vLLM 依赖从 0.14.1 升级至 0.15.1，并同步更新 flashinfer、lmcache 版本及相关文档、容器脚本和 `pyproject.toml` 中的依赖声明。

---

### docs: pointers to global router (#6190)
**SHA**: `1488ef2` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/1488ef2ed8470fa61d34d88acf2cff7aa53f9bab)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在 `router-examples.md` 中新增 “Global Router (Hierarchical Routing)” 小节，说明全局路由的作用并提供组件源码与示例链接。

---

### ci: modify container build routing (#6185)
**SHA**: `a61ac68` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/a61ac6843f78e993c2d91821da27ca3d9faca747)

**🎯 变更类型**：配置调整  
**⚡ 重要程度**：🟢低  
**📋 摘要**：修改 `.github/scripts/route_buildkit.sh` 的路由逻辑，将 trtllm‑cuda13 和 general 分配到轻负载的 Pool 0， vllm‑cuda12 和 sglang‑cuda12 分配到业务时间内的重负载 Pool 2，并更新注释及期望路由表以优化不均匀的 pod 使用时长。

---

### chore: Templating Feedback Followup (#6125)
**SHA**: `3188c70` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/3188c70a3b3291c614dd1f19076d4759a19a73a5)

**🎯 变更类型**：代码重构  
**⚡ 重要程度**：🟢 低  
**📋 摘要**：将渲染脚本的 `--short-output` 参数改为 `--output-short-filename` 并加入输入校验；重构 Dockerfile 模板结构；同步更新文档、CI 工作流、`.dockerignore` 与过滤规则。

---

### chore: Merge bindings client and client2 functions (#6158)
**SHA**: `73dc3be` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/73dc3be81a173f76ad57e0151dca29e327cbb48f)

**🎯 变更类型**：代码重构  
**⚡ 重要程度**：🟢低  
**📋 摘要**：合并 `client` 与 `client2`，在 Python 绑定中将 `router_mode` 设为可选参数（默认 RoundRobin），相应更新了 `vllm_processor` 调用及类型签名。

---

