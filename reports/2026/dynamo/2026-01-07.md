# 每日更新报告（2026-01-07）

## ai-dynamo/dynamo

| 提交时间 | 作者 | 提交信息 |
|----------|------|----------|
| 2026-01-07 17:56:44 | Pavithra Vijayakrishnan | ci: Run the same tests across Github and Gitlab  CI for premerge (#5082) |
| 2026-01-07 08:05:08 | Biswa Panda | docs: update LoRA model name in docs (#5210) |
| 2026-01-07 07:52:29 | Kyle McGill | fix: Fix consolidator tests by computing the number of requests needed to trigger an expected pass (#5220) |
| 2026-01-07 07:12:54 | mohammedabdulwahhab | docs: kube-based service discovery (#5211) |
| 2026-01-07 07:08:08 | Alec | fix: update vLLM to 0.13.0 with API compatibility fixes (#5222) |
| 2026-01-07 06:58:57 | Thomas Montfort | feat(operator): have Scaling Adapter disabled by default (#5180) |
| 2026-01-07 06:28:54 | Hongkuan Zhou | fix: add sweep range for moe dgdr example (#5225) |
| 2026-01-07 05:57:10 | Alec | refactor: extract changed-files logic into reusable composite action (#5216) |
| 2026-01-07 05:45:28 | Alec | fix: assign unique ports per vLLM worker to avoid ZMQ bind conflicts (#5224) |
| 2026-01-07 03:43:04 | Alec | ci: add uncovered files check and improve filter coverage (#5214) |
| 2026-01-07 03:32:53 | Keiven C | docs: fix tracing doc ZMQ port conflict (#5200) |
| 2026-01-07 02:44:20 | Neelay Shah | docs: Update TensorRT-LLM install prerequisites for 1.2.0rc5 (#5194) |
| 2026-01-07 02:17:25 | hhzhang16 | fix: add endpointslices RBAC permission for Planner service account (#5195) |
| 2026-01-07 01:58:34 | Neelay Shah | chore: Remove deprecated Earthfile (#5206) |
| 2026-01-07 01:32:52 | Ran Rubin | build: build.sh enhancement (#5053) |

### 📊 统计摘要
> 本日共 15 个提交 | 🔴高 3 | 🟡中 5 | 🟢低 7
## 📋 目录

- [ai-dynamo/dynamo](#ai-dynamo-dynamo)
  - [📊 统计摘要](#-统计摘要)
  - [🔴 高重要度变更 (3)](#-🔴-高重要度变更-3)
    - [fix: Fix consolidator tests by computing the number of re...](#f7f2fb2)
    - [fix: update vLLM to 0.13.0 with API compatibility fixes (...](#a1333a8)
    - [feat(operator): have Scaling Adapter disabled by default ...](#110cd56)
  - [🟡 中重要度变更 (5)](#-🟡-中重要度变更-5)
    - [fix: add sweep range for moe dgdr example (#5225)](#a821378)
    - [refactor: extract changed-files logic into reusable compo...](#17528f8)
    - [fix: assign unique ports per vLLM worker to avoid ZMQ bin...](#19b5917)
    - [ci: add uncovered files check and improve filter coverage...](#15a2e8d)
    - [fix: add endpointslices RBAC permission for Planner servi...](#c90b87e)
  - [🟢 低重要度变更 (7)](#-🟢-低重要度变更-7)
    - [ci: Run the same tests across Github and Gitlab  CI for p...](#996077f)
    - [docs: update LoRA model name in docs (#5210)](#975870d)
    - [docs: kube-based service discovery (#5211)](#c92a422)
    - [docs: fix tracing doc ZMQ port conflict (#5200)](#194128e)
    - [docs: Update TensorRT-LLM install prerequisites for 1.2.0...](#e8c87f1)
    - [chore: Remove deprecated Earthfile (#5206)](#11d7d3f)
    - [build: build.sh enhancement (#5053)](#96e42f7)
#### 🔴 高重要度变更 (3)

### fix: Fix consolidator tests by computing the number of requests needed to trigger an expected pass (#5220)
**SHA**: `f7f2fb2` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/f7f2fb261293e63165efc2fda512b08476285a24)

**🎯 变更类型**：Bug修复  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：  
1. 为 `tests/kvbm_integration/test_consolidator_router_e2e.py` 引入 `compute_deduplication_test_params` 函数，用于根据 GPU/CPU/Disk 缓存块数动态计算 `max_tokens`、请求数量等测试参数。  
2. 通过该函数为 “remove deduplication across sources” 场景生成更合理的负载，确保块在 GPU、CPU、Disk 三层均被完整淘汰，以触发期望的 REMOVE 事件。  
3. 将原本串行的 100 次请求改为并发（默认 2 线程）执行，并加入详细日志、成功/失败计数以及断言检查。  

**🎯 影响范围**：  
- `tests/kvbm_integration/test_consolidator_router_e2e.py`（仅测试代码）  
- 相关 CI 环境变量 (`DYN_KVBM_CPU_CACHE_OVERRIDE_NUM_BLOCKS`, `DYN_KVBM_DISK_CACHE_OVERRIDE_NUM_BLOCKS`) 的使用方式  

**🔍 技术洞察**  

| 维度 | 影响分析 |
|------|----------|
| **架构影响** | 仅限于测试层面；未修改核心库（`core` 包）或运行时组件。引入的函数封装了参数计算逻辑，提升了测试的可维护性与可配置性。 |
| **性能影响** | - **测试时长**：并发请求会加速填充 GPU 缓存，但总体生成的请求数依据 `offload_overflow_factor`（默认 100）可能显著增加（如示例中会产生 56 次请求），导致 CI 运行时间略有提升。<br>- **资源占用**：在 CI 机器上并发两条请求会临时提升 GPU/CPU/网络负载，但仍在受控范围内。 |
| **安全考虑** | 变更仅涉及测试脚本，未引入外部依赖或改变权限。唯一潜在安全点是使用 `ThreadPoolExecutor` 进行并发网络请求，仍通过已有的 `tester.send_chat_request`，继承其安全校验。无安全漏洞新增。 |
| **可维护性** | - 参数计算抽象为函数，后续若修改缓存块大小或策略，只需更新函数实现或调用处。<br>- 增加了大量内联文档，帮助新贡献者理解 “Goldilocks zone” 及为何需要如此大 `offload_overflow_factor`。 |
| **可靠性** | 并发执行可能导致 **flaky**（间歇性失败）测试，如果底层服务（如 NATS、etcd）在高并发下不够稳健。原来的串行请求在资源争用方面更保守。 |

**⚠️ 潜在风险**  

1. **测试不确定性**：  
   - 并发请求与底层 KVBM 连接器的异步 offload 行为交叉，可能出现时序竞争导致块未按预期被全部淘汰，从而导致 `assert failed_count == 0` 触发。  
   - 依赖环境变量的缓存块大小如果在 CI 中被其他测试修改，可能破坏本测试的 “Goldilocks zone”。  

2. **CI 耗时增长**：`offload_overflow_factor` 设为 100，若 GPU/CPU/Disk 块数更大，计算出的 `num_requests` 可能成百上千，显著拉长 CI 时长。  

3. **资源争用**：并发数固定为 2，若 CI 环境中 GPU 只配置了极小的显存（如 1 GB），并发请求可能导致 OOM 或驱动错误。  

4. **代码复杂度**：新加入的并发逻辑和日志计数使测试代码变得更长，后续维护者若未熟悉 `concurrent.futures`，可能误删或误改导致隐藏的 race 条件。  

**💡 关注建议**  

1. **稳定性保障**  
   - 在 CI 中为该测试单独设定资源限制（如 `GPU_MEMORY_LIMIT=2GiB`）并确保并发数不超过安全阈值。  
   - 使用 `pytest.mark.flaky(reruns=2)` 或类似机制捕获偶发失败，防止因瞬时竞争导致 CI 误报。  

2. **参数可配置**  
   - 将 `offload_overflow_factor` 暴露为环境变量或 pytest 参数，便于在不同硬件环境下调节，避免不必要的请求膨胀。  
   - 为 `concurrency` 也提供可调节入口，以便在资源充足时加速，在资源紧张时降级。  

3. **日志与监控**  
   - 在 `compute_deduplication_test_params` 返回值中加入 `expected_eviction_cycles`（≈ `offload_overflow_factor`），并在测试结束后打印，帮助快速定位是否真的触达了 “last source” 删除。  

4. **回归防护**  
   - 为核心库（非测试）添加单元测试，确保 `compute_deduplication_test_params` 不会意外进入生产代码路径。  
   - 在 `pytest.ini` 中将该文件标记为 `slow`，防止在快速 CI（如 PR 检查）中频繁执行，降低对主线合并速度的影响。  

5. **文档更新**  
   - 在项目的测试章节补充说明：**“Deduplication E2E Test 参数计算”**，列出推荐的块数、`offload_overflow_factor` 范围及并发数的选择原则。  

通过以上措施，可在保持测试准确性的同时，将潜在的 flaky 风险与 CI 耗时控制在可接受范围内。

---

### fix: update vLLM to 0.13.0 with API compatibility fixes (#5222)
**SHA**: `a1333a8` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/a1333a8ddbae093b2949695bf355aca8fed06898)

**🎯 变更类型**：Bug修复 / 兼容性升级  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：本次提交将 Dynamo 对 vLLM 的依赖从 0.12.0 升级至 0.13.0，并同步了上游 API 的破坏性改动，包括 `task → runner` 参数重命名、`_preprocess_chat` 返回值结构变化、以及 `_preprocess_completion` 被移除而改为使用渲染器 (`_get_renderer`)。相应的示例、Docker 镜像、文档以及 `pyproject.toml` 也全部同步更新。

**🎯 影响范围**  
- `components/src/dynamo/vllm/args.py`、`components/src/dynamo/vllm/multimodal_*`（核心处理层）  
- 示例代码 (`examples/deployments/router_standalone/api.py`, `examples/multimodal/*`)  
- Docker 镜像构建脚本 (`container/Dockerfile.vllm`, `container/deps/vllm/install_vllm.sh`)  
- 依赖声明 (`pyproject.toml`)  
- 项目文档 (`docs/reference/support-matrix.md`)  

---

### 🔍 技术洞察  

| 维度 | 影响描述 |
|------|----------|
| **架构影响** | - Dynamo 与 vLLM 的耦合度提升：直接使用了 vLLM 新增的渲染器接口 (`_get_renderer/_build_render_config`) 以及返回值结构。<br>- 参数层面的破坏性改动（`task` → `runner`）引入了向后兼容层代码，若外部调用仍使用旧键会导致运行时错误。<br>- 删除的 `RequestPrompt` 类型导致内部数据流简化，但需要确保所有自定义插件或扩展不再依赖该类。 |
| **性能影响** | - vLLM 0.13 引入若干内部调度与 CUDA kernel 优化，理论上可提升生成吞吐量与延迟。<br>- 迁移至渲染器路径略微增加一次 Python‑C++ 边界调用，但对整体性能影响有限，实际收益仍以 vLLM 本身的升级为主。 |
| **安全考虑** | - 变更仅涉及 API 调用层面，无新增外部依赖或网络交互，安全表面影响不大。<br>- 需要确认渲染器使用的配置（`_build_render_config`）不会泄露敏感模型路径或凭证。 |
| **可维护性** | - 代码对 vLLM 版本的硬编码提升为显式依赖 (`pyproject.toml` 指定 `==0.13.0`) ，有利于 CI 检测一致性，但降低了跨版本的灵活性。<br>- 在多处加入了错误检查 (`raise ValueError`)，提升了调试可读性。 |

---

### ⚠️ 潜在风险  

1. **向后兼容性缺失**  
   - 外部脚本或用户自行调用 `DynamoEngine(..., task="...")` 会因缺少 `task` 键而报错。  
   - 任何自定义的 `vLLM` 插件仍可能引用已删除的 `RequestPrompt` 类。

2. **运行时异常**  
   - 新的渲染器返回值若为空（极端情况下）会触发 `ValueError`，导致服务启动失败。  
   - 参数 `runner` 默认设置为 `"generate"`，若上层业务仍依赖旧的 `"task"` 逻辑，可能产生意料之外的行为。

3. **Docker 镜像不一致**  
   - 镜像构建脚本已更新但 CI 缓存或旧镜像仍可能使用旧的 `VLLM_REF`，导致版本不匹配。

4. **文档同步遗漏**  
   - 部分示例文件已改动，但若还有未更新的 README 或外部教程仍使用旧 API，使用者会遭遇错误。

---

### 💡 关注建议  

- **回归测试**：在 CI 中加入对 `vLLM 0.13` 的完整端到端生成、Chat、流式等场景的回归测试，确保 `runner` 参数、渲染器路径均能正常工作。  
- **兼容层**：考虑在 `args.py` 中保留对旧 `task` 键的兼容转换（如仍检测到 `task` 自动映射到 `runner`），降低用户迁移成本。  
- **插件审计**：检查项目内部或第三方插件是否直接引用 `RequestPrompt`，并提供迁移指南。  
- **镜像发布**：在 Docker CI 中强制刷新镜像缓存，验证 `VLLM_REF=0.13.0` 与 `LMCACHE_REF=0.3.12` 对齐后仍能成功编译并通过推理基准。  
- **文档更新**：在 `support-matrix.md` 与所有示例说明中显式标注 “vLLM ≥0.13 需要使用 `runner` 参数”，并提供快速迁移脚本示例。  
- **监控预警**：部署阶段加入对 `ValueError` 的日志告警，快速捕获因渲染器返回空结果导致的服务不可用。  

通过以上措施，可最大化本次升级带来的性能与功能收益，同时将兼容性和可靠性风险控制在最小范围。祝项目平稳过渡！

---

### feat(operator): have Scaling Adapter disabled by default (#5180)
**SHA**: `110cd56` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/110cd56814aff4c7cde514f87ff0c17a8448830f)

**🎯 变更类型**：功能增强 / 架构变更（默认行为从 “启用 Scaling Adapter” 改为 “禁用 Scaling Adapter” 并改名字段）

**⚡ 重要程度**：🔴高  

**📋 变更摘要**  
- 将 `ScalingAdapter` 的默认行为由 **启用** 改为 **禁用**，并把字段 `disable` 重命名为 `enabled`（默认 `false`）。  
- 更新所有 CRD、Helm Chart、Operator 代码、校验 webhook、文档以及单元测试，使得只有在 `scalingAdapter.enabled=true` 时才会创建 DynamoGraphDeploymentScalingAdapter（DGDSA）。  
- 这意味着默认情况下服务的 `replicas` 字段可直接在 DynamoGraphDeployment（DGD）里编辑，只有显式开启时才会使用 DGDSA 并支持 HPA/KEDA/Planner 自动伸缩。

**🎯 影响范围**  
- `deploy/operator/api/v1alpha1`（结构体与注解）  
- `deploy/operator/config/crd/bases`（CRD YAML）  
- `deploy/operator/internal/controller/dynamographdeployment_controller.go`（适配器创建/删除逻辑）  
- `deploy/operator/internal/webhook/validation/dynamographdeployment.go`（副本变更校验）  
- Helm Chart 中的 CRD 模板  
- 文档（API Reference、Autoscaling 指南）  
- 相关单元测试

**🔍 技术洞察**  

- **架构影响**  
  - **默认行为切换**：原本每个 Service 都会自动创建 DGDSA（即使用户未声明），现在默认不创建，只有显式 `enabled:true` 才会创建。  
  - **字段重命名**：从 `disable`（布尔默认 `false`）迁移到 `enabled`（布尔默认 `false`），改变了 API 向后兼容性。旧的 `disable` 字段在新版本的 CRD 中不再被识别，会在升级时被丢弃或导致校验错误。  
  - **资源使用**：默认不创建 DGDSA 可显著减少 Operator 所管理的自定义资源数量，降低内存/CPU 开销，提升集群可扩展性。  
  - **迁移路径**：需要提供升级脚本或兼容性 webhook，将已有 `disable:false`/`disable:true` 转换为对应的 `enabled:true`/`enabled:false`，否则已有部署在升级后会失去自动伸缩能力。  

- **性能影响**  
  - **正向**：创建的 DGDSA 减少，控制循环（Reconcile）次数下降，Operator 负载下降。  
  - **负向**：如果已有工作负载依赖 DGDSA 自动伸缩，在未显式打开 `enabled` 的情况下将失去 HPA/KEDA 支持，可能导致资源不足或浪费，需要用户手动补救。  

- **安全考虑**  
  - **权限粒度**：DGDSA 对 `replicas` 字段的写入权限是通过 `Scale` 子资源实现的，默认关闭后不再授予外部 autoscaler 对该子资源的权限，降低了误用或恶意扩容的风险。  
  - **数据一致性**：因 `replicas` 直接在 DGD 中编辑，任何拥有 DGD 写权限的用户均可改动副本数，需确保 RBAC 策略覆盖 DGD，以防未授权的规模变更。  

**⚠️ 潜在风险**  

1. **向后兼容性破坏**  
   - 旧版 manifest 中仍使用 `scalingAdapter.disable`，在新版本会被视为未知字段，导致 `kubectl apply` 报错或被忽略。  
   - 已存在的 DGDSA 资源在升级后仍残留，可能导致资源泄漏或冲突。  

2. **自动伸缩失效**  
   - 部署未显式打开 `enabled:true` 的 Service 将不再创建 DGDSA，导致原本依赖 HPA/KEDA/Planner 的自动伸缩失效，可能出现性能瓶颈。  

3. **文档与实际行为不匹配**  
   - 如果用户仅阅读旧版文档或教程，仍会以 “默认启用” 思路配置，升级后会出现意外行为。  

4. **测试覆盖不足**  
   - 部分 edge case（如 `ScalingAdapter` 为 `nil`、`replicas` 为 `nil`）在新逻辑下的行为需确保完整覆盖。  

**💡 关注建议**  

- **升级指南**：在发布说明中提供 **迁移手册**，包括：  
  - 将 `disable` → `enabled` 的字段转换脚本（`kubectl patch` 示例）。  
  - 对已有 DGD 检测是否缺失 `enabled:true` 并提示用户启用。  
  - 如有 DGDSA 仍残留，使用 `kubectl delete` 清理或让 Operator 自动回收。  

- **兼容性实现**：在 CRD 中保留 `disable` 为 **deprecated**（`x-kubernetes-preserve-unknown-fields` 或额外的 `omitempty`），在 webhook 中兼容两种写法并记录迁移日志，降低升级阻力。  

- **RBAC 检查**：确认集群中对 DGD 的 `update` 权限仅授予可信主体，防止因默认可直接编辑 `replicas` 而导致的意外扩容。  

- **监控/告警**：在 Operator 中加入检测：如果 Service 未开启 `enabled:true` 且仍有 HPA/KEDA 引用该 Service，发送告警提醒用户可能的配置失效。  

- **文档同步**：所有官方文档、示例、Helm values 必须明确标注“默认不创建 DGDSA，需要手动 `enabled:true` 才会生效”，并在 README 中强调此行为的变更。  

- **回归测试**：新增以下测试场景：  
  1. **老字段兼容**：使用 `disable:true/false` 的旧 manifest 是否仍能成功创建（应被忽略或转化）。  
  2. **无 `ScalingAdapter`**：确认不创建 DGDSA 并且用户可以直接修改 `replicas`。  
  3. **显式 `enabled:true`**：创建 DGDSA 并验证 HPA 能正常控制 `Scale` 子资源。  

- **监控资源消耗**：开启 `enabled:true` 的服务数量激增时，监控 DGDSA 对象数目和 Operator 的 Reconcile 频率，确保集群资源仍在可接受范围内。  

---  

**结论**：此次改动在提升默认资源使用率、降低误操作风险的同时，引入了向后兼容性破坏和自动伸缩失效的风险。通过提供清晰的迁移步骤、保持旧字段的兼容层以及加强 RBAC 与监控，可将风险降到最低，确保用户在升级后能够平滑地选择何时启用 Scaling Adapter。

---

#### 🟡 中重要度变更 (5)

### fix: add sweep range for moe dgdr example (#5225)
**SHA**: `a821378` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/a82137877c0903ccde01bd7375eb9fb8fba0629a)

**🎯 变更类型**：Bug 修复 / 功能增强  
**⚡ 重要程度**：🟡 中  
**📋 变更摘要**：为 `benchmarks/profiler/deploy/profile_sla_moe_dgdr.yaml` 添加了硬件相关的 sweep 参数，限定了 H200 环境下每个 engine 使用的 GPU 数量区间（8‑16）以及每节点的 GPU 数量（8），解决了原有配置缺失导致的自动调度不完整问题。  

**🎯 影响范围**：  
- `benchmarks/profiler` 相关的部署脚本和配置解析模块  
- 可能被 CI / 自动化测试读取的 `profile_sla_moe_dgdr.yaml`  

**💡 关注建议**：  
1. **代码兼容**：确认配置读取逻辑能够安全地忽略或默认处理新字段，以免在不支持 H200 的环境中出现解析错误。  
2. **校验逻辑**：在加载阶段加入范围校验（`min ≤ max`、`num_gpus_per_node` 与节点实际 GPU 数是否匹配），防止误配。  
3. **文档更新**：在 benchmark 使用说明中补充硬件 sweep 参数的含义、取值范围及对性能的影响。  
4. **回归测试**：添加针对新字段的单元/集成测试，验证在不同硬件配置下 profiling 能正确启动并收敛。  

上述措施可确保新参数带来的灵活性不会引入新的兼容性或配置错误。

---

### refactor: extract changed-files logic into reusable composite action (#5216)
**SHA**: `17528f8` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/17528f8149635918714d7f7d0b68962ac0df6cd6)

**🎯 变更类型**：重构  
**⚡ 重要程度**：🟡 中  

**📋 变更摘要**  
- 新增 `.github/actions/changed-files` 复合 Action，统一封装了获取 merge‑base、调用 `tj-actions/changed-files`、调试输出以及“未被任何过滤器覆盖”检查的全部逻辑。  
- 所有 CI 工作流（`container-validation-backends.yml`、`container-validation-dynamo.yml` 等）改为使用该复合 Action，删除了之前在工作流中散落的重复步骤。  
- 输出接口保持不变（core、operator、deploy、vllm、sglang、trtllm），仅通过 `steps.changes.outputs.*` 获得。

**🎯 影响范围**  
- GitHub Actions（`.github/workflows/*`）  
- 新增的 Action 定义 (`.github/actions/changed-files/action.yml`)  
- 依赖 `filters.yaml`、`FILTERS.md` 的 CI 过滤机制  

**💡 关注建议**  
1. **Token 权限**：复合 Action 现在显式接受 `gh_token`，确保在调用工作流中使用 `${{ github.token }}`（已改），但若后续改为自定义 token，请检查其 `repo` 与 `pull_request` 权限。  
2. **merge‑base 计算**：在 PR 分支上仍依赖 `gh` CLI。确认 `actions/checkout` 使用 `fetch-depth: 0`，否则 `git merge-base` 可能找不到目标分支的历史。  
3. **未覆盖文件检查**：该检查仍在 Action 中执行，若 `filters.yaml` 未及时同步，CI 将因 “uncovered files” 直接失败。建议在本地 `pre-commit` 或 CI 前置步骤中验证 `filters.yaml` 与实际路径的一致性。  
4. **兼容性**：复合 Action 依赖 `tj-actions/changed-files@v42.1.0`，如未来升级该第三方 Action，需验证输出字段名称未变。  
5. **文档同步**：README 或 CONTRIBUTING 中应新增对 “Changed Files Check Action” 的说明，便于新贡献者了解如何在自定义工作流中复用。  

总体而言，此次抽取提升了 CI 配置的可维护性和一致性，只要确保 token、checkout 深度以及过滤文件的同步，便可平滑迁移。

---

### fix: assign unique ports per vLLM worker to avoid ZMQ bind conflicts (#5224)
**SHA**: `19b5917` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/19b5917c2b88ea6a7c4c20cd4669974a642111a8)

**🎯 变更类型**：Bug 修复  
**⚡ 重要程度**：🟡 中  
**📋 变更摘要**：为每个 vLLM worker 动态分配唯一的 KV‑event 与 side‑channel 端口，避免 ZMQ 在同一机器上绑定冲突；同时在启动参数中显式指定 `--request-plane nats`。  
**🎯 影响范围**：  
- `benchmarks/router/run_engines.sh`（启动脚本）  
- vLLM 进程的环境变量读取路径（`dynamo/vllm`）  
- 可能的路由层（router）对端口配置的假设  

**💡 关注建议**  
1. **环境变量兼容性**：确认 `dynamo/vllm` 启动入口已读取 `DYN_VLLM_KV_EVENT_PORT` 与 `VLLM_NIXL_SIDE_CHANNEL_PORT`，若未加入相应默认或解析逻辑，需同步代码。  
2. **端口范围冲突**：当前使用 `20080+i` 与 `20096+i`，请确保在多节点或持续集成环境下，这些端口未被其他服务占用，可通过配置或检测机制防止意外冲突。  
3. **脚本可维护性**：将端口基准值抽取为变量或配置项，避免硬编码，方便未来调整或在不同机器上自定义。  
4. **测试覆盖**：加入针对多 worker 启动的集成测试，验证 ZMQ 绑定不再报错，并检查 `--request-plane nats` 是否被正确传递。  
5. **文档更新**：在 README 或 benchmark 说明中标注新增的环境变量及其意义，提醒使用者在手动启动 vLLM 时保持相同端口分配策略。  

整体来看，此修改解决了实际的端口冲突问题，影响范围主要局限在 benchmark 启动脚本及相应的环境变量读取路径，风险较低，只要同步相关代码并补充测试即可安全合入。

---

### ci: add uncovered files check and improve filter coverage (#5214)
**SHA**: `15a2e8d` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/15a2e8dec2d4fd86ca898ddcf56da8a9536cb658)

**变更类型**：CI 功能增强 / 可靠性提升  
**重要程度**：🟡 中  

**变更摘要**  
本次提交在 GitHub Actions 体系中加入了“未被覆盖的文件”检查，并对 `.github/filters.yaml`、CI 脚本以及相关工作流做了同步更新。新增 `FILTERS.md` 文档说明过滤规则及错误排查方法，同时提供 npm 脚本 `coverage` 用于本地全仓库覆盖检查。

**影响范围**  
- CI 过滤规则文件 `filters.yaml`（增加 docs、examples、ignore 等覆盖组）  
- 两条主要工作流 `container-validation-backends.yml`、`container-validation-dynamo.yml`（改为使用 `*_any_modified`、`*_all_modified_files` 输出，并在末尾执行未覆盖文件检测）  
- `.github/scripts`：新增 `test-filters.js` 的覆盖模式和 `package.json` 中的 `coverage` 任务  
- 文档 `FILTERS.md`、`.gitignore`（加入 `.cursor/.claude`）  

**关注建议**  
1. **新增文件时及时更新过滤规则**：根据文件类型（core、backend、docs、examples、ignore）在 `filters.yaml` 中添加相应模式，否则 CI 会因 “uncovered files” 报错而中断。  
2. **本地验证**：在提交前运行 `cd .github/scripts && npm i && npm run coverage`，确保所有已跟踪文件都有至少一个匹配的过滤器。  
3. **维护工作流同步**：若向 `filters.yaml` 增添新过滤组，需要在两个工作流的 `COVERED_FILES` 拼接列表中加入对应的 `*_all_modified_files` 输出，否则同样会触发未覆盖错误。  
4. **注意负向模式**：core 过滤中仍使用 `!**/*.md|*.rst|*.txt` 排除文档，保证文档更改不触发耗时的后端测试。  
5. **CI 运行成本**：未覆盖检查只在 PR 触发时执行，几乎不增加额外时间；但若过滤规则过于宽泛或遗漏，将导致不必要的作业被触发或 CI 被阻断。  

总之，此次改动提高了 CI 的可预测性和维护性，团队需在日常代码增删时同步更新 `filters.yaml` 并使用提供的本地检查工具，以避免因过滤规则不完整导致的 CI 失败。

---

### fix: add endpointslices RBAC permission for Planner service account (#5195)
**SHA**: `c90b87e` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/c90b87e244f46d76689b7a7081d98adf6e56b389)

**🎯 变更类型**：Bug 修复  
**⚡ 重要程度**：🟡 中  

**📋 变更摘要**：为 Planner ServiceAccount 所对应的 Operator Role 增加了对 `discovery.k8s.io/endpointslices` 的 `get/list/watch` 权限，并为 `nvidia.com/dynamoworkermetadatas` 添加了全套 CRUD（`get/list/watch/create/update/patch/delete`）权限，以解决 Planner 在运行时无法读取 EndpointSlice 与 WorkerMetadata 导致的错误。  

**🎯 影响范围**：  
- `deploy/helm/charts/platform/components/operator/templates/planner.yaml` 中的 RBAC 规则  
- 任何部署使用此 Helm Chart 的集群，尤其是启用了 Planner 功能的环境  

**💡 关注建议**：  
1. **安全审计**：新增的 `endpointslices` 只读权限相对安全，但 `dynamoworkermetadatas` 包含写操作，需确认 Planner 真正需要这些操作，避免授予过宽权限。  
2. **测试覆盖**：在 CI 中加入 RBAC 验证测试，确保更新后 Planner 能成功读取 EndpointSlice 并对 WorkerMetadata 执行预期操作。  
3. **文档同步**：更新部署文档或 Helm Chart README，说明新增的 RBAC 权限及其用途，帮助运维了解潜在的权限变更。  
4. **回滚策略**：若出现权限冲突或安全审计不通过，可通过 Helm 参数覆盖 `planner.rbac.enabled` 或直接删除对应 Role/RoleBinding 条目回滚。  

总体而言，此次修改修复了功能缺失但需留意最小权限原则，建议在上线前完成上述安全与测试检查。

---

#### 🟢 低重要度变更 (7)

### ci: Run the same tests across Github and Gitlab  CI for premerge (#5082)
**SHA**: `996077f` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/996077f49aaac2df6a4e183e41006b768ceeacf6)

**🎯 变更类型**：配置调整  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在 GitHub Actions 中新增 `enable_mypy` 输入，并在相关工作流及 pytest 命令中加入 `--mypy` 标志，实现预合并 CI 期间的类型检查。

---

### docs: update LoRA model name in docs (#5210)
**SHA**: `975870d` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/975870d552f75b024cb58d5aac9d9939d8e782bf)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：将示例 `vllm` LoRA 使用文档中的模型名称从 `Neural-Hacker/Qwen3-Math-Reasoning-LoRA` 替换为 `codelion/Qwen3-0.6B-accuracy-recovery-lora`，并相应更新 S3 路径、请求示例及响应信息。

---

### docs: kube-based service discovery (#5211)
**SHA**: `c92a422` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/c92a422b6275673ceda7556c5585293050e6ef68)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：新增 Kubernetes 原生服务发现指南，更新部署文档中的链接与说明，移除旧的 discovery README。

---

### docs: fix tracing doc ZMQ port conflict (#5200)
**SHA**: `194128e` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/194128ec893d052dbe1ce59dbc96362d5f33c6ac)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：更新 tracing 文档，说明 vLLM 示例脚本在多 worker 场景下需手动设置额外端口（如 `DYN_VLLM_KV_EVENT_PORT`、`VLLM_NIXL_SIDE_CHANNEL_PORT`）以避免 ZMQ 端口冲突，并在示例中加入相应环境变量。

---

### docs: Update TensorRT-LLM install prerequisites for 1.2.0rc5 (#5194)
**SHA**: `e8c87f1` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/e8c87f175f68c75000b462c04b9a260f10902626)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在 README 中将 TensorRT‑LLM 示例版本从 `1.1.0rc5` 更新至 `1.2.0rc5`，对应的 PyTorch 容器标签改为 `25.10`，并调整非容器安装的 PyTorch 版本说明及新增 ZeroMQ 库的可选安装提示。

---

### chore: Remove deprecated Earthfile (#5206)
**SHA**: `11d7d3f` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/11d7d3f59e15bc5eabe42ce056260dbd26550f3c)

**🎯 变更类型**：配置调整  
**⚡ 重要程度**：🟢低  
**📋 摘要**：删除已废弃的 Earthfile（根目录及 operator 子目录），并在示例文档中改为使用 Docker 构建/推送指令，移除旧的 Earthly 构建路径。

---

### build: build.sh enhancement (#5053)
**SHA**: `96e42f7` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/96e42f72cf69c903396864f15ea41ddaeaf6827c)

**🎯 变更类型**：配置调整  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在 `container/build.sh` 中新增 `--no-load`、`--push` 参数，默认使用 `--load`，可关闭加载或直接推送镜像。

---

