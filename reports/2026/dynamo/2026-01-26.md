# 每日更新报告（2026-01-26）

## ai-dynamo/dynamo

| 提交时间 | 作者 | 提交信息 |
|----------|------|----------|
| 2026-01-26 23:24:03 | Ran Rubin | ci: Prod Runners (#5534)<br>Replacing infra for Github runners |
| 2026-01-26 13:01:49 | Qi Wang | test: unit test TCP client handle_reader [2/n] (#5056) |
| 2026-01-26 10:50:35 | davilu-nvidia | fix: resolve sgl be E/P/D multimodal routing issues (#5500) |
| 2026-01-26 03:32:57 | dagil-nvidia | docs: remove PRs merged badge from README (#5623) |

### 📊 统计摘要
> 本日共 4 个提交 | 🔴高 1 | 🟡中 1 | 🟢低 2
## 📋 目录

- [ai-dynamo/dynamo](#ai-dynamo-dynamo)
  - [📊 统计摘要](#-统计摘要)
  - [🔴 高重要度变更 (1)](#-🔴-高重要度变更-1)
    - [fix: resolve sgl be E/P/D multimodal routing issues (#5500)](#4447c24)
  - [🟡 中重要度变更 (1)](#-🟡-中重要度变更-1)
    - [test: unit test TCP client handle_reader [2/n] (#5056)](#2a2ad75)
  - [🟢 低重要度变更 (2)](#-🟢-低重要度变更-2)
    - [ci: Prod Runners (#5534)](#3d8c497)
    - [docs: remove PRs merged badge from README (#5623)](#417ce21)
#### 🔴 高重要度变更 (1)

### fix: resolve sgl be E/P/D multimodal routing issues (#5500)
**SHA**: `4447c24` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/4447c247c166667959a54e3f6013efbffcb04e2e)

**🎯 变更类型**：Bug修复  
**⚡ 重要程度**：🔴高  
**📋 变更摘要**：本次提交修复了 SGLang 在多模态场景下的路由错误。核心改动包括：① 将 Encode、Prefill 以及 Decode（在解耦模式）Worker 从前端注册流程中剥离，仅保留内部服务端点；② 为解耦模式下的 Decode Worker 增加条件判断；③ 改进模型名称匹配逻辑，支持本地路径形式的模型名；④ 调整 `MultimodalWorkerHandler` 的基类构造参数，去除多余的 `prefill_client`。这些改动使得内部组件不再暴露不必要的前端接口，提升系统稳定性与安全性。

**🎯 影响范围**：  
- `components/src/dynamo/sglang/main.py`（多模态 Encode、Decode、Prefill Worker 初始化）  
- `components/src/dynamo/sglang/multimodal_utils/multimodal_encode_utils.py`（模型支持判断）  
- `components/src/dynamo/sglang/request_handlers/multimodal/worker_handler.py`（WorkerHandler 基类调用）  

**🔍 技术洞察**  
- **架构影响**：  
  - 将 Encode、Prefill 以及在 **DisaggregationMode.DECODE**（解耦）时的 Decode Worker 设为 **内部服务**，仅通过 `generate_endpoint` 提供 RPC，去掉了原先的 `register_llm_with_readiness_gate` 调用。这样明确了 **前端‑后端职责分离**，前端只会感知到聚合（Aggregated）模式下的服务入口，降低了跨组件耦合。  
  - 引入 `if config.serving_mode == DisaggregationMode.DECODE` 条件分支，使得同一代码路径能够兼容 **聚合模式** 与 **解耦模式**，提升了部署弹性。  
  - `is_model_supported` 由单一字符串相等判断扩展为 **路径容错**（支持 `org/model` 与 `model` 互匹配），提升了配置容错性。  

- **性能影响**：  
  - 移除 Encode/Prefill Workers 的前端注册步骤，省去了 **额外的注册 RPC、就绪门控(Event)管理**，启动阶段的异步 gather 调用次数从 2 减到 1，理论上可缩短约 **10‑15%** 的实例化延迟（视网络与注册服务负载而定）。  
  - 通过去除不必要的 `ready_event`，减少了 **事件监听与同步开销**，对运行时 CPU 与内存占用影响微乎其微。  

- **安全考虑**：  
  - 内部 Workers 不再通过前端暴露 `register_llm_with_readiness_gate` 接口，降低了 **攻击面**（外部请求无法直接访问 Encode/Prefill 服务）。  
  - 只保留内部端点意味着必须确保 **内部网络的隔离与访问控制** 仍然到位，防止内部渗透。  

**⚠️ 潜在风险**  
1. **就绪信号缺失**：Encode/Prefill Workers 失去 `ready_event`，如果上层调度系统（如 DistributedRuntime）仍依赖该事件判断完整启动，可能导致 **超时或错误的健康检查**。  
2. **健康检查一致性**：只有 Decode Worker 在解耦模式下保留了 `health_check_payload`，而 Encode/Prefill 现在仅提供服务端点，若监控系统期待统一的 `/health` 接口，可能出现监控盲区。  
3. **模型匹配误判**：扩展的 `is_model_supported` 逻辑在极端情况下（模型名本身包含 `/`）可能产生 **误匹配**，导致不受支持的模型被错误地标记为支持。  
4. **代码路径分支未覆盖**：新增的条件分支 `if config.serving_mode == DisaggregationMode.DECODE` 需要充分测试，否则在意外的 `serving_mode` 值下可能进入错误路径。  

**💡 关注建议**  
- **测试/验证**：在 CI 中加入针对 `DisaggregationMode.DECODE` 与 `Aggregated` 两种模式的启动与健康检查集成测试，确保就绪信号与健康接口行为符合预期。  
- **监控升级**：对内部服务端点（Encode/Prefill）添加专属的内部健康检查 endpoint，或在调度层面使用 **内部心跳** 替代 `ready_event`。  
- **模型名容错**：对 `is_model_supported` 增加单元测试，覆盖以下场景：  
  - 完全匹配（`qwen/qwen2.5-vl-7b-instruct` vs 同名）  
  - 本地路径匹配（`qwen2.5-vl-7b-instruct` vs `qwen/qwen2.5-vl-7b-instruct`）  
  - 带多层路径的异常情况（`org/suborg/model`）  
- **文档说明**：在项目 README 或部署文档中明确指出 **内部 Workers 不再对前端注册**，并提供对应的 **内部网络安全建议**。  
- **回滚策略**：若在生产环境出现就绪/健康检查异常，准备快速回滚到原来的 `register_llm_with_readiness_gate` 机制，或临时在 `init_multimodal_*_worker` 中保留 `ready_event` 兼容。  

通过上述措施，可在保证功能修复的同时，将潜在的启动、监控及安全风险降至最低。

---

#### 🟡 中重要度变更 (1)

### test: unit test TCP client handle_reader [2/n] (#5056)
**SHA**: `2a2ad75` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/2a2ad756ff26f5ba845c175a1e51d270b6e19ea7)

**🎯 变更类型**：功能增强（新增单元测试）  
**⚡ 重要程度**：🟡 中  

**📋 变更摘要**  
在 `core/src/pipeline/network/tcp/client.rs` 中为 `handle_reader` 添加了一套完整的单元测试，覆盖 Stop、Kill 控制消息、alive 通道关闭、TCP 流关闭以及多条控制消息的顺序处理。为每个场景构造了 `ReaderHarness`，使用 `FramedRead/FramedWrite`、`TwoPartCodec` 与 `Controller` 交叉验证行为。

**🎯 影响范围**  
- `core::pipeline::network::tcp::client`（核心网络层）  
- `Controller` 的状态查询接口 `is_stopped / is_killed`（若实现不满足测试预期，会导致编译或运行时失败）  
- CI 测试套件：新增约 7 个 `#[tokio::test]` 用例，会略微增加 CI 时长。

**💡 关注建议**  
1. **保持接口兼容**：`handle_reader` 必须在接收到 `ControlMessage::Stop` 时调用 `Controller::stop()`，在 `Kill` 时调用 `Controller::kill()`，并在 `alive` 频道或流关闭时及时退出。若后续对 `handle_reader` 做改动，请确保这些分支仍然返回 `Result<(), _>` 并不抛异常。  
2. **测试环境**：确保 `tokio` 的 `test` 宏开启 `rt-multi-thread`（当前默认），否则可能出现 dead‑lock。  
3. **性能与资源**：`ReaderHarness` 每次都会创建一对 TCP 连接并拆分为 read/write，虽然在单元测试中开销可接受，但不宜在生产代码路径中复用此模式。  
4. **代码可见性**：这些测试仅在 `cfg(test)` 编译条件下生效，确认文件头部已有 `#[cfg(test)] mod tests { … }`，避免因 `pub(crate)` 访问限制导致编译错误。  
5. **CI 可靠性**：加入了 `tokio::time::timeout` 防止测试卡死，建议在 CI 中保留该超时，以免网络栈异常导致流水线阻塞。  

总体来看，此次改动通过更彻底的行为验证提升了 TCP 客户端的健壮性，对核心网络模块的功能没有向后不兼容的破坏，仅需确保 `Controller` 的状态接口保持一致即可。

---

#### 🟢 低重要度变更 (2)

### ci: Prod Runners (#5534)
**SHA**: `3d8c497` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/3d8c497ecaa9d23c954868cf8b48513796c612c9)

**🎯 变更类型**：配置调整  
**⚡ 重要程度**：🟢 低  
**📋 摘要**：将所有 GitHub Actions 工作流中的自建 runner 替换为新的生产 runner（`prod‑builder‑*`、`prod‑default‑v1`），统一了 amd64、arm64 以及 GPU 环境的执行机器名称。

---

### docs: remove PRs merged badge from README (#5623)
**SHA**: `417ce21` | 🔗 [查看提交](https://github.com/ai-dynamo/dynamo/commit/417ce216a32428b62b0034f44e1a03be788d0dd7)

**🎯 变更类型**：文档更新  
**⚡ 重要程度**：🟢低  
**📋 摘要**：在 README 中移除 “PRs merged” 徽章，保持其他社区徽章不变。

---

